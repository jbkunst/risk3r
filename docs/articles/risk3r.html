<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example using risk3r • risk3r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example using risk3r">
<meta property="og:description" content="risk3r">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">risk3r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/risk3r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

<<<<<<< HEAD
      </header><script src="risk3r_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
=======
      </header><script src="risk3r_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example using risk3r</h1>
            
      
      
      <div class="hidden name"><code>risk3r.Rmd</code></div>

    </div>

    
    
<div id="packages" class="section level2">
<h2 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h2>
</div>
<div id="parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#parameters" class="anchor"></a>Parameters</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PARAMETERS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  SEED <span class="op">=</span> <span class="fl">12345</span>,
  P_TRAIN <span class="op">=</span> <span class="fl">0.7</span>,
  P_CONCENTRATION <span class="op">=</span> <span class="fl">.95</span>,
  IV_MIN <span class="op">=</span> <span class="fl">0.02</span>, <span class="co"># WEAK &gt;=</span>
  COUNT_DISTR_LIMIT <span class="op">=</span> <span class="fl">0.05</span>,
  CORRELATION_LIMIT <span class="op">=</span> <span class="fl">0.5</span>,
  POINTS0 <span class="op">=</span> <span class="fl">600</span>,
  PDO     <span class="op">=</span> <span class="fl">20</span>,
  ODDS0   <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span>
<span class="op">)</span></code></pre></div>
<details><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">custom_skim</span> <span class="op">&lt;-</span> <span class="fu">skim_with</span><span class="op">(</span>
  numeric <span class="op">=</span> <span class="fu">sfl</span><span class="op">(</span>
    median <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="va">median</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    skewness <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="fu">moments</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/moments/man/skewness.html">skewness</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    kurtosis <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="fu">moments</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/moments/man/kurtosis.html">kurtosis</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    count_distr_max <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/count_distr_max.html">count_distr_max</a></span>,
    n_unique <span class="op">=</span> <span class="fu">skimr</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/skimr/reference/stats.html">n_unique</a></span>
    <span class="op">)</span>,
  factor <span class="op">=</span> <span class="fu">sfl</span><span class="op">(</span>
    hhi <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi.html">hhi</a></span>,
    hhi_lbl <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/compose.html">compose</a></span><span class="op">(</span><span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi.html">hhi</a></span>, <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi_label.html">hhi_label</a></span>, .dir <span class="op">=</span> <span class="st">"forward"</span><span class="op">)</span>,
    count_distr_max <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/count_distr_max.html">count_distr_max</a></span>
    <span class="op">)</span>,
  append <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># custom_skim(data %&gt;% select(1:10))</span></code></pre></div>
</details>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">OPTION</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="kw">if</span><span class="op">(</span><span class="va">OPTION</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw/cd.rds"</span><span class="op">)</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span>
  <span class="co"># select(1:300, where(is.character)) %&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">100000</span><span class="op">)</span>

<span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"bad"</span>, <span class="st">"good"</span><span class="op">)</span>,
    bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">bad_good</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">OPTION</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="va"><a href="http://shichen.name/scorecard/reference/germancredit.html">germancredit</a></span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>bad_good <span class="op">=</span> <span class="va">creditability</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">bad_good</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bad_good <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">bad_good</span>, <span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">OPTION</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hmeq.html">hmeq</a></span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>bad_good <span class="op">=</span> <span class="va">bad</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">bad_good</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"bad"</span>, <span class="st">"good"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bad_good <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">bad_good</span>, <span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 5960   14</code></pre>
</div>
<div id="univariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#univariate-analysis" class="anchor"></a>Univariate analysis</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe</span> <span class="op">&lt;-</span> <span class="fu">custom_skim</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="co"># use as.list to export skimr (risk3r:::as.list.skim_df)</span>
<span class="co"># writexl::write_xlsx(as.list(describe), here::here("data-raw/describe.xlsx"))</span></code></pre></div>
<p>Remove variables with 0 variance and near 0 variance.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe_min</span> <span class="op">&lt;-</span> <span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">describe</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">select</span>, variable <span class="op">=</span> <span class="va">skim_variable</span>, <span class="va">n_unique</span>, <span class="va">count_distr_max</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">vars_to_remove_unique_value</span> <span class="op">&lt;-</span> <span class="va">describe_min</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_unique</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>

<span class="va">vars_to_remove_near_0_var</span> <span class="op">&lt;-</span> <span class="va">describe_min</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">count_distr_max</span> <span class="op">&gt;=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_CONCENTRATION</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>

<span class="va">vars_to_remove_unique_value</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_near_0_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">vars_to_remove_near_0_var</span>, <span class="va">vars_to_remove_unique_value</span><span class="op">)</span></code></pre></div>
<p>Or using scorecard:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrd_filter</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/var_filter.html">var_filter</a></span><span class="op">(</span>
  <span class="va">data</span>, 
  <span class="co"># next 2 parameter are needed even we want only due identical_limit</span>
  y <span class="op">=</span> <span class="st">"bad_good"</span>, iv_limit <span class="op">=</span> <span class="fl">0</span>,
  missing_limit <span class="op">=</span> <span class="fl">1</span>,
  identical_limit <span class="op">=</span>  <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_CONCENTRATION</span>,
  return_rm_reason <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] filtering variables ...</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrd_filter</span><span class="op">$</span><span class="va">rm</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rm_reason</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 0 x 5
<<<<<<< HEAD
## # ... with 5 variables: variable &lt;chr&gt;, rm_reason &lt;chr&gt;, info_value &lt;dbl&gt;,
=======
## # … with 5 variables: variable &lt;chr&gt;, rm_reason &lt;chr&gt;, info_value &lt;dbl&gt;,
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
## #   missing_rate &lt;dbl&gt;, identical_rate &lt;dbl&gt;</code></pre>
<div id="anomalies" class="section level3">
<h3 class="hasAnchor">
<a href="#anomalies" class="anchor"></a>Anomalies</h3>
<p>From <a href="https://github.com/sicarul/xray" class="uri">https://github.com/sicarul/xray</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe_anomalies</span> <span class="op">&lt;-</span> <span class="fu">xray</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xray/man/anomalies.html">anomalies</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">describe_anomalies</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 14 x 13
##    Variable     q   qNA pNA    qZero pZero  qBlank pBlank  qInf pInf  qDistinct
<<<<<<< HEAD
##    &lt;fct&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
=======
##    &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
##  1 derog     5960   708 11.88%  4527 75.96%      0 -          0 -            12
##  2 delinq    5960   580 9.73%   4179 70.12%      0 -          0 -            15
##  3 ninq      5960   510 8.56%   2531 42.47%      0 -          0 -            17
##  4 debtinc   5960  1267 21.26%     0 -           0 -          0 -          4694
##  5 yoj       5960   515 8.64%    415 6.96%       0 -          0 -           100
##  6 mortdue   5960   518 8.69%      0 -           0 -          0 -          5054
##  7 clage     5960   308 5.17%      2 0.03%       0 -          0 -          5315
##  8 clno      5960   222 3.72%     62 1.04%       0 -          0 -            63
##  9 job       5960   279 4.68%      0 -           0 -          0 -             7
## 10 reason    5960   252 4.23%      0 -           0 -          0 -             3
## 11 value     5960   112 1.88%      0 -           0 -          0 -          5382
## 12 bad_good  5960     0 -          0 -           0 -          0 -             2
## 13 loan      5960     0 -          0 -           0 -          0 -           540
## 14 id        5960     0 -          0 -           0 -          0 -          5960
<<<<<<< HEAD
## # ... with 2 more variables: type &lt;chr&gt;, anomalous_percent &lt;chr&gt;</code></pre>
=======
## # … with 2 more variables: type &lt;chr&gt;, anomalous_percent &lt;chr&gt;</code></pre>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">describe_anomalies</span><span class="op">$</span><span class="va">problem_variables</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 14
##   Variable     q   qNA pNA    qZero pZero  qBlank pBlank  qInf pInf  qDistinct
<<<<<<< HEAD
##   &lt;fct&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
## 1 derog     5960   708 11.88%  4527 75.96%      0 -          0 -            12
## # ... with 3 more variables: type &lt;chr&gt;, anomalous_percent &lt;chr&gt;,
## #   problems &lt;chr&gt;</code></pre>
=======
##   &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
## 1 derog     5960   708 11.88%  4527 75.96%      0 -          0 -            12
## # … with 3 more variables: type &lt;chr&gt;, anomalous_percent &lt;chr&gt;, problems &lt;chr&gt;</code></pre>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<p>Some differences between result due <code><a href="http://shichen.name/scorecard/reference/var_filter.html">scorecard::var_filter</a></code> exclude NAs to caculate de identical limit.</p>
</div>
<div id="removing-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#removing-variables" class="anchor"></a>Removing variables</h3>
<p>Surely we want remove other variables like the id operation/customer or a temporal/time variables.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_specials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"id"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">vars_to_remove_unique_value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">vars_to_remove_near_0_var</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="va">vars_to_remove_specials</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="split" class="section level2">
<h2 class="hasAnchor">
<a href="#split" class="anchor"></a>Split</h2>
<p>From: <a href="https://www.tidymodels.org/start/recipes/#data-split" class="uri">https://www.tidymodels.org/start/recipes/#data-split</a></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fix the random numbers by setting the seed </span>
<span class="co"># This enables the analysis to be reproducible when random numbers are used </span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">PARAMETERS</span><span class="op">$</span><span class="va">SEED</span><span class="op">)</span>

<span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span><span class="va">data</span>, prop <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_TRAIN</span><span class="op">)</span>

<span class="co"># Create data frames for the two sets:</span>
<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>
<span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></code></pre></div>
<p>We can do check:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bad_good</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   bad_good     n `n/sum(n)`
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 good      3349      0.803
## 2 bad        823      0.197</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">bad_good</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   bad_good     n `n/sum(n)`
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 good      1422      0.795
## 2 bad        366      0.205</code></pre>
</div>
<div id="bivariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#bivariate-analysis" class="anchor"></a>Bivariate analysis</h2>
<div id="getting-woes" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-woes" class="anchor"></a>Getting woes</h3>
<p>We’ll start with the default <code>method = "tree"</code></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin.html">woebin</a></span><span class="op">(</span>
  <span class="va">train_data</span>, 
  y <span class="op">=</span> <span class="st">"bad_good"</span>, 
  method <span class="op">=</span> <span class="st">"tree"</span>,
  count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ...</code></pre>
<p>Some sanity checks:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># train_data$variable_with_missing %&gt;% is.na() %&gt;% table()</span>
<span class="co"># bins$variable_with_missing</span></code></pre></div>
<p>The risk3r package have <code>woebin_summary</code> to get the summary.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">dbiv</span></code></pre></div>
<pre><code>## # A tibble: 12 x 15
##    variable n_categories      iv     ks   hhi count_distr_max count_distr_min
##    &lt;chr&gt;           &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
##  1 debtinc             4 1.94    0.618  0.25            0.634          0.0626
##  2 delinq              4 0.587   0.322  0.25            0.700          0.0899
##  3 value               6 0.395   0.171  0.167           0.312          0.0170
##  4 derog               3 0.341   0.212  0.333           0.758          0.120 
##  5 clage               5 0.230   0.210  0.2             0.347          0.0501
##  6 ninq                5 0.216   0.173  0.2             0.435          0.0674
##  7 loan                5 0.145   0.124  0.2             0.446          0.0527
##  8 job                 6 0.115   0.142  0.167           0.406          0.0484
##  9 clno                5 0.107   0.136  0.2             0.543          0.0364
## 10 yoj                 6 0.0864  0.116  0.167           0.343          0.0825
## 11 mortdue             7 0.0500  0.0813 0.143           0.392          0.0551
## 12 reason              3 0.00627 0.0368 0.333           0.652          0.0424
<<<<<<< HEAD
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
=======
## # … with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">dbiv</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 12
## Columns: 15
<<<<<<< HEAD
## $ variable           &lt;chr&gt; "debtinc", "delinq", "value", "derog", "clage", "ni~
## $ n_categories       &lt;int&gt; 4, 4, 6, 3, 5, 5, 5, 6, 5, 6, 7, 3
## $ iv                 &lt;dbl&gt; 1.937625988, 0.587078037, 0.395450463, 0.341107292,~
## $ ks                 &lt;dbl&gt; 0.61847010, 0.32198219, 0.17082519, 0.21159215, 0.2~
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2500000, 0.1666667, 0.3333333, 0.20000~
## $ count_distr_max    &lt;dbl&gt; 0.6344679, 0.6996644, 0.3123202, 0.7583893, 0.34659~
## $ count_distr_min    &lt;dbl&gt; 0.06255992, 0.08988495, 0.01701822, 0.11984660, 0.0~
## $ has_missing        &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR~
## $ has_special_values &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR~
## $ monotone           &lt;lgl&gt; TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, ~
## $ factor             &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRU~
## $ breaks             &lt;list&gt; &lt;"missing", "40", "42", "Inf"&gt;, &lt;"missing", "1", "2~
## $ iv_lbl             &lt;fct&gt; suspicious, suspicious, strong, strong, medium, me~
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, mod~
## $ distribution       &lt;chr&gt; "&lt;U+2583&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;", "&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;", "&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2586&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2586&gt;", "&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;", "&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2585&gt;", "&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2583&gt;&lt;U+2581&gt;", ~</code></pre>
=======
## $ variable           &lt;chr&gt; "debtinc", "delinq", "value", "derog", "clage", "ni…
## $ n_categories       &lt;int&gt; 4, 4, 6, 3, 5, 5, 5, 6, 5, 6, 7, 3
## $ iv                 &lt;dbl&gt; 1.937625988, 0.587078037, 0.395450463, 0.341107292,…
## $ ks                 &lt;dbl&gt; 0.61847010, 0.32198219, 0.17082519, 0.21159215, 0.2…
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2500000, 0.1666667, 0.3333333, 0.20000…
## $ count_distr_max    &lt;dbl&gt; 0.6344679, 0.6996644, 0.3123202, 0.7583893, 0.34659…
## $ count_distr_min    &lt;dbl&gt; 0.06255992, 0.08988495, 0.01701822, 0.11984660, 0.0…
## $ has_missing        &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR…
## $ has_special_values &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR…
## $ monotone           &lt;lgl&gt; TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, …
## $ factor             &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRU…
## $ breaks             &lt;list&gt; &lt;"missing", "40", "42", "Inf"&gt;, &lt;"missing", "1", "2…
## $ iv_lbl             &lt;fct&gt; suspicious, suspicious, strong, strong, medium, me…
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, mod…
## $ distribution       &lt;chr&gt; "▃▇▁▁", "▁▇▁▁", "▁▂▆▅▇▆", "▁▇▁", "▁▁▇▇▅", "▂▇▅▃▁", …</code></pre>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<p>Note that <code>dbiv</code> object have <code>breaks</code> column among other information.</p>
<p>In some cases, monotonic woes are required in continous variables. With the <code>dbiv</code> object we can check what variables have a high information and no monotonic (excluding the missing category oc).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">iv</span> <span class="op">&gt;</span> <span class="fl">0.02</span>,  <span class="co"># A &gt;= weak iv value</span>
    <span class="op">!</span><span class="va">factor</span>,    <span class="co"># is numeric</span>
    <span class="op">!</span><span class="va">monotone</span>   <span class="co"># is not monotonic</span>
    <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 15
##   variable n_categories     iv     ks   hhi count_distr_max count_distr_min
##   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
## 1 value               6 0.395  0.171  0.167           0.312          0.0170
## 2 loan                5 0.145  0.124  0.2             0.446          0.0527
## 3 clno                5 0.107  0.136  0.2             0.543          0.0364
## 4 yoj                 6 0.0864 0.116  0.167           0.343          0.0825
## 5 mortdue             7 0.0500 0.0813 0.143           0.392          0.0551
<<<<<<< HEAD
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
=======
## # … with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
</div>
<div id="exploring-finding-the-best-cutsbin" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-finding-the-best-cutsbin" class="anchor"></a>Exploring, finding the best cuts/bin</h3>
<p><code><a href="../reference/woebin2.html">risk3r::woebin2</a></code> -a wrapper around the main <code><a href="http://shichen.name/scorecard/reference/woebin.html">scorecard::woebin</a></code> function- implement <code>method = "ctree"</code> via the partykit package (we’ll try implement monotonic binnings from mob package <a href="https://github.com/statcompute/mob" class="uri">https://github.com/statcompute/mob</a>).</p>
<p>Having this we can iterate among all available methods:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tree"</span>, <span class="st">"ctree"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="st">"chimerge"</span><span class="op">)</span><span class="op">{</span>

    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>

  <span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="fu"><a href="../reference/woebin2.html">woebin2</a></span><span class="op">(</span>
    <span class="va">train_data</span>,
    y <span class="op">=</span> <span class="st">"bad_good"</span>,
    count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>,
    method <span class="op">=</span> <span class="va">m</span>
    <span class="op">)</span>

   <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">m</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ...</code></pre>
<p>We can check, for each variable: - Every method is generated for every variable - The methods give same IV in some variables</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   method     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 ctree     12
## 2 tree      12</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">iv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##       n    nn
##   &lt;int&gt; &lt;int&gt;
## 1     1    12
## 2     2     6</code></pre>
<p>Get the best breaks in the sense to maximize the IV, the get the breaks and finally uses <code><a href="http://shichen.name/scorecard/reference/woebin.html">scorecard::woebin</a></code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binbest</span> <span class="op">&lt;-</span> <span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">iv</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">binbest</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   method     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 tree      12</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_breaks</span> <span class="op">&lt;-</span> <span class="va">binbest</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">breaks</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin.html">woebin</a></span><span class="op">(</span>
  <span class="va">train_data</span>,
  y <span class="op">=</span> <span class="st">"bad_good"</span>,
  count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>,
  breaks_list <span class="op">=</span> <span class="va">best_breaks</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ...</code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">dbiv</span></code></pre></div>
<pre><code>## # A tibble: 12 x 15
##    variable n_categories      iv     ks   hhi count_distr_max count_distr_min
##    &lt;chr&gt;           &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
##  1 debtinc             4 1.94    0.618  0.25            0.634          0.0626
##  2 delinq              4 0.587   0.322  0.25            0.700          0.0899
##  3 value               6 0.395   0.171  0.167           0.312          0.0170
##  4 derog               3 0.341   0.212  0.333           0.758          0.120 
##  5 clage               5 0.230   0.210  0.2             0.347          0.0501
##  6 ninq                5 0.216   0.173  0.2             0.435          0.0674
##  7 loan                5 0.145   0.124  0.2             0.446          0.0527
##  8 job                 6 0.115   0.142  0.167           0.406          0.0484
##  9 clno                5 0.107   0.136  0.2             0.543          0.0364
## 10 yoj                 6 0.0864  0.116  0.167           0.343          0.0825
## 11 mortdue             7 0.0500  0.0813 0.143           0.392          0.0551
## 12 reason              3 0.00627 0.0368 0.333           0.652          0.0424
<<<<<<< HEAD
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
=======
## # … with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">dbiv</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 12
## Columns: 15
<<<<<<< HEAD
## $ variable           &lt;chr&gt; "debtinc", "delinq", "value", "derog", "clage", "ni~
## $ n_categories       &lt;int&gt; 4, 4, 6, 3, 5, 5, 5, 6, 5, 6, 7, 3
## $ iv                 &lt;dbl&gt; 1.937625988, 0.587078037, 0.395450463, 0.341107292,~
## $ ks                 &lt;dbl&gt; 0.61847010, 0.32198219, 0.17082519, 0.21159215, 0.2~
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2500000, 0.1666667, 0.3333333, 0.20000~
## $ count_distr_max    &lt;dbl&gt; 0.6344679, 0.6996644, 0.3123202, 0.7583893, 0.34659~
## $ count_distr_min    &lt;dbl&gt; 0.06255992, 0.08988495, 0.01701822, 0.11984660, 0.0~
## $ has_missing        &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR~
## $ has_special_values &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR~
## $ monotone           &lt;lgl&gt; TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, ~
## $ factor             &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRU~
## $ breaks             &lt;list&gt; &lt;"missing", "40", "42", "Inf"&gt;, &lt;"missing", "1", "2~
## $ iv_lbl             &lt;fct&gt; suspicious, suspicious, strong, strong, medium, me~
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, mod~
## $ distribution       &lt;chr&gt; "&lt;U+2583&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;", "&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;", "&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2586&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2586&gt;", "&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;", "&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2585&gt;", "&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2583&gt;&lt;U+2581&gt;", ~</code></pre>
=======
## $ variable           &lt;chr&gt; "debtinc", "delinq", "value", "derog", "clage", "ni…
## $ n_categories       &lt;int&gt; 4, 4, 6, 3, 5, 5, 5, 6, 5, 6, 7, 3
## $ iv                 &lt;dbl&gt; 1.937625988, 0.587078037, 0.395450463, 0.341107292,…
## $ ks                 &lt;dbl&gt; 0.61847010, 0.32198219, 0.17082519, 0.21159215, 0.2…
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2500000, 0.1666667, 0.3333333, 0.20000…
## $ count_distr_max    &lt;dbl&gt; 0.6344679, 0.6996644, 0.3123202, 0.7583893, 0.34659…
## $ count_distr_min    &lt;dbl&gt; 0.06255992, 0.08988495, 0.01701822, 0.11984660, 0.0…
## $ has_missing        &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR…
## $ has_special_values &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TR…
## $ monotone           &lt;lgl&gt; TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, …
## $ factor             &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRU…
## $ breaks             &lt;list&gt; &lt;"missing", "40", "42", "Inf"&gt;, &lt;"missing", "1", "2…
## $ iv_lbl             &lt;fct&gt; suspicious, suspicious, strong, strong, medium, me…
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, mod…
## $ distribution       &lt;chr&gt; "▃▇▁▁", "▁▇▁▁", "▁▂▆▅▇▆", "▁▇▁", "▁▁▇▇▅", "▂▇▅▃▁", …</code></pre>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<p>Apply woes to train and test table.</p>
</div>
<div id="finding-variables-with-low-iv" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-variables-with-low-iv" class="anchor"></a>Finding variables with low IV</h3>
<p>Just remove variables with low predictive power.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_low_iv</span> <span class="op">&lt;-</span> <span class="va">dbiv</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">iv</span> <span class="op">&lt;</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">IV_MIN</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></code></pre></div>
</div>
<div id="finding-highly-correlated-woes-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-highly-correlated-woes-variables" class="anchor"></a>Finding highly correlated woes variables</h3>
<p>In risk3r we can get a data frame with correlations between woes and IVs to decide what variables remove.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FALSE to know check the next steps below</span>
<span class="va">dcors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_cor_iv.html">woebin_cor_iv</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">bins</span>, upper <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dcors</span></code></pre></div>
<pre><code>## # A tibble: 144 x 7
##    var1    var2          r var1_iv var1_rank var2_iv var2_rank
##    &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;
##  1 debtinc debtinc NA         1.94         1  1.94           1
##  2 debtinc delinq   0.226     1.94         1  0.587          2
##  3 debtinc value    0.189     1.94         1  0.395          3
##  4 debtinc derog    0.166     1.94         1  0.341          4
##  5 debtinc clage    0.0806    1.94         1  0.230          5
##  6 debtinc ninq     0.207     1.94         1  0.216          6
##  7 debtinc loan     0.166     1.94         1  0.145          7
##  8 debtinc job      0.0990    1.94         1  0.115          8
##  9 debtinc clno     0.0693    1.94         1  0.107          9
## 10 debtinc yoj      0.0476    1.94         1  0.0864        10
<<<<<<< HEAD
## # ... with 134 more rows</code></pre>
=======
## # … with 134 more rows</code></pre>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<p>Now, we can get the variables which have high correlation</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">dcors</span> 

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="va">n</span> </code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove same vars (diagonal)</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">var1</span> <span class="op">!=</span> <span class="va">var2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># keep upper matrix</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">var1_rank</span> <span class="op">&lt;</span> <span class="va">var2_rank</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span><span class="fl">2</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove variables which causes high correlations and have lower IV </span>
<span class="co"># respect the other variable</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">CORRELATION_LIMIT</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">var2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="removing-variables-1" class="section level3">
<h3 class="hasAnchor">
<a href="#removing-variables-1" class="anchor"></a>Removing variables</h3>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span>, <span class="va">vars_to_remove_low_iv</span><span class="op">)</span>

<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">vars_to_remove_low_iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="applying-woes" class="section level3">
<h3 class="hasAnchor">
<a href="#applying-woes" class="anchor"></a>Applying woes</h3>
<p>Just <code><a href="http://shichen.name/scorecard/reference/woebin_ply.html">scorecard::woebin_ply</a></code> :)</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># class before woes</span>
<span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
##  factor numeric 
##       2      10</code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin_ply.html">woebin_ply</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">bins</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin_ply.html">woebin_ply</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="va">bins</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># check all is numeric except response variable</span>
<span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
##  factor numeric 
##       1      11</code></pre>
</div>
</div>
<div id="modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#modelling" class="anchor"></a>Modelling</h2>
<div id="raw-model" class="section level3">
<h3 class="hasAnchor">
<a href="#raw-model" class="anchor"></a>Raw Model</h3>
<p>Let fit a very raw model to check:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="va">logit</span><span class="op">)</span><span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    term        estimate std.error statistic   p.value
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)   -1.40     0.0571   -24.4   1.07e-131
##  2 loan_woe       0.522    0.141      3.71  2.07e-  4
##  3 mortdue_woe    0.263    0.265      0.990 3.22e-  1
##  4 value_woe      0.797    0.108      7.40  1.38e- 13
##  5 job_woe        0.876    0.168      5.21  1.86e-  7
##  6 yoj_woe        1.02     0.198      5.14  2.73e-  7
##  7 derog_woe      0.741    0.0919     8.06  7.54e- 16
##  8 delinq_woe     0.951    0.0705    13.5   1.54e- 41
##  9 clage_woe      1.04     0.117      8.93  4.27e- 19
## 10 ninq_woe       0.495    0.118      4.20  2.68e-  5
## 11 clno_woe       1.12     0.166      6.74  1.63e- 11
## 12 debtinc_woe    0.925    0.0378    24.5   2.30e-132</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   -1.40     0.0571   -24.4   1.07e-131
## 2 mortdue_woe    0.263    0.265      0.990 3.22e-  1</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<<<<<<< HEAD
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_raw</span>, df_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span></code></pre></div>
=======
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_raw</span>, df_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span></code></pre></div>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<p><img src="risk3r_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.684 0.917  3.52 0.835</code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_raw</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.638 0.905  3.28 0.809</code></pre>
</div>
<div id="satellite-model" class="section level3">
<h3 class="hasAnchor">
<a href="#satellite-model" class="anchor"></a>Satellite Model</h3>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># rf simple</span>
<span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span><span class="va">bad_good</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, do.trace <span class="op">=</span> <span class="cn">TRUE</span>, ntree <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></code></pre></div>
<pre><code>## ntree      OOB      1      2
##     1:  13.20%  6.58% 40.20%
##     2:  13.00%  6.28% 40.77%
##     3:  13.41%  6.51% 41.98%
##     4:  14.29%  7.07% 44.22%
##     5:  13.29%  6.24% 42.45%
##     6:  12.89%  5.74% 42.22%
##     7:  12.40%  5.41% 41.07%
##     8:  12.52%  5.72% 40.30%
##     9:  12.20%  5.52% 39.60%
##    10:  12.08%  5.31% 39.90%
##    11:  11.77%  5.02% 39.34%
##    12:  11.79%  4.97% 39.56%
##    13:  11.72%  4.99% 39.15%
##    14:  11.33%  4.87% 37.64%
##    15:  11.23%  4.75% 37.64%
##    16:  11.36%  4.72% 38.44%
##    17:  10.98%  4.57% 37.06%
##    18:  10.71%  4.51% 35.97%
##    19:  10.93%  4.63% 36.57%
##    20:  10.79%  4.57% 36.09%
##    21:  10.50%  4.36% 35.48%
##    22:  10.45%  4.33% 35.36%
##    23:  10.52%  4.42% 35.36%
##    24:  10.40%  4.48% 34.51%
##    25:  10.50%  4.48% 34.99%
##    26:  10.67%  4.45% 35.97%
##    27:  10.16%  4.15% 34.63%
##    28:  10.50%  4.39% 35.36%
##    29:  10.62%  4.39% 35.97%
##    30:  10.38%  4.24% 35.36%
##    31:  10.33%  4.24% 35.12%
##    32:   9.95%  4.03% 34.02%
##    33:  10.12%  4.06% 34.75%
##    34:  10.16%  4.06% 34.99%
##    35:  10.04%  3.94% 34.87%
##    36:  10.33%  4.00% 36.09%
##    37:  10.16%  4.06% 34.99%
##    38:  10.02%  3.85% 35.12%
##    39:  10.12%  3.94% 35.24%
##    40:  10.16%  4.09% 34.87%
##    41:   9.97%  3.88% 34.75%
##    42:   9.88%  3.94% 34.02%
##    43:   9.88%  3.97% 33.90%
##    44:   9.88%  4.00% 33.78%
##    45:   9.80%  3.88% 33.90%
##    46:   9.80%  3.88% 33.90%
##    47:   9.97%  3.94% 34.51%
##    48:   9.80%  3.85% 34.02%
##    49:   9.92%  4.00% 34.02%
##    50:   9.85%  3.85% 34.26%
##    51:   9.76%  3.82% 33.90%
##    52:   9.83%  3.70% 34.75%
##    53:  10.07%  3.94% 34.99%
##    54:   9.78%  3.73% 34.39%
##    55:   9.88%  3.73% 34.87%
##    56:   9.95%  3.82% 34.87%
##    57:   9.85%  3.82% 34.39%
##    58:   9.85%  3.76% 34.63%
##    59:   9.76%  3.58% 34.87%
##    60:   9.76%  3.67% 34.51%
##    61:   9.97%  3.88% 34.75%
##    62:   9.85%  3.82% 34.39%
##    63:   9.85%  3.88% 34.14%
##    64:   9.95%  3.91% 34.51%
##    65:   9.85%  3.82% 34.39%
##    66:   9.80%  3.79% 34.26%
##    67:   9.95%  3.79% 34.99%
##    68:   9.88%  3.73% 34.87%
##    69:   9.83%  3.76% 34.51%
##    70:   9.64%  3.64% 34.02%
##    71:   9.78%  3.76% 34.26%
##    72:   9.92%  3.79% 34.87%
##    73:   9.80%  3.67% 34.75%
##    74:   9.80%  3.79% 34.26%
##    75:   9.88%  3.88% 34.26%
##    76:   9.66%  3.79% 33.54%
##    77:   9.78%  3.85% 33.90%
##    78:   9.85%  3.88% 34.14%
##    79:   9.66%  3.79% 33.54%
##    80:   9.78%  3.88% 33.78%
##    81:   9.78%  3.94% 33.54%
##    82:   9.88%  4.00% 33.78%
##    83:   9.64%  3.82% 33.29%
##    84:   9.76%  3.88% 33.66%
##    85:   9.76%  3.85% 33.78%
##    86:   9.71%  3.82% 33.66%
##    87:   9.73%  3.88% 33.54%
##    88:   9.73%  3.88% 33.54%
##    89:   9.68%  3.76% 33.78%
##    90:   9.73%  3.82% 33.78%
##    91:   9.71%  3.82% 33.66%
##    92:   9.73%  3.79% 33.90%
##    93:   9.71%  3.76% 33.90%
##    94:   9.59%  3.73% 33.41%
##    95:   9.73%  3.73% 34.14%
##    96:   9.80%  3.76% 34.39%
##    97:   9.76%  3.82% 33.90%
##    98:   9.71%  3.70% 34.14%
##    99:   9.78%  3.79% 34.14%
##   100:   9.71%  3.76% 33.90%
##   101:   9.71%  3.76% 33.90%
##   102:   9.68%  3.70% 34.02%
##   103:   9.64%  3.70% 33.78%
##   104:   9.56%  3.70% 33.41%
##   105:   9.66%  3.76% 33.66%
##   106:   9.64%  3.76% 33.54%
##   107:   9.54%  3.73% 33.17%
##   108:   9.54%  3.70% 33.29%
##   109:   9.44%  3.64% 33.05%
##   110:   9.49%  3.73% 32.93%
##   111:   9.52%  3.70% 33.17%
##   112:   9.76%  3.82% 33.90%
##   113:   9.56%  3.76% 33.17%
##   114:   9.61%  3.79% 33.29%
##   115:   9.49%  3.76% 32.81%
##   116:   9.56%  3.82% 32.93%
##   117:   9.56%  3.76% 33.17%
##   118:   9.64%  3.88% 33.05%
##   119:   9.68%  3.82% 33.54%
##   120:   9.64%  3.82% 33.29%
##   121:   9.61%  3.76% 33.41%
##   122:   9.59%  3.79% 33.17%
##   123:   9.56%  3.76% 33.17%
##   124:   9.64%  3.79% 33.41%
##   125:   9.56%  3.76% 33.17%
##   126:   9.56%  3.70% 33.41%
##   127:   9.61%  3.73% 33.54%
##   128:   9.64%  3.82% 33.29%
##   129:   9.64%  3.79% 33.41%
##   130:   9.71%  3.85% 33.54%
##   131:   9.61%  3.73% 33.54%
##   132:   9.73%  3.88% 33.54%
##   133:   9.59%  3.88% 32.81%
##   134:   9.64%  3.82% 33.29%
##   135:   9.66%  3.82% 33.41%
##   136:   9.71%  3.82% 33.66%
##   137:   9.59%  3.79% 33.17%
##   138:   9.59%  3.76% 33.29%
##   139:   9.56%  3.76% 33.17%
##   140:   9.54%  3.76% 33.05%
##   141:   9.54%  3.70% 33.29%
##   142:   9.56%  3.73% 33.29%
##   143:   9.44%  3.64% 33.05%
##   144:   9.49%  3.64% 33.29%
##   145:   9.49%  3.61% 33.41%
##   146:   9.52%  3.64% 33.41%
##   147:   9.52%  3.61% 33.54%
##   148:   9.59%  3.64% 33.78%
##   149:   9.56%  3.67% 33.54%
##   150:   9.49%  3.58% 33.54%
##   151:   9.54%  3.61% 33.66%
##   152:   9.52%  3.64% 33.41%
##   153:   9.52%  3.61% 33.54%
##   154:   9.52%  3.64% 33.41%
##   155:   9.61%  3.64% 33.90%
##   156:   9.59%  3.67% 33.66%
##   157:   9.54%  3.70% 33.29%
##   158:   9.44%  3.61% 33.17%
##   159:   9.49%  3.61% 33.41%
##   160:   9.49%  3.64% 33.29%
##   161:   9.52%  3.70% 33.17%
##   162:   9.42%  3.64% 32.93%
##   163:   9.42%  3.64% 32.93%
##   164:   9.42%  3.64% 32.93%
##   165:   9.40%  3.58% 33.05%
##   166:   9.40%  3.64% 32.81%
##   167:   9.42%  3.64% 32.93%
##   168:   9.37%  3.64% 32.69%
##   169:   9.52%  3.73% 33.05%
##   170:   9.49%  3.67% 33.17%
##   171:   9.52%  3.70% 33.17%
##   172:   9.42%  3.70% 32.69%
##   173:   9.44%  3.70% 32.81%
##   174:   9.44%  3.67% 32.93%
##   175:   9.52%  3.70% 33.17%
##   176:   9.56%  3.76% 33.17%
##   177:   9.49%  3.64% 33.29%
##   178:   9.54%  3.64% 33.54%
##   179:   9.44%  3.67% 32.93%
##   180:   9.40%  3.61% 32.93%
##   181:   9.44%  3.70% 32.81%
##   182:   9.52%  3.70% 33.17%
##   183:   9.47%  3.73% 32.81%
##   184:   9.59%  3.82% 33.05%
##   185:   9.59%  3.79% 33.17%
##   186:   9.49%  3.73% 32.93%
##   187:   9.56%  3.76% 33.17%
##   188:   9.52%  3.76% 32.93%
##   189:   9.44%  3.67% 32.93%
##   190:   9.47%  3.70% 32.93%
##   191:   9.54%  3.73% 33.17%
##   192:   9.47%  3.73% 32.81%
##   193:   9.54%  3.73% 33.17%
##   194:   9.44%  3.73% 32.69%
##   195:   9.44%  3.73% 32.69%
##   196:   9.47%  3.73% 32.81%
##   197:   9.40%  3.67% 32.69%
##   198:   9.40%  3.64% 32.81%
##   199:   9.37%  3.67% 32.56%
##   200:   9.44%  3.73% 32.69%
##   201:   9.44%  3.70% 32.81%
##   202:   9.42%  3.67% 32.81%
##   203:   9.42%  3.67% 32.81%
##   204:   9.47%  3.70% 32.93%
##   205:   9.44%  3.73% 32.69%
##   206:   9.40%  3.67% 32.69%
##   207:   9.44%  3.70% 32.81%
##   208:   9.42%  3.67% 32.81%
##   209:   9.44%  3.70% 32.81%
##   210:   9.40%  3.67% 32.69%
##   211:   9.30%  3.64% 32.32%
##   212:   9.40%  3.70% 32.56%
##   213:   9.40%  3.73% 32.44%
##   214:   9.44%  3.73% 32.69%
##   215:   9.44%  3.73% 32.69%
##   216:   9.37%  3.70% 32.44%
##   217:   9.44%  3.67% 32.93%
##   218:   9.44%  3.67% 32.93%
##   219:   9.40%  3.64% 32.81%
##   220:   9.42%  3.64% 32.93%
##   221:   9.35%  3.61% 32.69%
##   222:   9.32%  3.58% 32.69%
##   223:   9.40%  3.61% 32.93%
##   224:   9.35%  3.64% 32.56%
##   225:   9.37%  3.61% 32.81%
##   226:   9.35%  3.61% 32.69%
##   227:   9.37%  3.61% 32.81%
##   228:   9.42%  3.61% 33.05%
##   229:   9.37%  3.58% 32.93%
##   230:   9.44%  3.64% 33.05%
##   231:   9.37%  3.58% 32.93%
##   232:   9.42%  3.61% 33.05%
##   233:   9.47%  3.64% 33.17%
##   234:   9.37%  3.61% 32.81%
##   235:   9.42%  3.58% 33.17%
##   236:   9.32%  3.55% 32.81%
##   237:   9.42%  3.61% 33.05%
##   238:   9.42%  3.61% 33.05%
##   239:   9.40%  3.61% 32.93%
##   240:   9.44%  3.61% 33.17%
##   241:   9.47%  3.61% 33.29%
##   242:   9.49%  3.61% 33.41%
##   243:   9.47%  3.61% 33.29%
##   244:   9.49%  3.58% 33.54%
##   245:   9.44%  3.58% 33.29%
##   246:   9.49%  3.61% 33.41%
##   247:   9.52%  3.64% 33.41%
##   248:   9.52%  3.61% 33.54%
##   249:   9.47%  3.61% 33.29%
##   250:   9.52%  3.61% 33.54%
##   251:   9.54%  3.64% 33.54%
##   252:   9.52%  3.64% 33.41%
##   253:   9.56%  3.67% 33.54%
##   254:   9.54%  3.64% 33.54%
##   255:   9.56%  3.67% 33.54%
##   256:   9.52%  3.64% 33.41%
##   257:   9.52%  3.67% 33.29%
##   258:   9.54%  3.67% 33.41%
##   259:   9.54%  3.64% 33.54%
##   260:   9.56%  3.67% 33.54%
##   261:   9.54%  3.67% 33.41%
##   262:   9.49%  3.67% 33.17%
##   263:   9.52%  3.64% 33.41%
##   264:   9.49%  3.64% 33.29%
##   265:   9.47%  3.64% 33.17%
##   266:   9.47%  3.64% 33.17%
##   267:   9.52%  3.70% 33.17%
##   268:   9.52%  3.64% 33.41%
##   269:   9.52%  3.67% 33.29%
##   270:   9.49%  3.70% 33.05%
##   271:   9.54%  3.64% 33.54%
##   272:   9.54%  3.67% 33.41%
##   273:   9.61%  3.70% 33.66%
##   274:   9.54%  3.67% 33.41%
##   275:   9.47%  3.67% 33.05%
##   276:   9.49%  3.67% 33.17%
##   277:   9.54%  3.67% 33.41%
##   278:   9.52%  3.70% 33.17%
##   279:   9.54%  3.73% 33.17%
##   280:   9.49%  3.67% 33.17%
##   281:   9.47%  3.70% 32.93%
##   282:   9.49%  3.64% 33.29%
##   283:   9.42%  3.70% 32.69%
##   284:   9.49%  3.73% 32.93%
##   285:   9.37%  3.67% 32.56%
##   286:   9.44%  3.70% 32.81%
##   287:   9.44%  3.70% 32.81%
##   288:   9.44%  3.67% 32.93%
##   289:   9.42%  3.67% 32.81%
##   290:   9.35%  3.64% 32.56%
##   291:   9.44%  3.67% 32.93%
##   292:   9.47%  3.67% 33.05%
##   293:   9.42%  3.67% 32.81%
##   294:   9.40%  3.64% 32.81%
##   295:   9.42%  3.67% 32.81%
##   296:   9.47%  3.64% 33.17%
##   297:   9.44%  3.61% 33.17%
##   298:   9.44%  3.61% 33.17%
##   299:   9.44%  3.61% 33.17%
##   300:   9.49%  3.61% 33.41%
##   301:   9.54%  3.70% 33.29%
##   302:   9.49%  3.64% 33.29%
##   303:   9.56%  3.67% 33.54%
##   304:   9.59%  3.70% 33.54%
##   305:   9.52%  3.64% 33.41%
##   306:   9.54%  3.70% 33.29%
##   307:   9.56%  3.70% 33.41%
##   308:   9.49%  3.64% 33.29%
##   309:   9.49%  3.64% 33.29%
##   310:   9.49%  3.58% 33.54%
##   311:   9.56%  3.64% 33.66%
##   312:   9.52%  3.61% 33.54%
##   313:   9.49%  3.55% 33.66%
##   314:   9.49%  3.55% 33.66%
##   315:   9.52%  3.61% 33.54%
##   316:   9.42%  3.55% 33.29%
##   317:   9.52%  3.52% 33.90%
##   318:   9.44%  3.52% 33.54%
##   319:   9.40%  3.52% 33.29%
##   320:   9.42%  3.55% 33.29%
##   321:   9.40%  3.58% 33.05%
##   322:   9.47%  3.55% 33.54%
##   323:   9.42%  3.55% 33.29%
##   324:   9.49%  3.58% 33.54%
##   325:   9.52%  3.64% 33.41%
##   326:   9.47%  3.58% 33.41%
##   327:   9.52%  3.58% 33.66%
##   328:   9.52%  3.58% 33.66%
##   329:   9.52%  3.55% 33.78%
##   330:   9.54%  3.58% 33.78%
##   331:   9.56%  3.61% 33.78%
##   332:   9.56%  3.61% 33.78%
##   333:   9.52%  3.55% 33.78%
##   334:   9.54%  3.58% 33.78%
##   335:   9.59%  3.61% 33.90%
##   336:   9.64%  3.67% 33.90%
##   337:   9.59%  3.67% 33.66%
##   338:   9.56%  3.64% 33.66%
##   339:   9.56%  3.64% 33.66%
##   340:   9.54%  3.61% 33.66%
##   341:   9.61%  3.61% 34.02%
##   342:   9.61%  3.61% 34.02%
##   343:   9.64%  3.67% 33.90%
##   344:   9.61%  3.67% 33.78%
##   345:   9.59%  3.64% 33.78%
##   346:   9.59%  3.61% 33.90%
##   347:   9.66%  3.70% 33.90%
##   348:   9.64%  3.67% 33.90%
##   349:   9.66%  3.70% 33.90%
##   350:   9.64%  3.70% 33.78%
##   351:   9.64%  3.70% 33.78%
##   352:   9.73%  3.76% 34.02%
##   353:   9.64%  3.73% 33.66%
##   354:   9.68%  3.76% 33.78%
##   355:   9.66%  3.73% 33.78%
##   356:   9.61%  3.70% 33.66%
##   357:   9.64%  3.70% 33.78%
##   358:   9.71%  3.73% 34.02%
##   359:   9.68%  3.76% 33.78%
##   360:   9.66%  3.76% 33.66%
##   361:   9.68%  3.76% 33.78%
##   362:   9.68%  3.73% 33.90%
##   363:   9.61%  3.70% 33.66%
##   364:   9.61%  3.73% 33.54%
##   365:   9.66%  3.70% 33.90%
##   366:   9.59%  3.70% 33.54%
##   367:   9.61%  3.70% 33.66%
##   368:   9.52%  3.64% 33.41%
##   369:   9.56%  3.67% 33.54%
##   370:   9.64%  3.76% 33.54%
##   371:   9.54%  3.67% 33.41%
##   372:   9.71%  3.76% 33.90%
##   373:   9.66%  3.73% 33.78%
##   374:   9.64%  3.70% 33.78%
##   375:   9.66%  3.70% 33.90%
##   376:   9.68%  3.73% 33.90%
##   377:   9.66%  3.73% 33.78%
##   378:   9.64%  3.73% 33.66%
##   379:   9.64%  3.73% 33.66%
##   380:   9.64%  3.73% 33.66%
##   381:   9.66%  3.73% 33.78%
##   382:   9.71%  3.76% 33.90%
##   383:   9.68%  3.73% 33.90%
##   384:   9.64%  3.70% 33.78%
##   385:   9.59%  3.67% 33.66%
##   386:   9.64%  3.67% 33.90%
##   387:   9.64%  3.67% 33.90%
##   388:   9.64%  3.64% 34.02%
##   389:   9.66%  3.70% 33.90%
##   390:   9.64%  3.70% 33.78%
##   391:   9.64%  3.67% 33.90%
##   392:   9.61%  3.64% 33.90%
##   393:   9.56%  3.61% 33.78%
##   394:   9.59%  3.61% 33.90%
##   395:   9.61%  3.61% 34.02%
##   396:   9.64%  3.61% 34.14%
##   397:   9.66%  3.61% 34.26%
##   398:   9.59%  3.64% 33.78%
##   399:   9.68%  3.61% 34.39%
##   400:   9.66%  3.64% 34.14%
##   401:   9.61%  3.61% 34.02%
##   402:   9.61%  3.61% 34.02%
##   403:   9.56%  3.61% 33.78%
##   404:   9.64%  3.64% 34.02%
##   405:   9.61%  3.61% 34.02%
##   406:   9.61%  3.64% 33.90%
##   407:   9.61%  3.61% 34.02%
##   408:   9.56%  3.61% 33.78%
##   409:   9.54%  3.58% 33.78%
##   410:   9.59%  3.67% 33.66%
##   411:   9.59%  3.64% 33.78%
##   412:   9.59%  3.61% 33.90%
##   413:   9.61%  3.64% 33.90%
##   414:   9.56%  3.61% 33.78%
##   415:   9.52%  3.58% 33.66%
##   416:   9.56%  3.61% 33.78%
##   417:   9.61%  3.64% 33.90%
##   418:   9.56%  3.61% 33.78%
##   419:   9.49%  3.61% 33.41%
##   420:   9.64%  3.70% 33.78%
##   421:   9.52%  3.64% 33.41%
##   422:   9.54%  3.64% 33.54%
##   423:   9.52%  3.61% 33.54%
##   424:   9.49%  3.61% 33.41%
##   425:   9.54%  3.61% 33.66%
##   426:   9.54%  3.61% 33.66%
##   427:   9.54%  3.61% 33.66%
##   428:   9.59%  3.61% 33.90%
##   429:   9.52%  3.58% 33.66%
##   430:   9.61%  3.64% 33.90%
##   431:   9.56%  3.64% 33.66%
##   432:   9.59%  3.61% 33.90%
##   433:   9.54%  3.58% 33.78%
##   434:   9.49%  3.55% 33.66%
##   435:   9.49%  3.55% 33.66%
##   436:   9.56%  3.58% 33.90%
##   437:   9.52%  3.58% 33.66%
##   438:   9.54%  3.58% 33.78%
##   439:   9.61%  3.61% 34.02%
##   440:   9.59%  3.64% 33.78%
##   441:   9.56%  3.55% 34.02%
##   442:   9.54%  3.58% 33.78%
##   443:   9.47%  3.52% 33.66%
##   444:   9.49%  3.55% 33.66%
##   445:   9.56%  3.58% 33.90%
##   446:   9.52%  3.55% 33.78%
##   447:   9.47%  3.52% 33.66%
##   448:   9.47%  3.52% 33.66%
##   449:   9.49%  3.52% 33.78%
##   450:   9.47%  3.49% 33.78%
##   451:   9.52%  3.49% 34.02%
##   452:   9.49%  3.52% 33.78%
##   453:   9.49%  3.52% 33.78%
##   454:   9.49%  3.52% 33.78%
##   455:   9.47%  3.52% 33.66%
##   456:   9.47%  3.49% 33.78%
##   457:   9.47%  3.49% 33.78%
##   458:   9.37%  3.46% 33.41%
##   459:   9.40%  3.46% 33.54%
##   460:   9.42%  3.49% 33.54%
##   461:   9.47%  3.46% 33.90%
##   462:   9.44%  3.46% 33.78%
##   463:   9.49%  3.46% 34.02%
##   464:   9.47%  3.46% 33.90%
##   465:   9.44%  3.46% 33.78%
##   466:   9.44%  3.46% 33.78%
##   467:   9.49%  3.46% 34.02%
##   468:   9.49%  3.49% 33.90%
##   469:   9.47%  3.49% 33.78%
##   470:   9.44%  3.49% 33.66%
##   471:   9.47%  3.49% 33.78%
##   472:   9.49%  3.49% 33.90%
##   473:   9.49%  3.49% 33.90%
##   474:   9.52%  3.49% 34.02%
##   475:   9.49%  3.49% 33.90%
##   476:   9.47%  3.49% 33.78%
##   477:   9.47%  3.52% 33.66%
##   478:   9.40%  3.49% 33.41%
##   479:   9.44%  3.52% 33.54%
##   480:   9.42%  3.52% 33.41%
##   481:   9.49%  3.55% 33.66%
##   482:   9.47%  3.55% 33.54%
##   483:   9.44%  3.49% 33.66%
##   484:   9.54%  3.55% 33.90%
##   485:   9.47%  3.55% 33.54%
##   486:   9.49%  3.55% 33.66%
##   487:   9.44%  3.49% 33.66%
##   488:   9.40%  3.46% 33.54%
##   489:   9.44%  3.52% 33.54%
##   490:   9.44%  3.52% 33.54%
##   491:   9.47%  3.55% 33.54%
##   492:   9.42%  3.49% 33.54%
##   493:   9.47%  3.52% 33.66%
##   494:   9.47%  3.55% 33.54%
##   495:   9.47%  3.55% 33.54%
##   496:   9.49%  3.55% 33.66%
##   497:   9.49%  3.52% 33.78%
##   498:   9.47%  3.58% 33.41%
##   499:   9.40%  3.52% 33.29%
##   500:   9.42%  3.55% 33.29%</code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/metrics.html">metrics</a></span><span class="op">(</span>
  <span class="va">train_data</span><span class="op">$</span><span class="va">bad_good</span>, 
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_rf</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
<<<<<<< HEAD
## 1 0.790 0.954  4.94 0.908</code></pre>
=======
## 1 0.790 0.954  4.92 0.908</code></pre>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
</div>
<div id="feature-selection-via-glmnet" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-glmnet" class="anchor"></a>Feature selection via glmnet</h3>
<p>From <a href="https://glmnet.stanford.edu/articles/glmnet.html" class="uri">https://glmnet.stanford.edu/articles/glmnet.html</a></p>
<p>There 2 option for <code>S</code>: <code>lambda.min</code> and <code>lambda.1se</code> , this last option you have a more regularized model.</p>
<p>This wrapper around the glmnet package take a model as input, then return the model with the variables non zero from the <code><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet::cv.glmnet()</a></code> function according with the selected <code>S</code> option. This function reorder the variables in the same order the coefficient in the glmnet model turn to non zero (check the plots when run this funtion).</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsglmnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_glmnet.html">featsel_glmnet</a></span><span class="op">(</span><span class="va">model_raw</span>, S <span class="op">=</span> <span class="st">"lambda.1se"</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Training
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 1/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 2/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 3/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 4/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 5/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |======================================================================| 100%
## Fold: 6/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 7/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 8/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 9/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%
## Fold: 10/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |======================================================================| 100%</code></pre>
<p><img src="risk3r_files/figure-html/unnamed-chunk-26-1.png" width="700"><img src="risk3r_files/figure-html/unnamed-chunk-26-2.png" width="700"><img src="risk3r_files/figure-html/unnamed-chunk-26-3.png" width="700"></p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    term        estimate std.error statistic   p.value
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)   -1.39     0.0571    -24.4  1.12e-131
##  2 debtinc_woe    0.925    0.0378     24.5  2.34e-132
##  3 delinq_woe     0.949    0.0704     13.5  1.96e- 41
##  4 value_woe      0.821    0.106       7.74 1.02e- 14
##  5 derog_woe      0.746    0.0917      8.13 4.19e- 16
##  6 clage_woe      1.05     0.116       9.07 1.22e- 19
##  7 clno_woe       1.12     0.166       6.76 1.41e- 11
##  8 ninq_woe       0.494    0.118       4.19 2.80e-  5
##  9 yoj_woe        0.994    0.196       5.06 4.16e-  7
## 10 loan_woe       0.535    0.140       3.82 1.32e-  4
## 11 job_woe        0.889    0.168       5.30 1.16e-  7</code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    -1.39    0.0571     -24.4 1.12e-131</code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<<<<<<< HEAD
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_fsglmnet</span>, df_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span></code></pre></div>
=======
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_fsglmnet</span>, df_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span></code></pre></div>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<p><img src="risk3r_files/figure-html/unnamed-chunk-26-4.png" width="700"></p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.686 0.917  3.50 0.834</code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsglmnet</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.638 0.904  3.37 0.809</code></pre>
</div>
<div id="feature-selection-via-setpwise-forward" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-setpwise-forward" class="anchor"></a>Feature selection via Setpwise forward</h3>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsstep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_stepforward.html">featsel_stepforward</a></span><span class="op">(</span><span class="va">model_raw</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Start:  AIC=4145.55
## bad_good ~ 1
## 
##               Df Deviance    AIC
## + debtinc_woe  1   2913.0 2917.0
## + delinq_woe   1   3741.1 3745.1
## + value_woe    1   3902.0 3906.0
## + derog_woe    1   3906.8 3910.8
## + clage_woe    1   3994.4 3998.4
## + ninq_woe     1   3994.6 3998.6
## + loan_woe     1   4044.0 4048.0
## + job_woe      1   4071.5 4075.5
## + clno_woe     1   4071.8 4075.8
## + yoj_woe      1   4088.4 4092.4
## + mortdue_woe  1   4111.2 4115.2
## &lt;none&gt;             4143.6 4145.6
## 
## Step:  AIC=2916.95
## bad_good ~ debtinc_woe
## 
##               Df Deviance    AIC
## + delinq_woe   1   2699.8 2705.8
## + derog_woe    1   2782.2 2788.2
## + clage_woe    1   2793.7 2799.7
## + value_woe    1   2794.3 2800.3
## + clno_woe     1   2859.6 2865.6
## + yoj_woe      1   2864.7 2870.7
## + ninq_woe     1   2873.4 2879.4
## + job_woe      1   2875.1 2881.1
## + loan_woe     1   2891.1 2897.1
## + mortdue_woe  1   2896.6 2902.6
## &lt;none&gt;             2913.0 2917.0
## - debtinc_woe  1   4143.6 4145.6
## 
## Step:  AIC=2705.78
## bad_good ~ debtinc_woe + delinq_woe
## 
##               Df Deviance    AIC
## + clage_woe    1   2557.0 2565.0
## + value_woe    1   2593.0 2601.0
## + derog_woe    1   2612.7 2620.7
## + clno_woe     1   2633.0 2641.0
## + yoj_woe      1   2648.1 2656.1
## + job_woe      1   2663.8 2671.8
## + ninq_woe     1   2667.6 2675.6
## + loan_woe     1   2677.8 2685.8
## + mortdue_woe  1   2679.2 2687.2
## &lt;none&gt;             2699.8 2705.8
## - delinq_woe   1   2913.0 2917.0
## - debtinc_woe  1   3741.1 3745.1
## 
## Step:  AIC=2565
## bad_good ~ debtinc_woe + delinq_woe + clage_woe
## 
##               Df Deviance    AIC
## + value_woe    1   2468.5 2478.5
## + derog_woe    1   2472.3 2482.3
## + clno_woe     1   2504.2 2514.2
## + yoj_woe      1   2519.8 2529.8
## + job_woe      1   2523.4 2533.4
## + ninq_woe     1   2531.3 2541.3
## + loan_woe     1   2543.6 2553.6
## + mortdue_woe  1   2545.9 2555.9
## &lt;none&gt;             2557.0 2565.0
## - clage_woe    1   2699.8 2705.8
## - delinq_woe   1   2793.7 2799.7
## - debtinc_woe  1   3556.8 3562.8
## 
## Step:  AIC=2478.54
## bad_good ~ debtinc_woe + delinq_woe + clage_woe + value_woe
## 
##               Df Deviance    AIC
## + derog_woe    1   2385.8 2397.8
## + clno_woe     1   2423.3 2435.3
## + yoj_woe      1   2428.6 2440.6
## + job_woe      1   2433.7 2445.7
## + ninq_woe     1   2438.6 2450.6
## + loan_woe     1   2458.5 2470.5
## + mortdue_woe  1   2466.2 2478.2
## &lt;none&gt;             2468.5 2478.5
## - value_woe    1   2557.0 2565.0
## - clage_woe    1   2593.0 2601.0
## - delinq_woe   1   2691.3 2699.3
## - debtinc_woe  1   3382.3 3390.3
## 
## Step:  AIC=2397.82
## bad_good ~ debtinc_woe + delinq_woe + clage_woe + value_woe + 
##     derog_woe
## 
##               Df Deviance    AIC
## + clno_woe     1   2338.5 2352.5
## + yoj_woe      1   2351.3 2365.3
## + job_woe      1   2356.9 2370.9
## + ninq_woe     1   2368.5 2382.5
## + loan_woe     1   2372.6 2386.6
## &lt;none&gt;             2385.8 2397.8
## + mortdue_woe  1   2384.6 2398.6
## - derog_woe    1   2468.5 2478.5
## - value_woe    1   2472.3 2482.3
## - clage_woe    1   2507.6 2517.6
## - delinq_woe   1   2566.3 2576.3
## - debtinc_woe  1   3252.4 3262.4
## 
## Step:  AIC=2352.54
## bad_good ~ debtinc_woe + delinq_woe + clage_woe + value_woe + 
##     derog_woe + clno_woe
## 
##               Df Deviance    AIC
## + yoj_woe      1   2308.1 2324.1
## + job_woe      1   2308.2 2324.2
## + ninq_woe     1   2320.7 2336.7
## + loan_woe     1   2325.7 2341.7
## &lt;none&gt;             2338.5 2352.5
## + mortdue_woe  1   2337.4 2353.4
## - clno_woe     1   2385.8 2397.8
## - value_woe    1   2417.1 2429.1
## - derog_woe    1   2423.3 2435.3
## - clage_woe    1   2448.5 2460.5
## - delinq_woe   1   2527.4 2539.4
## - debtinc_woe  1   3195.5 3207.5
## 
## Step:  AIC=2324.06
## bad_good ~ debtinc_woe + delinq_woe + clage_woe + value_woe + 
##     derog_woe + clno_woe + yoj_woe
## 
##               Df Deviance    AIC
## + job_woe      1   2276.6 2294.6
## + ninq_woe     1   2292.1 2310.1
## + loan_woe     1   2297.6 2315.6
## + mortdue_woe  1   2305.2 2323.2
## &lt;none&gt;             2308.1 2324.1
## - yoj_woe      1   2338.5 2352.5
## - clno_woe     1   2351.3 2365.3
## - derog_woe    1   2386.7 2400.7
## - value_woe    1   2388.7 2402.7
## - clage_woe    1   2406.6 2420.6
## - delinq_woe   1   2499.7 2513.7
## - debtinc_woe  1   3160.3 3174.3
## 
## Step:  AIC=2294.56
## bad_good ~ debtinc_woe + delinq_woe + clage_woe + value_woe + 
##     derog_woe + clno_woe + yoj_woe + job_woe
## 
##               Df Deviance    AIC
## + ninq_woe     1   2262.7 2282.7
## + loan_woe     1   2265.4 2285.4
## &lt;none&gt;             2276.6 2294.6
## + mortdue_woe  1   2274.9 2294.9
## - job_woe      1   2308.1 2324.1
## - yoj_woe      1   2308.2 2324.2
## - clno_woe     1   2320.8 2336.8
## - derog_woe    1   2349.8 2365.8
## - value_woe    1   2357.5 2373.5
## - clage_woe    1   2371.9 2387.9
## - delinq_woe   1   2469.9 2485.9
## - debtinc_woe  1   3106.8 3122.8
## 
## Step:  AIC=2282.73
## bad_good ~ debtinc_woe + delinq_woe + clage_woe + value_woe + 
##     derog_woe + clno_woe + yoj_woe + job_woe + ninq_woe
## 
##               Df Deviance    AIC
## + loan_woe     1   2248.2 2270.2
## &lt;none&gt;             2262.7 2282.7
## + mortdue_woe  1   2260.9 2282.9
## - ninq_woe     1   2276.6 2294.6
## - job_woe      1   2292.1 2310.1
## - yoj_woe      1   2292.7 2310.7
## - clno_woe     1   2307.9 2325.9
## - derog_woe    1   2325.9 2343.9
## - value_woe    1   2345.5 2363.5
## - clage_woe    1   2355.0 2373.0
## - delinq_woe   1   2452.0 2470.0
## - debtinc_woe  1   3042.9 3060.9
## 
## Step:  AIC=2270.2
## bad_good ~ debtinc_woe + delinq_woe + clage_woe + value_woe + 
##     derog_woe + clno_woe + yoj_woe + job_woe + ninq_woe + loan_woe
## 
##               Df Deviance    AIC
## &lt;none&gt;             2248.2 2270.2
## + mortdue_woe  1   2247.2 2271.2
## - loan_woe     1   2262.7 2282.7
## - ninq_woe     1   2265.4 2285.4
## - yoj_woe      1   2275.0 2295.0
## - job_woe      1   2278.1 2298.1
## - clno_woe     1   2293.9 2313.9
## - derog_woe    1   2313.7 2333.7
## - value_woe    1   2327.3 2347.3
## - clage_woe    1   2335.4 2355.4
## - delinq_woe   1   2436.0 2456.0
## - debtinc_woe  1   2974.5 2994.5</code></pre>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    term        estimate std.error statistic   p.value
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)   -1.39     0.0571    -24.4  1.12e-131
##  2 debtinc_woe    0.925    0.0378     24.5  2.34e-132
##  3 delinq_woe     0.949    0.0704     13.5  1.96e- 41
##  4 clage_woe      1.05     0.116       9.07 1.22e- 19
##  5 value_woe      0.821    0.106       7.74 1.02e- 14
##  6 derog_woe      0.746    0.0917      8.13 4.19e- 16
##  7 clno_woe       1.12     0.166       6.76 1.41e- 11
##  8 yoj_woe        0.994    0.196       5.06 4.16e-  7
##  9 job_woe        0.889    0.168       5.30 1.16e-  7
## 10 ninq_woe       0.494    0.118       4.19 2.80e-  5
## 11 loan_woe       0.535    0.140       3.82 1.32e-  4</code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    -1.39    0.0571     -24.4 1.12e-131</code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<<<<<<< HEAD
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span></code></pre></div>
=======
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span></code></pre></div>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<p><img src="risk3r_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.686 0.917  3.50 0.834</code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsstep</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.638 0.904  3.37 0.809</code></pre>
</div>
<div id="feature-selection-via-repetitive-round-of-drop-out-loss" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-repetitive-round-of-drop-out-loss" class="anchor"></a>Feature selection via repetitive round of drop out loss</h3>
<p>From <a href="https://ema.drwhy.ai/featureImportance.html" class="uri">https://ema.drwhy.ai/featureImportance.html</a></p>
<p>The <code>stat = "min"</code> option give the most simpler model because It’more strict: If any iteration the loss increase then the variable is removed. You can choose between <code><a href="https://rdrr.io/r/base/c.html">c("q25", "mean", "median")</a></code></p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_lss_prmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_loss_function_permutations.html">featsel_loss_function_permutations</a></span><span class="op">(</span>
  <span class="va">model_raw</span>, 
  stat <span class="op">=</span><span class="st">"min"</span>,
  B <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, <span class="st">"plots"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="fu">THEME</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span>

<<<<<<< HEAD
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, df_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span>
=======
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, df_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f

<span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span>
<span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
</div>
<div id="comparing-models" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-models" class="anchor"></a>Comparing models</h3>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">model_raw</span>, 
  <span class="va">model_fsstep</span>,
  <span class="va">model_fsglmnet</span>
  <span class="co"># model_lss_prmt</span>
  <span class="op">)</span>

<span class="va">dmodels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">models</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    model_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"stepwise"</span>, <span class="st">"glmnet"</span>
    <span class="op">)</span>,
    .before <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    terms              <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span>,
    n_variables        <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">terms</span>, <span class="va">nrow</span><span class="op">)</span>,
    metrics            <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">model_metrics</span><span class="op">)</span>,
    metrics_validation <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">model_metrics</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">dmodels</span></code></pre></div>
<pre><code>## # A tibble: 3 x 6
<<<<<<< HEAD
##   model_name model  terms           n_variables metrics        metrics_validati~
##   &lt;chr&gt;      &lt;list&gt; &lt;list&gt;                &lt;dbl&gt; &lt;list&gt;         &lt;list&gt;           
## 1 raw        &lt;glm&gt;  &lt;tibble [12 x ~          12 &lt;tibble [1 x ~ &lt;tibble [1 x 4]&gt; 
## 2 stepwise   &lt;glm&gt;  &lt;tibble [11 x ~          11 &lt;tibble [1 x ~ &lt;tibble [1 x 4]&gt; 
## 3 glmnet     &lt;glm&gt;  &lt;tibble [11 x ~          11 &lt;tibble [1 x ~ &lt;tibble [1 x 4]&gt;</code></pre>
=======
##   model_name model  terms           n_variables metrics        metrics_validati…
##   &lt;chr&gt;      &lt;list&gt; &lt;list&gt;                &lt;dbl&gt; &lt;list&gt;         &lt;list&gt;           
## 1 raw        &lt;glm&gt;  &lt;tibble [12 × …          12 &lt;tibble [1 × … &lt;tibble [1 × 4]&gt; 
## 2 stepwise   &lt;glm&gt;  &lt;tibble [11 × …          11 &lt;tibble [1 × … &lt;tibble [1 × 4]&gt; 
## 3 glmnet     &lt;glm&gt;  &lt;tibble [11 × …          11 &lt;tibble [1 × … &lt;tibble [1 × 4]&gt;</code></pre>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmodels</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="va">terms</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">terms</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="va">term</span>, <span class="va">estimate</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">term</span>, <span class="va">model_name</span>, fill <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmodels</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="va">metrics</span>, <span class="va">metrics_validation</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">value</span>, <span class="op">-</span><span class="va">model_name</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">metric</span>, <span class="va">value</span>, <span class="op">-</span><span class="va">model_name</span>, <span class="op">-</span><span class="va">sample</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sample</span> <span class="op">==</span> <span class="st">"metrics"</span>, <span class="st">"train"</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">model_name</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">sample</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>begin <span class="op">=</span> <span class="fl">0.3</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_percent.html">percent</a></span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-29-2.png" width="700"></p>
</div>
<div id="partial-preditive-measures" class="section level3">
<h3 class="hasAnchor">
<a href="#partial-preditive-measures" class="anchor"></a>Partial preditive measures</h3>
<p>See if we can remove variables via inspecting predictive measures.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">nrow</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 12
## 
## [[2]]
## [1] 11
## 
## [[3]]
## [1] 11</code></pre>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">head</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 6 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   -1.40     0.0571   -24.4   1.07e-131
## 2 loan_woe       0.522    0.141      3.71  2.07e-  4
## 3 mortdue_woe    0.263    0.265      0.990 3.22e-  1
## 4 value_woe      0.797    0.108      7.40  1.38e- 13
## 5 job_woe        0.876    0.168      5.21  1.86e-  7
## 6 yoj_woe        1.02     0.198      5.14  2.73e-  7
## 
## [[2]]
## # A tibble: 6 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   -1.39     0.0571    -24.4  1.12e-131
## 2 debtinc_woe    0.925    0.0378     24.5  2.34e-132
## 3 delinq_woe     0.949    0.0704     13.5  1.96e- 41
## 4 clage_woe      1.05     0.116       9.07 1.22e- 19
## 5 value_woe      0.821    0.106       7.74 1.02e- 14
## 6 derog_woe      0.746    0.0917      8.13 4.19e- 16
## 
## [[3]]
## # A tibble: 6 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   -1.39     0.0571    -24.4  1.12e-131
## 2 debtinc_woe    0.925    0.0378     24.5  2.34e-132
## 3 delinq_woe     0.949    0.0704     13.5  1.96e- 41
## 4 value_woe      0.821    0.106       7.74 1.02e- 14
## 5 derog_woe      0.746    0.0917      8.13 4.19e- 16
## 6 clage_woe      1.05     0.116       9.07 1.22e- 19</code></pre>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_final</span> <span class="op">&lt;-</span> <span class="va">model_fsglmnet</span>

<span class="va">dfmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_partials.html">model_partials</a></span><span class="op">(</span><span class="va">model_final</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span>
<span class="va">dfmetrics</span></code></pre></div>
<pre><code>## # A tibble: 20 x 6
##    variable    sample    ks   auc    iv  gini
##    &lt;fct&gt;       &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 debtinc_woe train  0.618 0.829  1.91 0.658
##  2 debtinc_woe test   0.601 0.809  1.81 0.618
##  3 delinq_woe  train  0.630 0.867  2.32 0.735
##  4 delinq_woe  test   0.640 0.853  2.21 0.706
##  5 value_woe   train  0.639 0.881  2.50 0.762
##  6 value_woe   test   0.650 0.878  2.52 0.755
##  7 derog_woe   train  0.662 0.888  2.80 0.776
##  8 derog_woe   test   0.649 0.885  2.55 0.769
##  9 clage_woe   train  0.667 0.903  2.96 0.806
## 10 clage_woe   test   0.651 0.898  2.91 0.797
## 11 clno_woe    train  0.668 0.909  3.16 0.817
## 12 clno_woe    test   0.637 0.897  2.97 0.794
## 13 ninq_woe    train  0.675 0.910  3.28 0.820
## 14 ninq_woe    test   0.632 0.896  2.87 0.793
## 15 yoj_woe     train  0.681 0.914  3.42 0.827
## 16 yoj_woe     test   0.646 0.899  3.17 0.798
## 17 loan_woe    train  0.682 0.915  3.42 0.829
## 18 loan_woe    test   0.639 0.899  3.04 0.799
## 19 job_woe     train  0.686 0.917  3.50 0.834
## 20 job_woe     test   0.638 0.904  3.37 0.809</code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfmetrics</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">gini</span>, <span class="op">-</span><span class="va">iv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">risk3r</span><span class="fu">:::</span><span class="fu"><a href="../reference/plot.model_partials.html">plot.model_partials</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
</div>
<div id="performance-package" class="section level3">
<h3 class="hasAnchor">
<a href="#performance-package" class="anchor"></a><code>{performance}</code> package</h3>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span>

<span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_collinearity.html">check_collinearity</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span> <span class="op">%&gt;%</span> 
<<<<<<< HEAD
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
=======
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
>>>>>>> f16ca6b24ed82b916ab14349da989adc9dc83c9f
  <span class="fu">THEME</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span></code></pre></div>
<pre><code>## debtinc_woe  delinq_woe   value_woe   derog_woe   clage_woe    clno_woe 
##    1.081679    1.067821    1.027532    1.040731    1.058524    1.042020 
##    ninq_woe     yoj_woe    loan_woe     job_woe 
##    1.041489    1.026594    1.042448    1.015855</code></pre>
</div>
</div>
<div id="scorecard" class="section level2">
<h2 class="hasAnchor">
<a href="#scorecard" class="anchor"></a>Scorecard</h2>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">POINTS0</span>   <span class="op">&lt;-</span> <span class="fl">600</span>
<span class="va">PDO</span>       <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">ODDS0</span>     <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span>

<span class="va">scrcrd</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/scorecard.html">scorecard</a></span><span class="op">(</span>
  bins <span class="op">=</span> <span class="va">bins</span>,
  model <span class="op">=</span> <span class="va">model_final</span>,
  points0 <span class="op">=</span> <span class="va">POINTS0</span>,
  pdo <span class="op">=</span> <span class="va">PDO</span>,
  odds0 <span class="op">=</span> <span class="va">ODDS0</span>,
  basepoints_eq0 <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="va">scrcrd</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>##    variable       bin count count_distr  neg pos    posprob        woe
## 1:  debtinc   missing   907  0.21740173  351 556 0.61300992  1.8634429
## 2:  debtinc [-Inf,40)  2647  0.63446788 2498 149 0.05629014 -1.4158385
## 3:  debtinc   [40,42)   357  0.08557047  322  35 0.09803922 -0.8157426
## 4:  debtinc [42, Inf)   261  0.06255992  178  83 0.31800766  0.6405179
##        bin_iv total_iv  breaks is_special_values points
## 1: 1.06359687 1.937626 missing              TRUE      3
## 2: 0.79973545 1.937626      40             FALSE     91
## 3: 0.04374074 1.937626      42             FALSE     75
## 4: 0.03055293 1.937626     Inf             FALSE     36</code></pre>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrcrd2</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/scorecard2.html">scorecard2</a></span><span class="op">(</span>
  dt <span class="op">=</span>  <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="st">"bad_good"</span>,
  bins <span class="op">=</span> <span class="va">bins</span>,
  x <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"_woe$"</span><span class="op">)</span>,
  points0 <span class="op">=</span> <span class="va">POINTS0</span>,
  pdo <span class="op">=</span> <span class="va">PDO</span>,
  odds0 <span class="op">=</span> <span class="va">ODDS0</span>,
  basepoints_eq0 <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="va">scrcrd2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>##    variable       bin count count_distr  neg pos    posprob        woe
## 1:  debtinc   missing   907  0.21740173  351 556 0.61300992  1.8634429
## 2:  debtinc [-Inf,40)  2647  0.63446788 2498 149 0.05629014 -1.4158385
## 3:  debtinc   [40,42)   357  0.08557047  322  35 0.09803922 -0.8157426
## 4:  debtinc [42, Inf)   261  0.06255992  178  83 0.31800766  0.6405179
##        bin_iv total_iv  breaks is_special_values points
## 1: 1.06359687 1.937626 missing              TRUE      3
## 2: 0.79973545 1.937626      40             FALSE     91
## 3: 0.04374074 1.937626      42             FALSE     75
## 4: 0.03055293 1.937626     Inf             FALSE     36</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua Kunst.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
