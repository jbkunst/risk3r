<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example using risk3r • risk3r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example using risk3r">
<meta property="og:description" content="risk3r">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">risk3r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/risk3r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="risk3r_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example using risk3r</h1>
            
      
      
      <div class="hidden name"><code>risk3r.Rmd</code></div>

    </div>

    
    
<div id="packages" class="section level2">
<h2 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h2>
</div>
<div id="parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#parameters" class="anchor"></a>Parameters</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PARAMETERS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  SEED <span class="op">=</span> <span class="fl">12345</span>,
  P_TRAIN <span class="op">=</span> <span class="fl">0.5</span>,
  P_CONCENTRATION <span class="op">=</span> <span class="fl">.95</span>,
  IV_MIN <span class="op">=</span> <span class="fl">0.02</span>, <span class="co"># WEAK &gt;=</span>
  COUNT_DISTR_LIMIT <span class="op">=</span> <span class="fl">0.05</span>,
  CORRELATION_LIMIT <span class="op">=</span> <span class="fl">0.5</span>,
  POINTS0 <span class="op">=</span> <span class="fl">600</span>,
  PDO     <span class="op">=</span> <span class="fl">20</span>,
  ODDS0   <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span>
<span class="op">)</span></code></pre></div>
<details><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">custom_skim</span> <span class="op">&lt;-</span> <span class="fu">skim_with</span><span class="op">(</span>
  numeric <span class="op">=</span> <span class="fu">sfl</span><span class="op">(</span>
    median <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="va">median</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    skewness <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="fu">moments</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/moments/man/skewness.html">skewness</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    kurtosis <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="fu">moments</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/moments/man/kurtosis.html">kurtosis</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    count_distr_max <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/count_distr_max.html">count_distr_max</a></span>,
    n_unique <span class="op">=</span> <span class="fu">skimr</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/skimr/reference/stats.html">n_unique</a></span>
    <span class="op">)</span>,
  factor <span class="op">=</span> <span class="fu">sfl</span><span class="op">(</span>
    hhi <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi.html">hhi</a></span>,
    hhi_lbl <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/compose.html">compose</a></span><span class="op">(</span><span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi.html">hhi</a></span>, <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi_label.html">hhi_label</a></span>, .dir <span class="op">=</span> <span class="st">"forward"</span><span class="op">)</span>,
    count_distr_max <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/count_distr_max.html">count_distr_max</a></span>
    <span class="op">)</span>,
  append <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># custom_skim(data %&gt;% select(1:10))</span></code></pre></div>
</details>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw/cd.rds"</span><span class="op">)</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span>
  <span class="co"># select(1:300, where(is.character)) %&gt;%</span>
  <span class="fu">sample_n</span><span class="op">(</span><span class="fl">150000</span><span class="op">)</span>

<span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"bad"</span>, <span class="st">"good"</span><span class="op">)</span>,
    bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">bad_good</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="va"><a href="http://shichen.name/scorecard/reference/germancredit.html">germancredit</a></span> <span class="op">%&gt;%</span> 
    <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">rename</span><span class="op">(</span>bad_good <span class="op">=</span> <span class="va">creditability</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">select</span><span class="op">(</span><span class="va">bad_good</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>bad_good <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">bad_good</span>, <span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>id <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1000   22</code></pre>
</div>
<div id="univariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#univariate-analysis" class="anchor"></a>Univariate analysis</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe</span> <span class="op">&lt;-</span> <span class="fu">custom_skim</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="co"># use as.list to export skimr (risk3r:::as.list.skim_df)</span>
<span class="co"># writexl::write_xlsx(as.list(describe), here::here("data-raw/describe.xlsx"))</span></code></pre></div>
<p>Remove variables with 0 variance and near 0 variance.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe_min</span> <span class="op">&lt;-</span> <span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">describe</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">select</span>, variable <span class="op">=</span> <span class="va">skim_variable</span>, <span class="va">n_unique</span>, <span class="va">count_distr_max</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">vars_to_remove_unique_value</span> <span class="op">&lt;-</span> <span class="va">describe_min</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">n_unique</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>

<span class="va">vars_to_remove_near_0_var</span> <span class="op">&lt;-</span> <span class="va">describe_min</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">count_distr_max</span> <span class="op">&gt;=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_CONCENTRATION</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>

<span class="va">vars_to_remove_unique_value</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_near_0_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">vars_to_remove_near_0_var</span>, <span class="va">vars_to_remove_unique_value</span><span class="op">)</span></code></pre></div>
<p>Or using scorecard:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrd_filter</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/var_filter.html">var_filter</a></span><span class="op">(</span>
  <span class="va">data</span>, 
  <span class="co"># next 2 parameter are needed even we want only due identical_limit</span>
  y <span class="op">=</span> <span class="st">"bad_good"</span>, iv_limit <span class="op">=</span> <span class="fl">0</span>,
  missing_limit <span class="op">=</span> <span class="fl">1</span>,
  identical_limit <span class="op">=</span>  <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_CONCENTRATION</span>,
  return_rm_reason <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] filtering variables ...</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrd_filter</span><span class="op">$</span><span class="va">rm</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rm_reason</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   variable       rm_reason             info_value missing_rate identical_rate
##   &lt;chr&gt;          &lt;chr&gt;                      &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;
## 1 foreign.worker identical rate &gt; 0.95     0.0439            0          0.963</code></pre>
<p>Some differences between result due <code><a href="http://shichen.name/scorecard/reference/var_filter.html">scorecard::var_filter</a></code> exclude NAs to caculate de identical limit.</p>
<div id="removing-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#removing-variables" class="anchor"></a>Removing variables</h3>
<p>Surely we want remove other variables like the id operation/customer or a temporal/time variables.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_specials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"id"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_remove_unique_value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_remove_near_0_var</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">any_of</span><span class="op">(</span><span class="va">vars_to_remove_specials</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="split" class="section level2">
<h2 class="hasAnchor">
<a href="#split" class="anchor"></a>Split</h2>
<p>From: <a href="https://www.tidymodels.org/start/recipes/#data-split" class="uri">https://www.tidymodels.org/start/recipes/#data-split</a></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fix the random numbers by setting the seed </span>
<span class="co"># This enables the analysis to be reproducible when random numbers are used </span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">PARAMETERS</span><span class="op">$</span><span class="va">SEED</span><span class="op">)</span>

<span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span><span class="va">data</span>, prop <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_TRAIN</span><span class="op">)</span>

<span class="co"># Create data frames for the two sets:</span>
<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>
<span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></code></pre></div>
<p>We can do check:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data</span> <span class="op">%&gt;%</span> <span class="fu">count</span><span class="op">(</span><span class="va">bad_good</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   bad_good     n `n/sum(n)`
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 good       352      0.704
## 2 bad        148      0.296</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_data</span> <span class="op">%&gt;%</span> <span class="fu">count</span><span class="op">(</span><span class="va">bad_good</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   bad_good     n `n/sum(n)`
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 good       348      0.696
## 2 bad        152      0.304</code></pre>
</div>
<div id="bivariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#bivariate-analysis" class="anchor"></a>Bivariate analysis</h2>
<div id="getting-woes" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-woes" class="anchor"></a>Getting woes</h3>
<p>We’ll start with the default <code>method = "tree"</code></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin.html">woebin</a></span><span class="op">(</span>
  <span class="va">train_data</span>, 
  y <span class="op">=</span> <span class="st">"bad_good"</span>, 
  method <span class="op">=</span> <span class="st">"tree"</span>,
  count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ...</code></pre>
<p>Some sanity checks:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># train_data$variable_with_missing %&gt;% is.na() %&gt;% table()</span>
<span class="co"># bins$variable_with_missing</span></code></pre></div>
<p>The risk3r package have <code>woebin_summary</code> to get the summary.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">dbiv</span></code></pre></div>
<pre><code>## # A tibble: 19 x 15
##    variable    n_categories      iv     ks   hhi count_distr_max count_distr_min
##    &lt;chr&gt;              &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
##  1 status.of.~            4 0.736   0.374  0.25            0.404           0.062
##  2 duration.i~            5 0.413   0.254  0.2             0.358           0.064
##  3 credit.amo~            7 0.308   0.186  0.143           0.444           0.052
##  4 credit.his~            3 0.239   0.204  0.333           0.614           0.08 
##  5 age.in.yea~            7 0.222   0.191  0.184           0.392           0.06 
##  6 savings.ac~            3 0.185   0.197  0.333           0.598           0.086
##  7 purpose                5 0.153   0.184  0.2             0.298           0.09 
##  8 property               4 0.0776  0.101  0.25            0.352           0.166
##  9 present.em~            5 0.0558  0.0977 0.2             0.324           0.058
## 10 housing                3 0.0539  0.0928 0.333           0.714           0.106
## 11 installmen~            4 0.0286  0.0746 0.25            0.488           0.138
## 12 other.debt~            2 0.0254  0.0344 0.5             0.942           0.058
## 13 number.of.~            2 0.0225  0.0716 0.5             0.632           0.368
## 14 other.inst~            2 0.0199  0.0475 0.5             0.878           0.122
## 15 telephone              2 0.0153  0.0609 0.5             0.572           0.428
## 16 personal.s~            4 0.0152  0.0392 0.25            0.54            0.058
## 17 job                    3 0.0125  0.0524 0.333           0.632           0.16 
## 18 present.re~            3 0.00515 0.0226 0.333           0.576           0.124
## 19 number.of.~            2 0.00101 0.0108 0.5             0.864           0.136
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">dbiv</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 19
## Columns: 15
## $ variable           &lt;chr&gt; "status.of.existing.checking.account", "duration.in~
## $ n_categories       &lt;int&gt; 4, 5, 7, 3, 7, 3, 5, 4, 5, 3, 4, 2, 2, 2, 2, 4, 3, ~
## $ iv                 &lt;dbl&gt; 0.735703639, 0.413348805, 0.308400154, 0.238840362,~
## $ ks                 &lt;dbl&gt; 0.37400184, 0.25391585, 0.18619472, 0.20431511, 0.1~
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2000000, 0.1428571, 0.3333333, 0.18367~
## $ count_distr_max    &lt;dbl&gt; 0.404, 0.358, 0.444, 0.614, 0.392, 0.598, 0.298, 0.~
## $ count_distr_min    &lt;dbl&gt; 0.062, 0.064, 0.052, 0.080, 0.060, 0.086, 0.090, 0.~
## $ has_missing        &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ has_special_values &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ monotone           &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE~
## $ factor             &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, ~
## $ breaks             &lt;list&gt; &lt;"... &lt; 0 DM", "0 &lt;= ... &lt; 200 DM", "... &gt;= 200 DM~
## $ iv_lbl             &lt;fct&gt; suspicious, strong, strong, medium, medium, medium,~
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, unc~
## $ distribution       &lt;chr&gt; "&lt;U+2586&gt;&lt;U+2585&gt;&lt;U+2581&gt;&lt;U+2587&gt;", "&lt;U+2585&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2585&gt;", "&lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2582&gt;", "&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2583&gt;", "&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2581&gt;", "&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2585&gt;"~</code></pre>
<p>Note that <code>dbiv</code> object have <code>breaks</code> column among other information.</p>
<p>In some cases, monotonic woes are required in continous variables. With the <code>dbiv</code> object we can check what variables have a high information and no monotonic (excluding the missing category oc).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">iv</span> <span class="op">&gt;</span> <span class="fl">0.02</span>,  <span class="co"># A &gt;= weak iv value</span>
    <span class="op">!</span><span class="va">factor</span>,    <span class="co"># is numeric</span>
    <span class="op">!</span><span class="va">monotone</span>   <span class="co"># is not monotonic</span>
    <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 15
##   variable      n_categories     iv     ks   hhi count_distr_max count_distr_min
##   &lt;chr&gt;                &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
## 1 duration.in.~            5 0.413  0.254  0.2             0.358           0.064
## 2 credit.amount            7 0.308  0.186  0.143           0.444           0.052
## 3 age.in.years             7 0.222  0.191  0.184           0.392           0.06 
## 4 installment.~            4 0.0286 0.0746 0.25            0.488           0.138
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
</div>
<div id="exploring-finding-the-best-cutsbin" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-finding-the-best-cutsbin" class="anchor"></a>Exploring, finding the best cuts/bin</h3>
<p><code><a href="../reference/woebin2.html">risk3r::woebin2</a></code> -a wrapper around the main <code><a href="http://shichen.name/scorecard/reference/woebin.html">scorecard::woebin</a></code> function- implement <code>method = "ctree"</code> via the partykit package (we’ll try implement monotonic binnings from mob package <a href="https://github.com/statcompute/mob" class="uri">https://github.com/statcompute/mob</a>).</p>
<p>Having this we can iterate among all available methods:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tree"</span>, <span class="st">"ctree"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="st">"chimerge"</span><span class="op">)</span><span class="op">{</span>

    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>

  <span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="fu"><a href="../reference/woebin2.html">woebin2</a></span><span class="op">(</span>
    <span class="va">train_data</span>,
    y <span class="op">=</span> <span class="st">"bad_good"</span>,
    count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>,
    method <span class="op">=</span> <span class="va">m</span>
    <span class="op">)</span>

   <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="va">m</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ...</code></pre>
<p>We can check, for each variable: - Every method is generated for every variable - The methods give same IV in some variables</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">method</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   method     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 ctree     19
## 2 tree      19</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">variable</span>, <span class="va">iv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##       n    nn
##   &lt;int&gt; &lt;int&gt;
## 1     1    30
## 2     2     4</code></pre>
<p>Get the best breaks in the sense to maximize the IV, the get the breaks and finally uses <code><a href="http://shichen.name/scorecard/reference/woebin.html">scorecard::woebin</a></code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binbest</span> <span class="op">&lt;-</span> <span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">iv</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">binbest</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">method</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   method     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 ctree      1
## 2 tree      18</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_breaks</span> <span class="op">&lt;-</span> <span class="va">binbest</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">variable</span>, <span class="va">breaks</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin.html">woebin</a></span><span class="op">(</span>
  <span class="va">train_data</span>,
  y <span class="op">=</span> <span class="st">"bad_good"</span>,
  count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>,
  breaks_list <span class="op">=</span> <span class="va">best_breaks</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ...</code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">dbiv</span></code></pre></div>
<pre><code>## # A tibble: 19 x 15
##    variable    n_categories      iv     ks   hhi count_distr_max count_distr_min
##    &lt;chr&gt;              &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
##  1 status.of.~            4 0.736   0.374  0.25            0.404           0.062
##  2 duration.i~            5 0.413   0.254  0.2             0.358           0.064
##  3 credit.amo~            7 0.308   0.186  0.143           0.444           0.052
##  4 credit.his~            3 0.239   0.204  0.333           0.614           0.08 
##  5 age.in.yea~            7 0.222   0.191  0.184           0.392           0.06 
##  6 savings.ac~            3 0.185   0.197  0.333           0.598           0.086
##  7 purpose                5 0.153   0.184  0.2             0.298           0.09 
##  8 property               4 0.0776  0.101  0.25            0.352           0.166
##  9 present.em~            5 0.0558  0.0977 0.2             0.324           0.058
## 10 housing                3 0.0539  0.0928 0.333           0.714           0.106
## 11 installmen~            4 0.0286  0.0746 0.25            0.488           0.138
## 12 other.debt~            2 0.0254  0.0344 0.5             0.942           0.058
## 13 number.of.~            2 0.0225  0.0716 0.5             0.632           0.368
## 14 other.inst~            2 0.0199  0.0475 0.5             0.878           0.122
## 15 telephone              2 0.0153  0.0609 0.5             0.572           0.428
## 16 personal.s~            4 0.0152  0.0392 0.25            0.54            0.058
## 17 job                    3 0.0125  0.0524 0.333           0.632           0.16 
## 18 present.re~            3 0.00515 0.0226 0.333           0.576           0.124
## 19 number.of.~            2 0.00101 0.0108 0.5             0.864           0.136
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">dbiv</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 19
## Columns: 15
## $ variable           &lt;chr&gt; "status.of.existing.checking.account", "duration.in~
## $ n_categories       &lt;int&gt; 4, 5, 7, 3, 7, 3, 5, 4, 5, 3, 4, 2, 2, 2, 2, 4, 3, ~
## $ iv                 &lt;dbl&gt; 0.735703639, 0.413348805, 0.308400154, 0.238840362,~
## $ ks                 &lt;dbl&gt; 0.37400184, 0.25391585, 0.18619472, 0.20431511, 0.1~
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2000000, 0.1428571, 0.3333333, 0.18367~
## $ count_distr_max    &lt;dbl&gt; 0.404, 0.358, 0.444, 0.614, 0.392, 0.598, 0.298, 0.~
## $ count_distr_min    &lt;dbl&gt; 0.062, 0.064, 0.052, 0.080, 0.060, 0.086, 0.090, 0.~
## $ has_missing        &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ has_special_values &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ monotone           &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE~
## $ factor             &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, ~
## $ breaks             &lt;list&gt; &lt;"... &lt; 0 DM", "0 &lt;= ... &lt; 200 DM", "... &gt;= 200 DM~
## $ iv_lbl             &lt;fct&gt; suspicious, strong, strong, medium, medium, medium,~
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, unc~
## $ distribution       &lt;chr&gt; "&lt;U+2586&gt;&lt;U+2585&gt;&lt;U+2581&gt;&lt;U+2587&gt;", "&lt;U+2585&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2585&gt;", "&lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2582&gt;", "&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2583&gt;", "&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2581&gt;", "&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2585&gt;"~</code></pre>
<p>Apply woes to train and test table.</p>
</div>
<div id="finding-variables-with-low-iv" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-variables-with-low-iv" class="anchor"></a>Finding variables with low IV</h3>
<p>Just remove variables with low predictive power.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_low_iv</span> <span class="op">&lt;-</span> <span class="va">dbiv</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">iv</span> <span class="op">&lt;</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">IV_MIN</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></code></pre></div>
</div>
<div id="finding-highly-correlated-woes-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-highly-correlated-woes-variables" class="anchor"></a>Finding highly correlated woes variables</h3>
<p>In risk3r we can get a data frame with correlations between woes and IVs to decide what variables remove.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FALSE to know check the next steps below</span>
<span class="va">dcors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_cor_iv.html">woebin_cor_iv</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">bins</span>, upper <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dcors</span></code></pre></div>
<pre><code>## # A tibble: 361 x 7
##    var1             var2                   r var1_iv var1_rank var2_iv var2_rank
##    &lt;fct&gt;            &lt;fct&gt;              &lt;dbl&gt;   &lt;dbl&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;
##  1 status.of.exist~ status.of.exist~ NA        0.736         1  0.736          1
##  2 status.of.exist~ duration.in.mon~  0.118    0.736         1  0.413          2
##  3 status.of.exist~ credit.amount     0.0804   0.736         1  0.308          3
##  4 status.of.exist~ credit.history    0.170    0.736         1  0.239          4
##  5 status.of.exist~ age.in.years      0.168    0.736         1  0.222          5
##  6 status.of.exist~ savings.account~  0.253    0.736         1  0.185          6
##  7 status.of.exist~ purpose           0.122    0.736         1  0.153          7
##  8 status.of.exist~ property          0.0451   0.736         1  0.0776         8
##  9 status.of.exist~ present.employm~  0.0295   0.736         1  0.0558         9
## 10 status.of.exist~ housing           0.147    0.736         1  0.0539        10
## # ... with 351 more rows</code></pre>
<p>Now, we can get the variables which have high correlation</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">dcors</span> 

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="va">n</span> </code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove same vars (diagonal)</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">var1</span> <span class="op">!=</span> <span class="va">var2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># keep upper matrix</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">var1_rank</span> <span class="op">&lt;</span> <span class="va">var2_rank</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span><span class="fl">2</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove variables which causes high correlations and have lower IV </span>
<span class="co"># respect the other variable</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">CORRELATION_LIMIT</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">distinct</span><span class="op">(</span><span class="va">var2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="removing-variables-1" class="section level3">
<h3 class="hasAnchor">
<a href="#removing-variables-1" class="anchor"></a>Removing variables</h3>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span>, <span class="va">vars_to_remove_low_iv</span><span class="op">)</span>

<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_remove_low_iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="applying-woes" class="section level3">
<h3 class="hasAnchor">
<a href="#applying-woes" class="anchor"></a>Applying woes</h3>
<p>Just <code><a href="http://shichen.name/scorecard/reference/woebin_ply.html">scorecard::woebin_ply</a></code> :)</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># class before woes</span>
<span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
##  factor numeric 
##       9       5</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin_ply.html">woebin_ply</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">bins</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin_ply.html">woebin_ply</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="va">bins</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># check all is numeric except response variable</span>
<span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
##  factor numeric 
##       1      13</code></pre>
</div>
</div>
<div id="modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#modelling" class="anchor"></a>Modelling</h2>
<p>Let fit a very raw model to check:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="va">logit</span><span class="op">)</span><span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 14 x 5
##    term                                    estimate std.error statistic  p.value
##    &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)                               -0.863     0.124    -6.96  3.45e-12
##  2 status.of.existing.checking.account_woe    0.760     0.146     5.22  1.84e- 7
##  3 duration.in.month_woe                      0.784     0.209     3.76  1.70e- 4
##  4 credit.history_woe                         0.854     0.284     3.01  2.65e- 3
##  5 purpose_woe                                1.01      0.319     3.16  1.60e- 3
##  6 credit.amount_woe                          0.820     0.232     3.53  4.18e- 4
##  7 savings.account.and.bonds_woe              0.960     0.296     3.24  1.19e- 3
##  8 present.employment.since_woe               1.09      0.509     2.14  3.26e- 2
##  9 installment.rate.in.percentage.of.disp~    1.62      0.748     2.17  3.03e- 2
## 10 other.debtors.or.guarantors_woe            1.67      0.800     2.09  3.65e- 2
## 11 property_woe                               0.530     0.455     1.16  2.44e- 1
## 12 age.in.years_woe                           0.768     0.291     2.64  8.23e- 3
## 13 housing_woe                                0.538     0.520     1.03  3.01e- 1
## 14 number.of.existing.credits.at.this.ban~    0.175     0.921     0.190 8.50e- 1</code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># problems?</span>
<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -0.863     0.124     -6.96 3.45e-12</code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.573 0.851  2.12 0.701</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_raw</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.431 0.765  1.10 0.530</code></pre>
<div id="satellite-model" class="section level3">
<h3 class="hasAnchor">
<a href="#satellite-model" class="anchor"></a>Satellite Model</h3>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># rf simple</span>
<span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span><span class="va">bad_good</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, do.trace <span class="op">=</span> <span class="cn">TRUE</span>, ntree <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code>## ntree      OOB      1      2
##     1:  27.17% 18.32% 49.06%
##     2:  32.66% 22.93% 54.35%
##     3:  31.91% 21.43% 57.27%
##     4:  31.41% 21.07% 57.63%
##     5:  30.18% 21.81% 50.38%
##     6:  31.43% 20.24% 57.34%
##     7:  31.82% 20.53% 58.74%
##     8:  28.25% 16.14% 57.24%
##     9:  26.06% 14.29% 54.48%
##    10:  29.64% 17.14% 59.59%
##    11:  30.32% 16.81% 62.59%
##    12:  27.45% 15.67% 55.41%
##    13:  27.40% 14.20% 58.78%
##    14:  27.80% 13.92% 60.81%
##    15:  27.20% 13.92% 58.78%
##    16:  26.80% 13.07% 59.46%
##    17:  26.60% 13.64% 57.43%
##    18:  25.80% 11.65% 59.46%
##    19:  27.40% 12.78% 62.16%
##    20:  26.00% 12.22% 58.78%
##    21:  26.60% 12.78% 59.46%
##    22:  26.80% 12.50% 60.81%
##    23:  27.00% 12.78% 60.81%
##    24:  27.60% 12.78% 62.84%
##    25:  26.40% 11.08% 62.84%
##    26:  27.00% 12.78% 60.81%
##    27:  26.80% 11.93% 62.16%
##    28:  25.80% 11.65% 59.46%
##    29:  26.20% 11.93% 60.14%
##    30:  27.00% 12.22% 62.16%
##    31:  26.20% 11.65% 60.81%
##    32:  25.20% 11.08% 58.78%
##    33:  25.80% 11.65% 59.46%
##    34:  24.80% 10.80% 58.11%
##    35:  25.80% 11.08% 60.81%
##    36:  25.20% 10.80% 59.46%
##    37:  25.00% 11.08% 58.11%
##    38:  25.60% 11.65% 58.78%
##    39:  24.60% 12.22% 54.05%
##    40:  25.20% 11.65% 57.43%
##    41:  24.20% 10.51% 56.76%
##    42:  25.20% 11.65% 57.43%
##    43:  25.20% 11.65% 57.43%
##    44:  26.00% 13.07% 56.76%
##    45:  25.40% 12.22% 56.76%
##    46:  25.40% 12.22% 56.76%
##    47:  25.40% 12.78% 55.41%
##    48:  25.40% 12.78% 55.41%
##    49:  24.40% 12.50% 52.70%
##    50:  25.00% 11.93% 56.08%
##    51:  24.80% 12.22% 54.73%
##    52:  24.60% 11.93% 54.73%
##    53:  24.20% 11.65% 54.05%
##    54:  25.00% 11.93% 56.08%
##    55:  24.20% 11.36% 54.73%
##    56:  23.40% 10.51% 54.05%
##    57:  23.60% 10.80% 54.05%
##    58:  23.80% 10.80% 54.73%
##    59:  24.60% 11.65% 55.41%
##    60:  24.00% 11.08% 54.73%
##    61:  23.80% 11.08% 54.05%
##    62:  24.20% 11.36% 54.73%
##    63:  23.20% 10.51% 53.38%
##    64:  23.60% 11.08% 53.38%
##    65:  23.60% 11.08% 53.38%
##    66:  23.60% 10.80% 54.05%
##    67:  23.40% 10.80% 53.38%
##    68:  23.60% 10.51% 54.73%
##    69:  23.60% 10.51% 54.73%
##    70:  24.20% 11.08% 55.41%
##    71:  23.40% 10.23% 54.73%
##    72:  23.20% 10.23% 54.05%
##    73:  23.60% 10.80% 54.05%
##    74:  23.80% 11.36% 53.38%
##    75:  23.60% 10.80% 54.05%
##    76:  23.80% 10.80% 54.73%
##    77:  23.20% 10.23% 54.05%
##    78:  23.60% 10.23% 55.41%
##    79:  23.40% 10.23% 54.73%
##    80:  22.60%  9.09% 54.73%
##    81:  22.40%  9.09% 54.05%
##    82:  22.80%  9.66% 54.05%
##    83:  22.80%  9.38% 54.73%
##    84:  23.60% 10.23% 55.41%
##    85:  23.20%  9.66% 55.41%
##    86:  23.20%  9.94% 54.73%
##    87:  23.20%  9.94% 54.73%
##    88:  23.40%  9.94% 55.41%
##    89:  23.20%  9.38% 56.08%
##    90:  23.20%  9.38% 56.08%
##    91:  23.20%  9.66% 55.41%
##    92:  23.40% 10.23% 54.73%
##    93:  23.20%  9.66% 55.41%
##    94:  23.80% 10.23% 56.08%
##    95:  23.80% 10.23% 56.08%
##    96:  24.00% 10.80% 55.41%
##    97:  23.60% 10.51% 54.73%
##    98:  23.20% 10.51% 53.38%
##    99:  23.60% 10.80% 54.05%
##   100:  23.40% 10.51% 54.05%</code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/metrics.html">metrics</a></span><span class="op">(</span>
  <span class="va">train_data</span><span class="op">$</span><span class="va">bad_good</span>, 
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_rf</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.424 0.773  1.22 0.547</code></pre>
</div>
<div id="feature-selection-via-glmnet" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-glmnet" class="anchor"></a>Feature selection via glmnet</h3>
<p>From <a href="https://glmnet.stanford.edu/articles/glmnet.html" class="uri">https://glmnet.stanford.edu/articles/glmnet.html</a></p>
<p>There 2 option for <code>S</code>: <code>lambda.min</code> and <code>lambda.1se</code> , this last option you have a more regularized model.</p>
<p>This wrapper around the glmnet package take a model as input, then return the model with the variables non zero from the <code><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet::cv.glmnet()</a></code> function according with the selected <code>S</code> option. This function reorder the variables in the same order the coefficient in the glmnet model turn to non zero (check the plots when run this funtion).</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsglmnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_glmnet.html">featsel_glmnet</a></span><span class="op">(</span><span class="va">model_raw</span>, S <span class="op">=</span> <span class="st">"lambda.1se"</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Training
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |======================================================================| 100%
## Fold: 1/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |======================================================================| 100%
## Fold: 2/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |======================================================================| 100%
## Fold: 3/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |======================================================================| 100%
## Fold: 4/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |======================================================================| 100%
## Fold: 5/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |======================================================================| 100%
## Fold: 6/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |======================================================================| 100%
## Fold: 7/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |======================================================================| 100%
## Fold: 8/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |======================================================================| 100%
## Fold: 9/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |======================================================================| 100%
## Fold: 10/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |======================================================================| 100%</code></pre>
<p><img src="risk3r_files/figure-html/unnamed-chunk-25-1.png" width="700"><img src="risk3r_files/figure-html/unnamed-chunk-25-2.png" width="700"><img src="risk3r_files/figure-html/unnamed-chunk-25-3.png" width="700"></p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                               -0.859     0.122     -7.05 1.77e-12
## 2 status.of.existing.checking.account_woe    0.748     0.144      5.19 2.08e- 7
## 3 duration.in.month_woe                      0.863     0.200      4.31 1.61e- 5
## 4 credit.amount_woe                          0.795     0.224      3.56 3.73e- 4
## 5 credit.history_woe                         0.821     0.256      3.20 1.35e- 3
## 6 age.in.years_woe                           0.762     0.280      2.72 6.61e- 3
## 7 purpose_woe                                1.09      0.310      3.53 4.10e- 4
## 8 savings.account.and.bonds_woe              0.849     0.291      2.92 3.48e- 3
## 9 present.employment.since_woe               1.03      0.495      2.09 3.68e- 2</code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -0.859     0.122     -7.05 1.77e-12</code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.575 0.843  2.04 0.686</code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsglmnet</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.411 0.750 0.908 0.501</code></pre>
</div>
<div id="feature-selection-via-setpwise-forward" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-setpwise-forward" class="anchor"></a>Feature selection via Setpwise forward</h3>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsstep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_stepforward.html">featsel_stepforward</a></span><span class="op">(</span><span class="va">model_raw</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Start:  AIC=609.44
## bad_good ~ 1
## 
##                                                           Df Deviance    AIC
## + status.of.existing.checking.account_woe                  1   535.77 539.77
## + duration.in.month_woe                                    1   566.76 570.76
## + credit.amount_woe                                        1   576.22 580.22
## + credit.history_woe                                       1   583.69 587.69
## + age.in.years_woe                                         1   585.94 589.94
## + savings.account.and.bonds_woe                            1   588.80 592.80
## + purpose_woe                                              1   591.85 595.85
## + property_woe                                             1   599.39 603.39
## + present.employment.since_woe                             1   601.58 605.58
## + housing_woe                                              1   601.73 605.73
## + installment.rate.in.percentage.of.disposable.income_woe  1   604.49 608.49
## + other.debtors.or.guarantors_woe                          1   604.95 608.95
## + number.of.existing.credits.at.this.bank_woe              1   605.11 609.11
## &lt;none&gt;                                                         607.44 609.44
## 
## Step:  AIC=539.77
## bad_good ~ status.of.existing.checking.account_woe
## 
##                                                           Df Deviance    AIC
## + duration.in.month_woe                                    1   502.70 508.70
## + credit.amount_woe                                        1   508.47 514.47
## + credit.history_woe                                       1   521.33 527.33
## + age.in.years_woe                                         1   523.62 529.62
## + purpose_woe                                              1   525.64 531.64
## + property_woe                                             1   529.13 535.13
## + savings.account.and.bonds_woe                            1   529.81 535.81
## + present.employment.since_woe                             1   530.27 536.27
## + other.debtors.or.guarantors_woe                          1   530.43 536.43
## + installment.rate.in.percentage.of.disposable.income_woe  1   532.11 538.11
## &lt;none&gt;                                                         535.77 539.77
## + housing_woe                                              1   534.21 540.21
## + number.of.existing.credits.at.this.bank_woe              1   534.32 540.32
## - status.of.existing.checking.account_woe                  1   607.44 609.44
## 
## Step:  AIC=508.7
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe
## 
##                                                           Df Deviance    AIC
## + age.in.years_woe                                         1   489.84 497.84
## + purpose_woe                                              1   490.76 498.76
## + credit.amount_woe                                        1   490.86 498.86
## + credit.history_woe                                       1   492.58 500.58
## + savings.account.and.bonds_woe                            1   494.23 502.23
## + present.employment.since_woe                             1   494.35 502.35
## + other.debtors.or.guarantors_woe                          1   497.74 505.74
## &lt;none&gt;                                                         502.70 508.70
## + housing_woe                                              1   500.83 508.83
## + installment.rate.in.percentage.of.disposable.income_woe  1   500.84 508.84
## + property_woe                                             1   501.16 509.16
## + number.of.existing.credits.at.this.bank_woe              1   501.20 509.20
## - duration.in.month_woe                                    1   535.77 539.77
## - status.of.existing.checking.account_woe                  1   566.76 570.76
## 
## Step:  AIC=497.84
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe
## 
##                                                           Df Deviance    AIC
## + purpose_woe                                              1   478.01 488.01
## + credit.amount_woe                                        1   478.26 488.26
## + credit.history_woe                                       1   480.24 490.24
## + savings.account.and.bonds_woe                            1   482.79 492.79
## + other.debtors.or.guarantors_woe                          1   483.73 493.73
## + present.employment.since_woe                             1   484.48 494.48
## + property_woe                                             1   487.15 497.15
## + number.of.existing.credits.at.this.bank_woe              1   487.76 497.76
## &lt;none&gt;                                                         489.84 497.84
## + installment.rate.in.percentage.of.disposable.income_woe  1   488.23 498.23
## + housing_woe                                              1   489.09 499.09
## - age.in.years_woe                                         1   502.70 508.70
## - duration.in.month_woe                                    1   523.62 529.62
## - status.of.existing.checking.account_woe                  1   543.60 549.60
## 
## Step:  AIC=488.01
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe + purpose_woe
## 
##                                                           Df Deviance    AIC
## + credit.amount_woe                                        1   465.57 477.57
## + credit.history_woe                                       1   467.99 479.99
## + savings.account.and.bonds_woe                            1   471.57 483.57
## + present.employment.since_woe                             1   472.64 484.64
## + other.debtors.or.guarantors_woe                          1   473.81 485.81
## + property_woe                                             1   475.38 487.38
## + number.of.existing.credits.at.this.bank_woe              1   475.82 487.82
## &lt;none&gt;                                                         478.01 488.01
## + installment.rate.in.percentage.of.disposable.income_woe  1   476.30 488.30
## + housing_woe                                              1   477.54 489.54
## - purpose_woe                                              1   489.84 497.84
## - age.in.years_woe                                         1   490.76 498.76
## - duration.in.month_woe                                    1   513.72 521.72
## - status.of.existing.checking.account_woe                  1   524.64 532.64
## 
## Step:  AIC=477.57
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe + purpose_woe + credit.amount_woe
## 
##                                                           Df Deviance    AIC
## + credit.history_woe                                       1   455.65 469.65
## + savings.account.and.bonds_woe                            1   458.00 472.00
## + present.employment.since_woe                             1   460.22 474.22
## + other.debtors.or.guarantors_woe                          1   462.25 476.25
## + number.of.existing.credits.at.this.bank_woe              1   462.33 476.33
## + installment.rate.in.percentage.of.disposable.income_woe  1   462.60 476.60
## &lt;none&gt;                                                         465.57 477.57
## + property_woe                                             1   463.98 477.98
## + housing_woe                                              1   464.93 478.93
## - age.in.years_woe                                         1   477.87 487.87
## - credit.amount_woe                                        1   478.01 488.01
## - purpose_woe                                              1   478.26 488.26
## - duration.in.month_woe                                    1   485.58 495.58
## - status.of.existing.checking.account_woe                  1   510.87 520.87
## 
## Step:  AIC=469.65
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe + purpose_woe + credit.amount_woe + credit.history_woe
## 
##                                                           Df Deviance    AIC
## + savings.account.and.bonds_woe                            1   446.35 462.35
## + present.employment.since_woe                             1   450.83 466.83
## + other.debtors.or.guarantors_woe                          1   451.77 467.77
## + installment.rate.in.percentage.of.disposable.income_woe  1   451.82 467.82
## &lt;none&gt;                                                         455.65 469.65
## + property_woe                                             1   453.97 469.97
## + housing_woe                                              1   455.23 471.23
## + number.of.existing.credits.at.this.bank_woe              1   455.42 471.42
## - credit.history_woe                                       1   465.57 477.57
## - age.in.years_woe                                         1   467.56 479.56
## - credit.amount_woe                                        1   467.99 479.99
## - purpose_woe                                              1   468.86 480.86
## - duration.in.month_woe                                    1   473.12 485.12
## - status.of.existing.checking.account_woe                  1   494.84 506.84
## 
## Step:  AIC=462.35
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe + purpose_woe + credit.amount_woe + credit.history_woe + 
##     savings.account.and.bonds_woe
## 
##                                                           Df Deviance    AIC
## + other.debtors.or.guarantors_woe                          1   440.74 458.74
## + present.employment.since_woe                             1   441.97 459.97
## + installment.rate.in.percentage.of.disposable.income_woe  1   442.46 460.46
## &lt;none&gt;                                                         446.35 462.35
## + property_woe                                             1   444.45 462.45
## + housing_woe                                              1   445.71 463.71
## + number.of.existing.credits.at.this.bank_woe              1   446.05 464.05
## - savings.account.and.bonds_woe                            1   455.65 469.65
## - age.in.years_woe                                         1   456.76 470.76
## - credit.history_woe                                       1   458.00 472.00
## - purpose_woe                                              1   459.12 473.12
## - credit.amount_woe                                        1   459.87 473.87
## - duration.in.month_woe                                    1   464.91 478.91
## - status.of.existing.checking.account_woe                  1   475.18 489.18
## 
## Step:  AIC=458.74
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe + purpose_woe + credit.amount_woe + credit.history_woe + 
##     savings.account.and.bonds_woe + other.debtors.or.guarantors_woe
## 
##                                                           Df Deviance    AIC
## + present.employment.since_woe                             1   436.55 456.55
## + installment.rate.in.percentage.of.disposable.income_woe  1   436.78 456.78
## &lt;none&gt;                                                         440.74 458.74
## + property_woe                                             1   439.43 459.43
## + housing_woe                                              1   440.03 460.03
## + number.of.existing.credits.at.this.bank_woe              1   440.32 460.32
## - other.debtors.or.guarantors_woe                          1   446.35 462.35
## - purpose_woe                                              1   450.84 466.84
## - savings.account.and.bonds_woe                            1   451.77 467.77
## - age.in.years_woe                                         1   452.08 468.08
## - credit.amount_woe                                        1   453.08 469.08
## - credit.history_woe                                       1   453.27 469.27
## - duration.in.month_woe                                    1   459.49 475.49
## - status.of.existing.checking.account_woe                  1   471.21 487.21
## 
## Step:  AIC=456.55
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe + purpose_woe + credit.amount_woe + credit.history_woe + 
##     savings.account.and.bonds_woe + other.debtors.or.guarantors_woe + 
##     present.employment.since_woe
## 
##                                                           Df Deviance    AIC
## + installment.rate.in.percentage.of.disposable.income_woe  1   432.29 454.29
## &lt;none&gt;                                                         436.55 456.55
## + property_woe                                             1   434.90 456.90
## + housing_woe                                              1   435.81 457.81
## + number.of.existing.credits.at.this.bank_woe              1   436.46 458.46
## - present.employment.since_woe                             1   440.74 458.74
## - other.debtors.or.guarantors_woe                          1   441.97 459.97
## - age.in.years_woe                                         1   445.24 463.24
## - savings.account.and.bonds_woe                            1   447.04 465.04
## - purpose_woe                                              1   447.05 465.05
## - credit.history_woe                                       1   448.26 466.26
## - credit.amount_woe                                        1   448.90 466.90
## - duration.in.month_woe                                    1   457.03 475.03
## - status.of.existing.checking.account_woe                  1   467.61 485.61
## 
## Step:  AIC=454.29
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     age.in.years_woe + purpose_woe + credit.amount_woe + credit.history_woe + 
##     savings.account.and.bonds_woe + other.debtors.or.guarantors_woe + 
##     present.employment.since_woe + installment.rate.in.percentage.of.disposable.income_woe
## 
##                                                           Df Deviance    AIC
## &lt;none&gt;                                                         432.29 454.29
## + property_woe                                             1   430.60 454.60
## + housing_woe                                              1   430.91 454.91
## + number.of.existing.credits.at.this.bank_woe              1   432.21 456.21
## - installment.rate.in.percentage.of.disposable.income_woe  1   436.55 456.55
## - present.employment.since_woe                             1   436.78 456.78
## - other.debtors.or.guarantors_woe                          1   437.73 457.73
## - age.in.years_woe                                         1   440.07 460.07
## - savings.account.and.bonds_woe                            1   442.85 462.85
## - purpose_woe                                              1   443.02 463.02
## - credit.history_woe                                       1   444.78 464.78
## - credit.amount_woe                                        1   446.50 466.50
## - duration.in.month_woe                                    1   449.27 469.27
## - status.of.existing.checking.account_woe                  1   463.46 483.46</code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    term                                    estimate std.error statistic  p.value
##    &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)                               -0.857     0.123     -6.95 3.60e-12
##  2 status.of.existing.checking.account_woe    0.776     0.145      5.34 9.32e- 8
##  3 duration.in.month_woe                      0.813     0.205      3.97 7.31e- 5
##  4 age.in.years_woe                           0.763     0.284      2.69 7.22e- 3
##  5 purpose_woe                                1.02      0.317      3.20 1.35e- 3
##  6 credit.amount_woe                          0.834     0.230      3.63 2.79e- 4
##  7 credit.history_woe                         0.883     0.258      3.42 6.19e- 4
##  8 savings.account.and.bonds_woe              0.939     0.295      3.19 1.44e- 3
##  9 other.debtors.or.guarantors_woe            1.72      0.791      2.17 2.99e- 2
## 10 present.employment.since_woe               1.06      0.500      2.11 3.46e- 2
## 11 installment.rate.in.percentage.of.disp~    1.50      0.737      2.04 4.17e- 2</code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -0.857     0.123     -6.95 3.60e-12</code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.565 0.849  1.98 0.698</code></pre>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsstep</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.411 0.758  1.01 0.517</code></pre>
</div>
<div id="feature-selection-via-repetitive-round-of-drop-out-loss" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-repetitive-round-of-drop-out-loss" class="anchor"></a>Feature selection via repetitive round of drop out loss</h3>
<p>From <a href="https://ema.drwhy.ai/featureImportance.html" class="uri">https://ema.drwhy.ai/featureImportance.html</a></p>
<p>The <code>stat = "min"</code> option give the most simpler model because It’more strict: If any iteration the loss increase then the variable is removed. You can choose between <code><a href="https://rdrr.io/r/base/c.html">c("q25", "mean", "median")</a></code></p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_lss_prmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_loss_function_permutations.html">featsel_loss_function_permutations</a></span><span class="op">(</span>
  <span class="va">model_raw</span>, 
  stat <span class="op">=</span><span class="st">"min"</span>,
  <span class="co"># n_sample = round(nrow(train_data)/2),</span>
  B <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Preparation of a new explainer is initiated
##   -&gt; model label       :  Round 1 
##   -&gt; data              :  500  rows  13  cols 
##   -&gt; data              :  tibble converted into a data.frame 
##   -&gt; target variable   :  500  values 
##   -&gt; predict function  :  yhat.glm  will be used ( [33m default [39m )
##   -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
##   -&gt; model_info        :  package stats , ver. 3.6.3 , task classification ( [33m default [39m ) 
##   -&gt; predicted values  :  numerical, min =  0.003450759 , mean =  0.296 , max =  0.9588398  
##   -&gt; residual function :  difference between y and yhat ( [33m default [39m )
##   -&gt; residuals         :  numerical, min =  0.09319342 , mean =  1 , max =  1.972187  
##  [32m A new explainer has been created! [39m 
## Preparation of a new explainer is initiated
##   -&gt; model label       :  Round 2 
##   -&gt; data              :  500  rows  8  cols 
##   -&gt; data              :  tibble converted into a data.frame 
##   -&gt; target variable   :  500  values 
##   -&gt; predict function  :  yhat.glm  will be used ( [33m default [39m )
##   -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
##   -&gt; model_info        :  package stats , ver. 3.6.3 , task classification ( [33m default [39m ) 
##   -&gt; predicted values  :  numerical, min =  0.002915699 , mean =  0.296 , max =  0.9405762  
##   -&gt; residual function :  difference between y and yhat ( [33m default [39m )
##   -&gt; residuals         :  numerical, min =  0.1013122 , mean =  1 , max =  1.978892  
##  [32m A new explainer has been created! [39m 
## Preparation of a new explainer is initiated
##   -&gt; model label       :  Round 3 
##   -&gt; data              :  500  rows  6  cols 
##   -&gt; data              :  tibble converted into a data.frame 
##   -&gt; target variable   :  500  values 
##   -&gt; predict function  :  yhat.glm  will be used ( [33m default [39m )
##   -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
##   -&gt; model_info        :  package stats , ver. 3.6.3 , task classification ( [33m default [39m ) 
##   -&gt; predicted values  :  numerical, min =  0.00504409 , mean =  0.296 , max =  0.9157543  
##   -&gt; residual function :  difference between y and yhat ( [33m default [39m )
##   -&gt; residuals         :  numerical, min =  0.0842457 , mean =  1 , max =  1.954339  
##  [32m A new explainer has been created! [39m</code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, <span class="st">"plots"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 7 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                               -0.849     0.119     -7.14 9.62e-13
## 2 status.of.existing.checking.account_woe    0.827     0.140      5.91 3.41e- 9
## 3 duration.in.month_woe                      0.783     0.195      4.02 5.85e- 5
## 4 credit.history_woe                         0.763     0.249      3.06 2.20e- 3
## 5 age.in.years_woe                           0.883     0.270      3.27 1.08e- 3
## 6 credit.amount_woe                          0.750     0.220      3.41 6.57e- 4
## 7 purpose_woe                                1.07      0.302      3.55 3.87e- 4</code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -0.849     0.119     -7.14 9.62e-13</code></pre>
</div>
<div id="partial-preditive-measures" class="section level3">
<h3 class="hasAnchor">
<a href="#partial-preditive-measures" class="anchor"></a>Partial preditive measures</h3>
<p>See if we can remove variables via inspecting predictive measures.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">model_raw</span>, 
  <span class="va">model_fsstep</span>,
  <span class="va">model_fsglmnet</span>,
  <span class="va">model_lss_prmt</span>
  <span class="op">)</span>

<span class="va">models</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">nrow</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 14
## 
## [[2]]
## [1] 11
## 
## [[3]]
## [1] 9
## 
## [[4]]
## [1] 7</code></pre>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_final</span> <span class="op">&lt;-</span> <span class="va">model_lss_prmt</span>

<span class="va">dfmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_partials.html">model_partials</a></span><span class="op">(</span><span class="va">model_final</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span>
<span class="va">dfmetrics</span></code></pre></div>
<pre><code>## # A tibble: 12 x 6
##    variable                                sample    ks   auc    iv  gini
##    &lt;fct&gt;                                   &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 status.of.existing.checking.account_woe train  0.374 0.720 0.736 0.439
##  2 status.of.existing.checking.account_woe test   0.360 0.696 0.600 0.392
##  3 duration.in.month_woe                   train  0.460 0.778 1.12  0.556
##  4 duration.in.month_woe                   test   0.333 0.722 0.808 0.443
##  5 credit.history_woe                      train  0.475 0.788 1.25  0.575
##  6 credit.history_woe                      test   0.362 0.744 0.974 0.488
##  7 age.in.years_woe                        train  0.473 0.802 1.47  0.603
##  8 age.in.years_woe                        test   0.350 0.724 0.764 0.448
##  9 credit.amount_woe                       train  0.491 0.816 1.62  0.632
## 10 credit.amount_woe                       test   0.376 0.725 0.751 0.450
## 11 purpose_woe                             train  0.513 0.829 1.86  0.659
## 12 purpose_woe                             test   0.389 0.738 0.804 0.477</code></pre>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfmetrics</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">gini</span>, <span class="op">-</span><span class="va">iv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">risk3r</span><span class="fu">:::</span><span class="fu"><a href="../reference/plot.model_partials.html">plot.model_partials</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div id="performance-package" class="section level3">
<h3 class="hasAnchor">
<a href="#performance-package" class="anchor"></a><code>{performance}</code> package</h3>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span>

<span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_collinearity.html">check_collinearity</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span></code></pre></div>
<pre><code>## status.of.existing.checking.account_woe                   duration.in.month_woe 
##                                1.013246                                1.106867 
##                      credit.history_woe                        age.in.years_woe 
##                                1.009504                                1.017397 
##                       credit.amount_woe                             purpose_woe 
##                                1.098109                                1.030836</code></pre>
</div>
</div>
<div id="scorecard" class="section level2">
<h2 class="hasAnchor">
<a href="#scorecard" class="anchor"></a>Scorecard</h2>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">POINTS0</span>   <span class="op">&lt;-</span> <span class="fl">600</span>
<span class="va">PDO</span>       <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">ODDS0</span>     <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span>

<span class="va">scrcrd</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/scorecard.html">scorecard</a></span><span class="op">(</span>
  bins <span class="op">=</span> <span class="va">bins</span>,
  model <span class="op">=</span> <span class="va">model_final</span>,
  points0 <span class="op">=</span> <span class="va">POINTS0</span>,
  pdo <span class="op">=</span> <span class="va">PDO</span>,
  odds0 <span class="op">=</span> <span class="va">ODDS0</span>,
  basepoints_eq0 <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="va">scrcrd</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>##                               variable
## 1: status.of.existing.checking.account
## 2: status.of.existing.checking.account
## 3: status.of.existing.checking.account
## 4: status.of.existing.checking.account
##                                                       bin count count_distr neg
## 1:                                             ... &lt; 0 DM   142       0.284  70
## 2:                                      0 &lt;= ... &lt; 200 DM   125       0.250  79
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year    31       0.062  23
## 4:                                    no checking account   202       0.404 180
##    pos   posprob        woe      bin_iv  total_iv
## 1:  72 0.5070423  0.8945898 0.257304462 0.7357036
## 2:  46 0.3680000  0.3256124 0.028126075 0.7357036
## 3:   8 0.2580645 -0.1896338 0.002140369 0.7357036
## 4:  22 0.1089109 -1.2354955 0.448132734 0.7357036
##                                                    breaks is_special_values
## 1:                                             ... &lt; 0 DM             FALSE
## 2:                                      0 &lt;= ... &lt; 200 DM             FALSE
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year             FALSE
## 4:                                    no checking account             FALSE
##    points
## 1:     64
## 2:     78
## 3:     90
## 4:    115</code></pre>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrcrd2</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/scorecard2.html">scorecard2</a></span><span class="op">(</span>
  dt <span class="op">=</span>  <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="st">"bad_good"</span>,
  bins <span class="op">=</span> <span class="va">bins</span>,
  x <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"_woe$"</span><span class="op">)</span>,
  points0 <span class="op">=</span> <span class="va">POINTS0</span>,
  pdo <span class="op">=</span> <span class="va">PDO</span>,
  odds0 <span class="op">=</span> <span class="va">ODDS0</span>,
  basepoints_eq0 <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="va">scrcrd2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>##                               variable
## 1: status.of.existing.checking.account
## 2: status.of.existing.checking.account
## 3: status.of.existing.checking.account
## 4: status.of.existing.checking.account
##                                                       bin count count_distr neg
## 1:                                             ... &lt; 0 DM   142       0.284  70
## 2:                                      0 &lt;= ... &lt; 200 DM   125       0.250  79
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year    31       0.062  23
## 4:                                    no checking account   202       0.404 180
##    pos   posprob        woe      bin_iv  total_iv
## 1:  72 0.5070423  0.8945898 0.257304462 0.7357036
## 2:  46 0.3680000  0.3256124 0.028126075 0.7357036
## 3:   8 0.2580645 -0.1896338 0.002140369 0.7357036
## 4:  22 0.1089109 -1.2354955 0.448132734 0.7357036
##                                                    breaks is_special_values
## 1:                                             ... &lt; 0 DM             FALSE
## 2:                                      0 &lt;= ... &lt; 200 DM             FALSE
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year             FALSE
## 4:                                    no checking account             FALSE
##    points
## 1:     64
## 2:     78
## 3:     90
## 4:    115</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua Kunst.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
