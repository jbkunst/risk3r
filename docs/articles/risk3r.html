<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example using risk3r • risk3r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example using risk3r">
<meta property="og:description" content="risk3r">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">risk3r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/risk3r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="risk3r_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example using risk3r</h1>
            
      
      
      <div class="hidden name"><code>risk3r.Rmd</code></div>

    </div>

    
    
<div id="packages" class="section level2">
<h2 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h2>
</div>
<div id="parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#parameters" class="anchor"></a>Parameters</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PARAMETERS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  SEED <span class="op">=</span> <span class="fl">12345</span>,
  P_TRAIN <span class="op">=</span> <span class="fl">0.7</span>,
  P_CONCENTRATION <span class="op">=</span> <span class="fl">.95</span>,
  IV_MIN <span class="op">=</span> <span class="fl">0.02</span>, <span class="co"># WEAK &gt;=</span>
  COUNT_DISTR_LIMIT <span class="op">=</span> <span class="fl">0.05</span>,
  CORRELATION_LIMIT <span class="op">=</span> <span class="fl">0.5</span>,
  POINTS0 <span class="op">=</span> <span class="fl">600</span>,
  PDO     <span class="op">=</span> <span class="fl">20</span>,
  ODDS0   <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span>
<span class="op">)</span></code></pre></div>
<details><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">custom_skim</span> <span class="op">&lt;-</span> <span class="fu">skim_with</span><span class="op">(</span>
  numeric <span class="op">=</span> <span class="fu">sfl</span><span class="op">(</span>
    median <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="va">median</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    skewness <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="fu">moments</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/moments/man/skewness.html">skewness</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    kurtosis <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="fu">moments</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/moments/man/kurtosis.html">kurtosis</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    count_distr_max <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/count_distr_max.html">count_distr_max</a></span>,
    n_unique <span class="op">=</span> <span class="fu">skimr</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/skimr/reference/stats.html">n_unique</a></span>
    <span class="op">)</span>,
  factor <span class="op">=</span> <span class="fu">sfl</span><span class="op">(</span>
    hhi <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi.html">hhi</a></span>,
    hhi_lbl <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/compose.html">compose</a></span><span class="op">(</span><span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi.html">hhi</a></span>, <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hhi_label.html">hhi_label</a></span>, .dir <span class="op">=</span> <span class="st">"forward"</span><span class="op">)</span>,
    count_distr_max <span class="op">=</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/count_distr_max.html">count_distr_max</a></span>
    <span class="op">)</span>,
  append <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># custom_skim(data %&gt;% select(1:10))</span></code></pre></div>
</details>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">OPTION</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="kw">if</span><span class="op">(</span><span class="va">OPTION</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw/cd.rds"</span><span class="op">)</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span>
  <span class="co"># select(1:300, where(is.character)) %&gt;%</span>
  <span class="fu">sample_n</span><span class="op">(</span><span class="fl">100000</span><span class="op">)</span>

<span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"bad"</span>, <span class="st">"good"</span><span class="op">)</span>,
    bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">bad_good</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">OPTION</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="va"><a href="http://shichen.name/scorecard/reference/germancredit.html">germancredit</a></span> <span class="op">%&gt;%</span> 
    <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">rename</span><span class="op">(</span>bad_good <span class="op">=</span> <span class="va">creditability</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">select</span><span class="op">(</span><span class="va">bad_good</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>bad_good <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">bad_good</span>, <span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>id <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">OPTION</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="va"><a href="../reference/hmeq.html">hmeq</a></span> <span class="op">%&gt;%</span> 
    <span class="fu">rename</span><span class="op">(</span>bad_good <span class="op">=</span> <span class="va">bad</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">select</span><span class="op">(</span><span class="va">bad_good</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>bad_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"bad"</span>, <span class="st">"good"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>bad_good <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">bad_good</span>, <span class="st">"good"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>id <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1000   22</code></pre>
</div>
<div id="univariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#univariate-analysis" class="anchor"></a>Univariate analysis</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe</span> <span class="op">&lt;-</span> <span class="fu">custom_skim</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="co"># use as.list to export skimr (risk3r:::as.list.skim_df)</span>
<span class="co"># writexl::write_xlsx(as.list(describe), here::here("data-raw/describe.xlsx"))</span></code></pre></div>
<p>Remove variables with 0 variance and near 0 variance.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe_min</span> <span class="op">&lt;-</span> <span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">describe</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">select</span>, variable <span class="op">=</span> <span class="va">skim_variable</span>, <span class="va">n_unique</span>, <span class="va">count_distr_max</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">vars_to_remove_unique_value</span> <span class="op">&lt;-</span> <span class="va">describe_min</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">n_unique</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>

<span class="va">vars_to_remove_near_0_var</span> <span class="op">&lt;-</span> <span class="va">describe_min</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">count_distr_max</span> <span class="op">&gt;=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_CONCENTRATION</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>

<span class="va">vars_to_remove_unique_value</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_near_0_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">vars_to_remove_near_0_var</span>, <span class="va">vars_to_remove_unique_value</span><span class="op">)</span></code></pre></div>
<p>Or using scorecard:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrd_filter</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/var_filter.html">var_filter</a></span><span class="op">(</span>
  <span class="va">data</span>, 
  <span class="co"># next 2 parameter are needed even we want only due identical_limit</span>
  y <span class="op">=</span> <span class="st">"bad_good"</span>, iv_limit <span class="op">=</span> <span class="fl">0</span>,
  missing_limit <span class="op">=</span> <span class="fl">1</span>,
  identical_limit <span class="op">=</span>  <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_CONCENTRATION</span>,
  return_rm_reason <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] filtering variables ...</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrd_filter</span><span class="op">$</span><span class="va">rm</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rm_reason</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   variable       rm_reason             info_value missing_rate identical_rate
##   &lt;chr&gt;          &lt;chr&gt;                      &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;
## 1 foreign.worker identical rate &gt; 0.95     0.0439            0          0.963</code></pre>
<div id="anomalies" class="section level3">
<h3 class="hasAnchor">
<a href="#anomalies" class="anchor"></a>Anomalies</h3>
<p>From <a href="https://github.com/sicarul/xray" class="uri">https://github.com/sicarul/xray</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">describe_anomalies</span> <span class="op">&lt;-</span> <span class="fu">xray</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xray/man/anomalies.html">anomalies</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="fu">as_tibble</span><span class="op">(</span><span class="va">describe_anomalies</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 22 x 13
##    Variable        q   qNA pNA   qZero pZero qBlank pBlank  qInf pInf  qDistinct
##    &lt;fct&gt;       &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
##  1 bad_good     1000     0 -         0 -          0 -          0 -             2
##  2 number.of.~  1000     0 -         0 -          0 -          0 -             2
##  3 telephone    1000     0 -         0 -          0 -          0 -             2
##  4 foreign.wo~  1000     0 -         0 -          0 -          0 -             2
##  5 other.debt~  1000     0 -         0 -          0 -          0 -             3
##  6 other.inst~  1000     0 -         0 -          0 -          0 -             3
##  7 housing      1000     0 -         0 -          0 -          0 -             3
##  8 status.of.~  1000     0 -         0 -          0 -          0 -             4
##  9 installmen~  1000     0 -         0 -          0 -          0 -             4
## 10 personal.s~  1000     0 -         0 -          0 -          0 -             4
## # ... with 12 more rows, and 2 more variables: type &lt;chr&gt;,
## #   anomalous_percent &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">as_tibble</span><span class="op">(</span><span class="va">describe_anomalies</span><span class="op">$</span><span class="va">problem_variables</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 0 x 14
## # ... with 14 variables: Variable &lt;fct&gt;, q &lt;int&gt;, qNA &lt;int&gt;, pNA &lt;lgl&gt;,
## #   qZero &lt;int&gt;, pZero &lt;lgl&gt;, qBlank &lt;int&gt;, pBlank &lt;lgl&gt;, qInf &lt;int&gt;,
## #   pInf &lt;lgl&gt;, qDistinct &lt;int&gt;, type &lt;chr&gt;, anomalous_percent &lt;lgl&gt;,
## #   problems &lt;chr&gt;</code></pre>
<p>Some differences between result due <code><a href="http://shichen.name/scorecard/reference/var_filter.html">scorecard::var_filter</a></code> exclude NAs to caculate de identical limit.</p>
</div>
<div id="removing-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#removing-variables" class="anchor"></a>Removing variables</h3>
<p>Surely we want remove other variables like the id operation/customer or a temporal/time variables.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_specials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"id"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_remove_unique_value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_remove_near_0_var</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">any_of</span><span class="op">(</span><span class="va">vars_to_remove_specials</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="split" class="section level2">
<h2 class="hasAnchor">
<a href="#split" class="anchor"></a>Split</h2>
<p>From: <a href="https://www.tidymodels.org/start/recipes/#data-split" class="uri">https://www.tidymodels.org/start/recipes/#data-split</a></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fix the random numbers by setting the seed </span>
<span class="co"># This enables the analysis to be reproducible when random numbers are used </span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">PARAMETERS</span><span class="op">$</span><span class="va">SEED</span><span class="op">)</span>

<span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span><span class="va">data</span>, prop <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">P_TRAIN</span><span class="op">)</span>

<span class="co"># Create data frames for the two sets:</span>
<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>
<span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></code></pre></div>
<p>We can do check:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data</span> <span class="op">%&gt;%</span> <span class="fu">count</span><span class="op">(</span><span class="va">bad_good</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   bad_good     n `n/sum(n)`
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 good       490        0.7
## 2 bad        210        0.3</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_data</span> <span class="op">%&gt;%</span> <span class="fu">count</span><span class="op">(</span><span class="va">bad_good</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   bad_good     n `n/sum(n)`
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 good       210        0.7
## 2 bad         90        0.3</code></pre>
</div>
<div id="bivariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#bivariate-analysis" class="anchor"></a>Bivariate analysis</h2>
<div id="getting-woes" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-woes" class="anchor"></a>Getting woes</h3>
<p>We’ll start with the default <code>method = "tree"</code></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin.html">woebin</a></span><span class="op">(</span>
  <span class="va">train_data</span>, 
  y <span class="op">=</span> <span class="st">"bad_good"</span>, 
  method <span class="op">=</span> <span class="st">"tree"</span>,
  count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ...</code></pre>
<p>Some sanity checks:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># train_data$variable_with_missing %&gt;% is.na() %&gt;% table()</span>
<span class="co"># bins$variable_with_missing</span></code></pre></div>
<p>The risk3r package have <code>woebin_summary</code> to get the summary.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">dbiv</span></code></pre></div>
<pre><code>## # A tibble: 19 x 15
##    variable    n_categories      iv     ks   hhi count_distr_max count_distr_min
##    &lt;chr&gt;              &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
##  1 status.of.~            4 0.641   0.352  0.25            0.394          0.0614
##  2 duration.i~            5 0.317   0.217  0.2             0.4            0.0686
##  3 credit.his~            4 0.229   0.188  0.25            0.524          0.0843
##  4 savings.ac~            3 0.227   0.203  0.333           0.606          0.0914
##  5 credit.amo~            5 0.192   0.144  0.2             0.71           0.05  
##  6 age.in.yea~            5 0.166   0.178  0.2             0.506          0.0771
##  7 purpose                5 0.0927  0.137  0.2             0.333          0.0586
##  8 housing                3 0.0906  0.133  0.333           0.717          0.109 
##  9 property               4 0.0752  0.0918 0.25            0.339          0.159 
## 10 present.em~            3 0.0666  0.106  0.333           0.434          0.226 
## 11 other.inst~            2 0.0359  0.0667 0.5             0.866          0.134 
## 12 installmen~            3 0.0247  0.0782 0.333           0.479          0.141 
## 13 present.re~            4 0.0152  0.0537 0.25            0.406          0.131 
## 14 personal.s~            4 0.0140  0.0395 0.25            0.534          0.0586
## 15 telephone              2 0.0140  0.0578 0.5             0.593          0.407 
## 16 number.of.~            2 0.0119  0.0524 0.5             0.63           0.37  
## 17 other.debt~            2 0.00839 0.0204 0.5             0.943          0.0571
## 18 job                    3 0.00496 0.0224 0.333           0.641          0.141 
## 19 number.of.~            2 0.00174 0.0143 0.5             0.861          0.139 
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">dbiv</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 19
## Columns: 15
## $ variable           &lt;chr&gt; "status.of.existing.checking.account", "duration.in~
## $ n_categories       &lt;int&gt; 4, 5, 4, 3, 5, 5, 5, 3, 4, 3, 2, 3, 4, 4, 2, 2, 2, ~
## $ iv                 &lt;dbl&gt; 0.640993860, 0.317132816, 0.229319578, 0.226864498,~
## $ ks                 &lt;dbl&gt; 0.35170068, 0.21700680, 0.18775510, 0.20272109, 0.1~
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2000000, 0.2500000, 0.3333333, 0.20000~
## $ count_distr_max    &lt;dbl&gt; 0.3942857, 0.4000000, 0.5242857, 0.6057143, 0.71000~
## $ count_distr_min    &lt;dbl&gt; 0.06142857, 0.06857143, 0.08428571, 0.09142857, 0.0~
## $ has_missing        &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ has_special_values &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ monotone           &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE,~
## $ factor             &lt;lgl&gt; TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, TRUE, TRUE, ~
## $ breaks             &lt;list&gt; &lt;"... &lt; 0 DM", "0 &lt;= ... &lt; 200 DM", "... &gt;= 200 DM~
## $ iv_lbl             &lt;fct&gt; suspicious, strong, medium, medium, medium, medium,~
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, mod~
## $ distribution       &lt;chr&gt; "&lt;U+2586&gt;&lt;U+2585&gt;&lt;U+2581&gt;&lt;U+2587&gt;", "&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2582&gt;", "&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2585&gt;", "&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2583&gt;", "&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2581&gt;", "&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2587&gt;", "~</code></pre>
<p>Note that <code>dbiv</code> object have <code>breaks</code> column among other information.</p>
<p>In some cases, monotonic woes are required in continous variables. With the <code>dbiv</code> object we can check what variables have a high information and no monotonic (excluding the missing category oc).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">iv</span> <span class="op">&gt;</span> <span class="fl">0.02</span>,  <span class="co"># A &gt;= weak iv value</span>
    <span class="op">!</span><span class="va">factor</span>,    <span class="co"># is numeric</span>
    <span class="op">!</span><span class="va">monotone</span>   <span class="co"># is not monotonic</span>
    <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 15
##   variable      n_categories    iv    ks   hhi count_distr_max count_distr_min
##   &lt;chr&gt;                &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
## 1 credit.amount            5 0.192 0.144   0.2           0.71           0.05  
## 2 age.in.years             5 0.166 0.178   0.2           0.506          0.0771
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
</div>
<div id="exploring-finding-the-best-cutsbin" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-finding-the-best-cutsbin" class="anchor"></a>Exploring, finding the best cuts/bin</h3>
<p><code><a href="../reference/woebin2.html">risk3r::woebin2</a></code> -a wrapper around the main <code><a href="http://shichen.name/scorecard/reference/woebin.html">scorecard::woebin</a></code> function- implement <code>method = "ctree"</code> via the partykit package (we’ll try implement monotonic binnings from mob package <a href="https://github.com/statcompute/mob" class="uri">https://github.com/statcompute/mob</a>).</p>
<p>Having this we can iterate among all available methods:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tree"</span>, <span class="st">"ctree"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="st">"chimerge"</span><span class="op">)</span><span class="op">{</span>

    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>

  <span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu">risk3r</span><span class="fu">::</span><span class="fu"><a href="../reference/woebin2.html">woebin2</a></span><span class="op">(</span>
    <span class="va">train_data</span>,
    y <span class="op">=</span> <span class="st">"bad_good"</span>,
    count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>,
    method <span class="op">=</span> <span class="va">m</span>
    <span class="op">)</span>

   <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="va">m</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ... 
## [INFO] creating woe binning ...</code></pre>
<p>We can check, for each variable: - Every method is generated for every variable - The methods give same IV in some variables</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">method</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   method     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 ctree     19
## 2 tree      19</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">variable</span>, <span class="va">iv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##       n    nn
##   &lt;int&gt; &lt;int&gt;
## 1     1    32
## 2     2     3</code></pre>
<p>Get the best breaks in the sense to maximize the IV, the get the breaks and finally uses <code><a href="http://shichen.name/scorecard/reference/woebin.html">scorecard::woebin</a></code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binbest</span> <span class="op">&lt;-</span> <span class="va">binssums</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">iv</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">binbest</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">method</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   method     n
##   &lt;chr&gt;  &lt;int&gt;
## 1 ctree      1
## 2 tree      18</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_breaks</span> <span class="op">&lt;-</span> <span class="va">binbest</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">variable</span>, <span class="va">breaks</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin.html">woebin</a></span><span class="op">(</span>
  <span class="va">train_data</span>,
  y <span class="op">=</span> <span class="st">"bad_good"</span>,
  count_distr_limit <span class="op">=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">COUNT_DISTR_LIMIT</span>,
  breaks_list <span class="op">=</span> <span class="va">best_breaks</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## [INFO] creating woe binning ...</code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_summary.html">woebin_summary</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">dbiv</span></code></pre></div>
<pre><code>## # A tibble: 19 x 15
##    variable    n_categories      iv     ks   hhi count_distr_max count_distr_min
##    &lt;chr&gt;              &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
##  1 status.of.~            4 0.641   0.352  0.25            0.394          0.0614
##  2 duration.i~            5 0.317   0.217  0.2             0.4            0.0686
##  3 credit.his~            4 0.229   0.188  0.25            0.524          0.0843
##  4 savings.ac~            3 0.227   0.203  0.333           0.606          0.0914
##  5 credit.amo~            5 0.192   0.144  0.2             0.71           0.05  
##  6 age.in.yea~            5 0.166   0.178  0.2             0.506          0.0771
##  7 purpose                5 0.0927  0.137  0.2             0.333          0.0586
##  8 housing                3 0.0906  0.133  0.333           0.717          0.109 
##  9 property               4 0.0752  0.0918 0.25            0.339          0.159 
## 10 present.em~            3 0.0666  0.106  0.333           0.434          0.226 
## 11 other.inst~            2 0.0359  0.0667 0.5             0.866          0.134 
## 12 installmen~            3 0.0247  0.0782 0.333           0.479          0.141 
## 13 present.re~            4 0.0152  0.0537 0.25            0.406          0.131 
## 14 personal.s~            4 0.0140  0.0395 0.25            0.534          0.0586
## 15 telephone              2 0.0140  0.0578 0.5             0.593          0.407 
## 16 number.of.~            2 0.0119  0.0524 0.5             0.63           0.37  
## 17 other.debt~            2 0.00839 0.0204 0.5             0.943          0.0571
## 18 job                    3 0.00496 0.0224 0.333           0.641          0.141 
## 19 number.of.~            2 0.00174 0.0143 0.5             0.861          0.139 
## # ... with 8 more variables: has_missing &lt;lgl&gt;, has_special_values &lt;lgl&gt;,
## #   monotone &lt;lgl&gt;, factor &lt;lgl&gt;, breaks &lt;list&gt;, iv_lbl &lt;fct&gt;, hhi_lbl &lt;fct&gt;,
## #   distribution &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">dbiv</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 19
## Columns: 15
## $ variable           &lt;chr&gt; "status.of.existing.checking.account", "duration.in~
## $ n_categories       &lt;int&gt; 4, 5, 4, 3, 5, 5, 5, 3, 4, 3, 2, 3, 4, 4, 2, 2, 2, ~
## $ iv                 &lt;dbl&gt; 0.640993860, 0.317132816, 0.229319578, 0.226864498,~
## $ ks                 &lt;dbl&gt; 0.35170068, 0.21700680, 0.18775510, 0.20272109, 0.1~
## $ hhi                &lt;dbl&gt; 0.2500000, 0.2000000, 0.2500000, 0.3333333, 0.20000~
## $ count_distr_max    &lt;dbl&gt; 0.3942857, 0.4000000, 0.5242857, 0.6057143, 0.71000~
## $ count_distr_min    &lt;dbl&gt; 0.06142857, 0.06857143, 0.08428571, 0.09142857, 0.0~
## $ has_missing        &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ has_special_values &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA~
## $ monotone           &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE,~
## $ factor             &lt;lgl&gt; TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, TRUE, TRUE, ~
## $ breaks             &lt;list&gt; &lt;"... &lt; 0 DM", "0 &lt;= ... &lt; 200 DM", "... &gt;= 200 DM~
## $ iv_lbl             &lt;fct&gt; suspicious, strong, medium, medium, medium, medium,~
## $ hhi_lbl            &lt;fct&gt; moderate concentration, moderate concentration, mod~
## $ distribution       &lt;chr&gt; "&lt;U+2586&gt;&lt;U+2585&gt;&lt;U+2581&gt;&lt;U+2587&gt;", "&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2582&gt;&lt;U+2582&gt;", "&lt;U+2582&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2585&gt;", "&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2583&gt;", "&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2581&gt;", "&lt;U+2583&gt;&lt;U+2582&gt;&lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2587&gt;", "~</code></pre>
<p>Apply woes to train and test table.</p>
</div>
<div id="finding-variables-with-low-iv" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-variables-with-low-iv" class="anchor"></a>Finding variables with low IV</h3>
<p>Just remove variables with low predictive power.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_remove_low_iv</span> <span class="op">&lt;-</span> <span class="va">dbiv</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">iv</span> <span class="op">&lt;</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">IV_MIN</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></code></pre></div>
</div>
<div id="finding-highly-correlated-woes-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-highly-correlated-woes-variables" class="anchor"></a>Finding highly correlated woes variables</h3>
<p>In risk3r we can get a data frame with correlations between woes and IVs to decide what variables remove.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FALSE to know check the next steps below</span>
<span class="va">dcors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/woebin_cor_iv.html">woebin_cor_iv</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">bins</span>, upper <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dcors</span></code></pre></div>
<pre><code>## # A tibble: 361 x 7
##    var1             var2                   r var1_iv var1_rank var2_iv var2_rank
##    &lt;fct&gt;            &lt;fct&gt;              &lt;dbl&gt;   &lt;dbl&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;
##  1 status.of.exist~ status.of.exist~ NA        0.641         1  0.641          1
##  2 status.of.exist~ duration.in.mon~  0.0802   0.641         1  0.317          2
##  3 status.of.exist~ credit.history    0.170    0.641         1  0.229          3
##  4 status.of.exist~ savings.account~  0.222    0.641         1  0.227          4
##  5 status.of.exist~ credit.amount     0.0367   0.641         1  0.192          5
##  6 status.of.exist~ age.in.years      0.169    0.641         1  0.166          6
##  7 status.of.exist~ purpose           0.114    0.641         1  0.0927         7
##  8 status.of.exist~ housing           0.151    0.641         1  0.0906         8
##  9 status.of.exist~ property          0.0625   0.641         1  0.0752         9
## 10 status.of.exist~ present.employm~  0.0828   0.641         1  0.0666        10
## # ... with 351 more rows</code></pre>
<p>Now, we can get the variables which have high correlation</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span>

<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">dcors</span> 

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="va">n</span> </code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove same vars (diagonal)</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">var1</span> <span class="op">!=</span> <span class="va">var2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># keep upper matrix</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">var1_rank</span> <span class="op">&lt;</span> <span class="va">var2_rank</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span> <span class="op">==</span> <span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span><span class="fl">2</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove variables which causes high correlations and have lower IV </span>
<span class="co"># respect the other variable</span>
<span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="va">vars_to_rm_correlation</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">PARAMETERS</span><span class="op">$</span><span class="va">CORRELATION_LIMIT</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">distinct</span><span class="op">(</span><span class="va">var2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="removing-variables-1" class="section level3">
<h3 class="hasAnchor">
<a href="#removing-variables-1" class="anchor"></a>Removing variables</h3>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vars_to_rm_correlation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">vars_to_rm_correlation</span>, <span class="va">vars_to_remove_low_iv</span><span class="op">)</span>

<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_remove_low_iv</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars_to_rm_correlation</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="applying-woes" class="section level3">
<h3 class="hasAnchor">
<a href="#applying-woes" class="anchor"></a>Applying woes</h3>
<p>Just <code><a href="http://shichen.name/scorecard/reference/woebin_ply.html">scorecard::woebin_ply</a></code> :)</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># class before woes</span>
<span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
##  factor numeric 
##       9       4</code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin_ply.html">woebin_ply</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">bins</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/woebin_ply.html">woebin_ply</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="va">bins</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [INFO] converting into woe values ...</code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># check all is numeric except response variable</span>
<span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## .
##  factor numeric 
##       1      12</code></pre>
</div>
</div>
<div id="modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#modelling" class="anchor"></a>Modelling</h2>
<div id="raw-model" class="section level3">
<h3 class="hasAnchor">
<a href="#raw-model" class="anchor"></a>Raw Model</h3>
<p>Let fit a very raw model to check:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">bad_good</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="va">logit</span><span class="op">)</span><span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 13 x 5
##    term                                    estimate std.error statistic  p.value
##    &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)                               -0.848     0.100    -8.43  3.36e-17
##  2 status.of.existing.checking.account_woe    0.761     0.128     5.93  3.05e- 9
##  3 duration.in.month_woe                      0.815     0.198     4.12  3.83e- 5
##  4 credit.history_woe                         0.736     0.214     3.45  5.69e- 4
##  5 purpose_woe                                1.34      0.343     3.89  9.87e- 5
##  6 credit.amount_woe                          0.987     0.245     4.02  5.71e- 5
##  7 savings.account.and.bonds_woe              0.875     0.219     3.99  6.58e- 5
##  8 present.employment.since_woe               0.875     0.381     2.29  2.18e- 2
##  9 installment.rate.in.percentage.of.disp~    1.93      0.643     3.01  2.65e- 3
## 10 property_woe                               0.221     0.393     0.561 5.75e- 1
## 11 age.in.years_woe                           0.786     0.242     3.25  1.17e- 3
## 12 other.installment.plans_woe                0.554     0.508     1.09  2.76e- 1
## 13 housing_woe                                0.414     0.338     1.22  2.21e- 1</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   term                        estimate std.error statistic  p.value
##   &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                   -0.848     0.100    -8.43  3.36e-17
## 2 property_woe                   0.221     0.393     0.561 5.75e- 1
## 3 other.installment.plans_woe    0.554     0.508     1.09  2.76e- 1
## 4 housing_woe                    0.414     0.338     1.22  2.21e- 1</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">THEME</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.560 0.829  1.86 0.659</code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_raw</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.505 0.813  1.52 0.626</code></pre>
</div>
<div id="satellite-model" class="section level3">
<h3 class="hasAnchor">
<a href="#satellite-model" class="anchor"></a>Satellite Model</h3>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># rf simple</span>
<span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span><span class="va">bad_good</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, do.trace <span class="op">=</span> <span class="cn">TRUE</span>, ntree <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></code></pre></div>
<pre><code>## ntree      OOB      1      2
##     1:  31.54% 14.62% 64.04%
##     2:  32.62% 17.54% 63.77%
##     3:  34.09% 21.29% 63.75%
##     4:  32.93% 19.66% 64.16%
##     5:  32.32% 20.23% 60.43%
##     6:  32.71% 20.22% 61.54%
##     7:  31.47% 20.35% 57.29%
##     8:  29.75% 17.26% 58.82%
##     9:  28.43% 16.22% 57.07%
##    10:  28.26% 15.56% 57.69%
##    11:  26.37% 15.05% 52.63%
##    12:  26.44% 15.02% 52.86%
##    13:  26.22% 14.34% 53.81%
##    14:  26.47% 14.72% 53.81%
##    15:  27.00% 15.51% 53.81%
##    16:  26.71% 15.31% 53.33%
##    17:  25.86% 14.29% 52.86%
##    18:  26.86% 14.90% 54.76%
##    19:  26.14% 13.88% 54.76%
##    20:  25.71% 13.88% 53.33%
##    21:  25.71% 13.47% 54.29%
##    22:  27.29% 15.71% 54.29%
##    23:  26.71% 15.10% 53.81%
##    24:  26.43% 14.90% 53.33%
##    25:  25.57% 13.27% 54.29%
##    26:  25.71% 14.29% 52.38%
##    27:  26.29% 14.29% 54.29%
##    28:  26.43% 13.47% 56.67%
##    29:  25.71% 13.88% 53.33%
##    30:  26.00% 13.67% 54.76%
##    31:  26.14% 14.08% 54.29%
##    32:  26.29% 14.69% 53.33%
##    33:  26.29% 14.08% 54.76%
##    34:  26.43% 14.49% 54.29%
##    35:  25.29% 13.27% 53.33%
##    36:  26.43% 14.29% 54.76%
##    37:  26.14% 14.08% 54.29%
##    38:  25.71% 13.67% 53.81%
##    39:  26.00% 13.67% 54.76%
##    40:  25.86% 13.88% 53.81%
##    41:  25.57% 13.47% 53.81%
##    42:  25.57% 13.67% 53.33%
##    43:  25.86% 14.49% 52.38%
##    44:  26.29% 14.69% 53.33%
##    45:  25.57% 14.29% 51.90%
##    46:  25.57% 14.08% 52.38%
##    47:  25.57% 13.47% 53.81%
##    48:  25.57% 13.27% 54.29%
##    49:  25.00% 13.06% 52.86%
##    50:  25.86% 14.49% 52.38%
##    51:  25.29% 13.27% 53.33%
##    52:  25.29% 13.47% 52.86%
##    53:  25.57% 13.67% 53.33%
##    54:  25.00% 13.47% 51.90%
##    55:  25.00% 12.86% 53.33%
##    56:  25.43% 13.47% 53.33%
##    57:  24.57% 12.86% 51.90%
##    58:  24.43% 12.45% 52.38%
##    59:  24.86% 12.65% 53.33%
##    60:  25.29% 13.27% 53.33%
##    61:  24.71% 12.45% 53.33%
##    62:  25.00% 12.65% 53.81%
##    63:  24.57% 12.45% 52.86%
##    64:  24.29% 12.04% 52.86%
##    65:  24.57% 12.24% 53.33%
##    66:  24.57% 12.45% 52.86%
##    67:  25.14% 13.47% 52.38%
##    68:  25.00% 13.47% 51.90%
##    69:  24.71% 13.06% 51.90%
##    70:  23.86% 12.24% 50.95%
##    71:  24.43% 12.65% 51.90%
##    72:  24.86% 13.06% 52.38%
##    73:  24.14% 12.04% 52.38%
##    74:  24.43% 12.24% 52.86%
##    75:  24.86% 12.86% 52.86%
##    76:  24.86% 13.06% 52.38%
##    77:  24.43% 12.45% 52.38%
##    78:  25.14% 13.06% 53.33%
##    79:  24.29% 12.24% 52.38%
##    80:  24.43% 12.24% 52.86%
##    81:  24.57% 12.65% 52.38%
##    82:  24.14% 12.04% 52.38%
##    83:  24.57% 12.45% 52.86%
##    84:  25.14% 13.27% 52.86%
##    85:  25.29% 13.06% 53.81%
##    86:  25.00% 12.86% 53.33%
##    87:  24.29% 11.84% 53.33%
##    88:  25.29% 13.27% 53.33%
##    89:  25.00% 12.86% 53.33%
##    90:  24.86% 12.45% 53.81%
##    91:  24.86% 12.86% 52.86%
##    92:  25.14% 12.65% 54.29%
##    93:  25.14% 13.06% 53.33%
##    94:  24.71% 12.45% 53.33%
##    95:  24.71% 12.45% 53.33%
##    96:  24.43% 12.04% 53.33%
##    97:  24.29% 11.84% 53.33%
##    98:  24.57% 12.24% 53.33%
##    99:  24.14% 11.63% 53.33%
##   100:  24.71% 12.24% 53.81%
##   101:  24.86% 12.65% 53.33%
##   102:  24.86% 12.45% 53.81%
##   103:  25.29% 12.65% 54.76%
##   104:  25.29% 13.06% 53.81%
##   105:  25.00% 12.45% 54.29%
##   106:  25.29% 13.27% 53.33%
##   107:  24.57% 12.45% 52.86%
##   108:  24.57% 12.24% 53.33%
##   109:  24.86% 12.65% 53.33%
##   110:  24.86% 12.65% 53.33%
##   111:  24.86% 12.65% 53.33%
##   112:  24.71% 12.24% 53.81%
##   113:  24.14% 12.04% 52.38%
##   114:  24.29% 12.45% 51.90%
##   115:  23.71% 12.04% 50.95%
##   116:  23.86% 12.04% 51.43%
##   117:  24.14% 12.04% 52.38%
##   118:  24.00% 12.04% 51.90%
##   119:  23.86% 11.84% 51.90%
##   120:  23.71% 11.63% 51.90%
##   121:  23.57% 11.84% 50.95%
##   122:  23.29% 11.63% 50.48%
##   123:  24.29% 12.45% 51.90%
##   124:  24.00% 12.24% 51.43%
##   125:  23.86% 11.84% 51.90%
##   126:  24.14% 12.45% 51.43%
##   127:  23.71% 11.84% 51.43%
##   128:  23.86% 11.63% 52.38%
##   129:  23.86% 12.04% 51.43%
##   130:  23.43% 11.84% 50.48%
##   131:  23.71% 12.04% 50.95%
##   132:  23.71% 12.04% 50.95%
##   133:  23.43% 12.04% 50.00%
##   134:  23.86% 12.24% 50.95%
##   135:  24.00% 12.24% 51.43%
##   136:  23.71% 12.24% 50.48%
##   137:  23.71% 12.24% 50.48%
##   138:  23.71% 11.84% 51.43%
##   139:  23.86% 12.04% 51.43%
##   140:  24.29% 12.45% 51.90%
##   141:  23.86% 12.24% 50.95%
##   142:  24.00% 12.45% 50.95%
##   143:  23.29% 11.63% 50.48%
##   144:  23.86% 12.45% 50.48%
##   145:  24.14% 12.04% 52.38%
##   146:  24.00% 12.04% 51.90%
##   147:  23.86% 11.84% 51.90%
##   148:  24.00% 12.24% 51.43%
##   149:  23.43% 11.84% 50.48%
##   150:  24.14% 12.24% 51.90%
##   151:  24.14% 12.45% 51.43%
##   152:  23.71% 11.84% 51.43%
##   153:  24.00% 12.24% 51.43%
##   154:  24.71% 13.06% 51.90%
##   155:  24.43% 12.45% 52.38%
##   156:  23.86% 12.04% 51.43%
##   157:  23.86% 12.04% 51.43%
##   158:  24.14% 12.24% 51.90%
##   159:  24.14% 12.65% 50.95%
##   160:  23.86% 12.24% 50.95%
##   161:  23.86% 12.24% 50.95%
##   162:  23.71% 12.04% 50.95%
##   163:  23.86% 12.24% 50.95%
##   164:  24.00% 12.45% 50.95%
##   165:  24.29% 12.65% 51.43%
##   166:  24.14% 12.45% 51.43%
##   167:  24.00% 12.65% 50.48%
##   168:  24.29% 12.65% 51.43%
##   169:  24.29% 12.86% 50.95%
##   170:  24.14% 12.65% 50.95%
##   171:  24.14% 12.65% 50.95%
##   172:  24.14% 12.86% 50.48%
##   173:  24.14% 12.86% 50.48%
##   174:  24.71% 13.06% 51.90%
##   175:  24.71% 13.27% 51.43%
##   176:  24.43% 13.06% 50.95%
##   177:  24.14% 12.86% 50.48%
##   178:  24.43% 13.06% 50.95%
##   179:  24.14% 12.65% 50.95%
##   180:  24.43% 12.86% 51.43%
##   181:  24.29% 12.65% 51.43%
##   182:  24.29% 12.65% 51.43%
##   183:  24.57% 13.06% 51.43%
##   184:  24.57% 12.65% 52.38%
##   185:  24.71% 13.06% 51.90%
##   186:  24.71% 13.06% 51.90%
##   187:  24.43% 12.86% 51.43%
##   188:  24.43% 13.06% 50.95%
##   189:  24.57% 12.86% 51.90%
##   190:  24.29% 12.86% 50.95%
##   191:  24.29% 12.65% 51.43%
##   192:  24.29% 12.45% 51.90%
##   193:  24.43% 12.86% 51.43%
##   194:  24.00% 12.65% 50.48%
##   195:  24.00% 12.45% 50.95%
##   196:  24.00% 12.65% 50.48%
##   197:  24.43% 13.06% 50.95%
##   198:  24.57% 13.27% 50.95%
##   199:  24.57% 13.06% 51.43%
##   200:  24.29% 13.06% 50.48%
##   201:  24.57% 13.47% 50.48%
##   202:  24.86% 13.67% 50.95%
##   203:  24.71% 13.27% 51.43%
##   204:  24.43% 13.06% 50.95%
##   205:  24.43% 12.86% 51.43%
##   206:  24.14% 12.65% 50.95%
##   207:  24.57% 12.86% 51.90%
##   208:  24.43% 12.86% 51.43%
##   209:  24.29% 12.65% 51.43%
##   210:  24.57% 13.06% 51.43%
##   211:  24.57% 13.06% 51.43%
##   212:  24.57% 12.86% 51.90%
##   213:  24.57% 13.06% 51.43%
##   214:  24.57% 13.06% 51.43%
##   215:  24.43% 12.86% 51.43%
##   216:  24.43% 13.06% 50.95%
##   217:  24.57% 13.06% 51.43%
##   218:  24.14% 12.65% 50.95%
##   219:  24.29% 12.65% 51.43%
##   220:  24.00% 12.45% 50.95%
##   221:  24.14% 12.65% 50.95%
##   222:  24.14% 12.65% 50.95%
##   223:  24.14% 12.65% 50.95%
##   224:  24.14% 12.65% 50.95%
##   225:  24.00% 12.45% 50.95%
##   226:  24.14% 12.86% 50.48%
##   227:  24.29% 12.65% 51.43%
##   228:  24.14% 12.45% 51.43%
##   229:  24.00% 12.24% 51.43%
##   230:  23.71% 12.04% 50.95%
##   231:  24.43% 12.65% 51.90%
##   232:  24.29% 12.45% 51.90%
##   233:  24.43% 12.86% 51.43%
##   234:  24.29% 12.45% 51.90%
##   235:  24.71% 13.06% 51.90%
##   236:  24.71% 12.86% 52.38%
##   237:  24.71% 12.65% 52.86%
##   238:  24.71% 12.65% 52.86%
##   239:  24.57% 12.65% 52.38%
##   240:  24.57% 12.65% 52.38%
##   241:  24.43% 12.65% 51.90%
##   242:  24.29% 12.45% 51.90%
##   243:  24.00% 12.24% 51.43%
##   244:  24.57% 12.65% 52.38%
##   245:  24.71% 12.86% 52.38%
##   246:  24.43% 12.65% 51.90%
##   247:  24.29% 12.65% 51.43%
##   248:  24.43% 12.65% 51.90%
##   249:  24.43% 12.86% 51.43%
##   250:  24.71% 12.86% 52.38%
##   251:  24.57% 12.86% 51.90%
##   252:  24.29% 12.65% 51.43%
##   253:  24.29% 12.45% 51.90%
##   254:  24.57% 12.65% 52.38%
##   255:  24.57% 12.65% 52.38%
##   256:  24.57% 12.65% 52.38%
##   257:  24.57% 12.45% 52.86%
##   258:  24.29% 12.24% 52.38%
##   259:  24.43% 12.45% 52.38%
##   260:  24.43% 12.24% 52.86%
##   261:  24.14% 12.04% 52.38%
##   262:  24.29% 12.24% 52.38%
##   263:  24.29% 12.24% 52.38%
##   264:  24.29% 12.24% 52.38%
##   265:  24.29% 12.24% 52.38%
##   266:  24.29% 12.24% 52.38%
##   267:  24.43% 12.24% 52.86%
##   268:  24.43% 12.45% 52.38%
##   269:  24.71% 12.65% 52.86%
##   270:  24.57% 12.65% 52.38%
##   271:  24.43% 12.45% 52.38%
##   272:  24.29% 12.24% 52.38%
##   273:  24.29% 12.24% 52.38%
##   274:  24.29% 12.04% 52.86%
##   275:  24.14% 12.04% 52.38%
##   276:  24.57% 12.45% 52.86%
##   277:  24.43% 12.24% 52.86%
##   278:  24.43% 12.24% 52.86%
##   279:  24.43% 12.24% 52.86%
##   280:  24.43% 12.24% 52.86%
##   281:  24.43% 12.24% 52.86%
##   282:  24.29% 12.45% 51.90%
##   283:  24.29% 12.24% 52.38%
##   284:  24.29% 12.24% 52.38%
##   285:  24.43% 12.45% 52.38%
##   286:  24.57% 12.45% 52.86%
##   287:  24.43% 12.24% 52.86%
##   288:  24.57% 12.65% 52.38%
##   289:  24.71% 12.65% 52.86%
##   290:  24.71% 12.65% 52.86%
##   291:  24.71% 12.86% 52.38%
##   292:  24.71% 12.86% 52.38%
##   293:  24.71% 12.86% 52.38%
##   294:  24.86% 12.86% 52.86%
##   295:  24.71% 12.86% 52.38%
##   296:  24.57% 12.65% 52.38%
##   297:  24.86% 12.86% 52.86%
##   298:  24.86% 13.06% 52.38%
##   299:  24.71% 12.86% 52.38%
##   300:  24.86% 13.06% 52.38%
##   301:  25.00% 13.06% 52.86%
##   302:  24.86% 13.06% 52.38%
##   303:  24.86% 13.06% 52.38%
##   304:  25.00% 13.27% 52.38%
##   305:  24.71% 12.86% 52.38%
##   306:  25.14% 13.27% 52.86%
##   307:  25.00% 13.27% 52.38%
##   308:  24.86% 12.86% 52.86%
##   309:  25.00% 13.06% 52.86%
##   310:  25.29% 13.06% 53.81%
##   311:  25.14% 13.06% 53.33%
##   312:  25.14% 12.86% 53.81%
##   313:  25.14% 13.27% 52.86%
##   314:  25.00% 12.86% 53.33%
##   315:  25.43% 13.27% 53.81%
##   316:  25.43% 13.27% 53.81%
##   317:  25.29% 13.27% 53.33%
##   318:  25.14% 13.06% 53.33%
##   319:  25.29% 13.06% 53.81%
##   320:  25.14% 13.06% 53.33%
##   321:  25.00% 12.86% 53.33%
##   322:  25.00% 12.86% 53.33%
##   323:  25.00% 12.86% 53.33%
##   324:  24.86% 12.86% 52.86%
##   325:  24.43% 12.45% 52.38%
##   326:  24.57% 12.65% 52.38%
##   327:  24.86% 12.86% 52.86%
##   328:  25.00% 13.27% 52.38%
##   329:  25.00% 13.06% 52.86%
##   330:  25.14% 13.06% 53.33%
##   331:  24.86% 13.06% 52.38%
##   332:  25.14% 13.06% 53.33%
##   333:  25.14% 13.06% 53.33%
##   334:  24.71% 12.86% 52.38%
##   335:  24.86% 12.86% 52.86%
##   336:  25.00% 13.06% 52.86%
##   337:  24.71% 12.86% 52.38%
##   338:  25.00% 12.86% 53.33%
##   339:  25.29% 13.06% 53.81%
##   340:  25.29% 13.27% 53.33%
##   341:  25.14% 13.06% 53.33%
##   342:  24.71% 12.45% 53.33%
##   343:  25.14% 13.06% 53.33%
##   344:  25.14% 13.06% 53.33%
##   345:  25.14% 13.06% 53.33%
##   346:  24.86% 12.86% 52.86%
##   347:  25.14% 12.86% 53.81%
##   348:  25.00% 12.65% 53.81%
##   349:  24.86% 12.65% 53.33%
##   350:  24.71% 12.65% 52.86%
##   351:  24.57% 12.45% 52.86%
##   352:  24.86% 12.86% 52.86%
##   353:  24.86% 12.86% 52.86%
##   354:  24.86% 12.86% 52.86%
##   355:  24.86% 12.86% 52.86%
##   356:  24.86% 12.86% 52.86%
##   357:  24.86% 12.86% 52.86%
##   358:  24.86% 12.86% 52.86%
##   359:  24.71% 12.65% 52.86%
##   360:  24.57% 12.45% 52.86%
##   361:  24.71% 12.45% 53.33%
##   362:  24.86% 12.65% 53.33%
##   363:  25.14% 13.06% 53.33%
##   364:  25.14% 13.06% 53.33%
##   365:  24.86% 12.65% 53.33%
##   366:  24.71% 12.65% 52.86%
##   367:  24.86% 12.86% 52.86%
##   368:  25.29% 13.06% 53.81%
##   369:  25.29% 13.06% 53.81%
##   370:  25.14% 13.06% 53.33%
##   371:  25.14% 12.86% 53.81%
##   372:  25.29% 13.06% 53.81%
##   373:  25.00% 12.65% 53.81%
##   374:  25.00% 12.86% 53.33%
##   375:  25.14% 12.86% 53.81%
##   376:  25.00% 12.65% 53.81%
##   377:  25.00% 12.45% 54.29%
##   378:  24.86% 12.24% 54.29%
##   379:  24.57% 12.24% 53.33%
##   380:  24.71% 12.24% 53.81%
##   381:  24.71% 12.45% 53.33%
##   382:  24.57% 12.24% 53.33%
##   383:  24.71% 12.45% 53.33%
##   384:  24.57% 12.04% 53.81%
##   385:  25.00% 12.86% 53.33%
##   386:  24.57% 12.45% 52.86%
##   387:  24.57% 12.45% 52.86%
##   388:  24.43% 12.24% 52.86%
##   389:  24.71% 12.45% 53.33%
##   390:  24.57% 12.24% 53.33%
##   391:  24.86% 12.65% 53.33%
##   392:  24.86% 12.65% 53.33%
##   393:  24.86% 12.65% 53.33%
##   394:  24.86% 12.86% 52.86%
##   395:  24.71% 12.65% 52.86%
##   396:  25.00% 12.86% 53.33%
##   397:  24.86% 12.65% 53.33%
##   398:  24.57% 12.45% 52.86%
##   399:  24.57% 12.45% 52.86%
##   400:  24.71% 12.65% 52.86%
##   401:  24.71% 12.65% 52.86%
##   402:  24.57% 12.45% 52.86%
##   403:  24.57% 12.65% 52.38%
##   404:  25.00% 13.06% 52.86%
##   405:  24.86% 12.86% 52.86%
##   406:  24.71% 12.86% 52.38%
##   407:  24.86% 12.86% 52.86%
##   408:  25.00% 13.06% 52.86%
##   409:  25.14% 13.06% 53.33%
##   410:  25.00% 12.86% 53.33%
##   411:  25.00% 13.06% 52.86%
##   412:  25.14% 13.06% 53.33%
##   413:  25.00% 12.86% 53.33%
##   414:  25.00% 13.06% 52.86%
##   415:  25.14% 12.86% 53.81%
##   416:  25.29% 13.27% 53.33%
##   417:  25.00% 13.06% 52.86%
##   418:  25.00% 13.06% 52.86%
##   419:  25.00% 13.06% 52.86%
##   420:  25.29% 13.06% 53.81%
##   421:  25.29% 13.06% 53.81%
##   422:  25.29% 13.06% 53.81%
##   423:  25.29% 13.06% 53.81%
##   424:  25.14% 13.27% 52.86%
##   425:  25.14% 13.27% 52.86%
##   426:  25.14% 13.27% 52.86%
##   427:  25.00% 13.06% 52.86%
##   428:  25.00% 13.06% 52.86%
##   429:  25.14% 13.06% 53.33%
##   430:  25.14% 12.86% 53.81%
##   431:  25.00% 12.86% 53.33%
##   432:  25.00% 13.06% 52.86%
##   433:  25.29% 13.27% 53.33%
##   434:  25.14% 13.06% 53.33%
##   435:  25.00% 13.06% 52.86%
##   436:  25.00% 13.27% 52.38%
##   437:  25.14% 13.27% 52.86%
##   438:  25.14% 13.27% 52.86%
##   439:  25.14% 13.27% 52.86%
##   440:  25.14% 13.27% 52.86%
##   441:  25.14% 13.27% 52.86%
##   442:  25.29% 13.27% 53.33%
##   443:  25.14% 13.27% 52.86%
##   444:  25.14% 13.27% 52.86%
##   445:  25.29% 13.47% 52.86%
##   446:  24.86% 13.06% 52.38%
##   447:  25.00% 13.06% 52.86%
##   448:  25.00% 13.06% 52.86%
##   449:  25.14% 13.27% 52.86%
##   450:  25.00% 13.06% 52.86%
##   451:  25.00% 13.27% 52.38%
##   452:  24.86% 13.06% 52.38%
##   453:  25.00% 13.27% 52.38%
##   454:  25.00% 13.27% 52.38%
##   455:  25.00% 13.27% 52.38%
##   456:  24.71% 12.86% 52.38%
##   457:  24.86% 13.06% 52.38%
##   458:  24.86% 13.06% 52.38%
##   459:  24.86% 13.06% 52.38%
##   460:  24.86% 12.86% 52.86%
##   461:  24.71% 13.06% 51.90%
##   462:  25.00% 13.06% 52.86%
##   463:  25.00% 12.86% 53.33%
##   464:  24.86% 12.86% 52.86%
##   465:  24.86% 12.86% 52.86%
##   466:  24.86% 12.86% 52.86%
##   467:  24.86% 12.86% 52.86%
##   468:  24.71% 12.86% 52.38%
##   469:  25.00% 13.06% 52.86%
##   470:  25.14% 13.06% 53.33%
##   471:  25.29% 13.27% 53.33%
##   472:  24.86% 12.86% 52.86%
##   473:  25.00% 12.86% 53.33%
##   474:  24.86% 12.86% 52.86%
##   475:  25.00% 12.86% 53.33%
##   476:  24.86% 12.65% 53.33%
##   477:  24.71% 12.65% 52.86%
##   478:  25.29% 13.06% 53.81%
##   479:  25.29% 13.06% 53.81%
##   480:  25.14% 12.86% 53.81%
##   481:  25.29% 13.06% 53.81%
##   482:  25.14% 12.86% 53.81%
##   483:  25.00% 12.86% 53.33%
##   484:  25.00% 12.86% 53.33%
##   485:  25.00% 12.86% 53.33%
##   486:  24.71% 12.65% 52.86%
##   487:  24.71% 12.65% 52.86%
##   488:  24.71% 12.65% 52.86%
##   489:  24.57% 12.86% 51.90%
##   490:  24.71% 13.06% 51.90%
##   491:  24.43% 12.65% 51.90%
##   492:  24.57% 12.45% 52.86%
##   493:  24.57% 12.45% 52.86%
##   494:  24.57% 12.65% 52.38%
##   495:  24.57% 12.65% 52.38%
##   496:  24.43% 12.45% 52.38%
##   497:  24.43% 12.24% 52.86%
##   498:  24.29% 12.45% 51.90%
##   499:  24.29% 12.45% 51.90%
##   500:  24.71% 12.86% 52.38%</code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/metrics.html">metrics</a></span><span class="op">(</span>
  <span class="va">train_data</span><span class="op">$</span><span class="va">bad_good</span>, 
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_rf</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.414 0.770  1.18 0.540</code></pre>
</div>
<div id="feature-selection-via-glmnet" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-glmnet" class="anchor"></a>Feature selection via glmnet</h3>
<p>From <a href="https://glmnet.stanford.edu/articles/glmnet.html" class="uri">https://glmnet.stanford.edu/articles/glmnet.html</a></p>
<p>There 2 option for <code>S</code>: <code>lambda.min</code> and <code>lambda.1se</code> , this last option you have a more regularized model.</p>
<p>This wrapper around the glmnet package take a model as input, then return the model with the variables non zero from the <code><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet::cv.glmnet()</a></code> function according with the selected <code>S</code> option. This function reorder the variables in the same order the coefficient in the glmnet model turn to non zero (check the plots when run this funtion).</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsglmnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_glmnet.html">featsel_glmnet</a></span><span class="op">(</span><span class="va">model_raw</span>, S <span class="op">=</span> <span class="st">"lambda.1se"</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Training
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%
## Fold: 1/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%
## Fold: 2/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%
## Fold: 3/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%
## Fold: 4/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |======================================================================| 100%
## Fold: 5/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%
## Fold: 6/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%
## Fold: 7/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |======================================================================| 100%
## Fold: 8/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%
## Fold: 9/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |======================================================================| 100%
## Fold: 10/10
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |======================================================================| 100%</code></pre>
<p><img src="risk3r_files/figure-html/unnamed-chunk-26-1.png" width="700"><img src="risk3r_files/figure-html/unnamed-chunk-26-2.png" width="700"><img src="risk3r_files/figure-html/unnamed-chunk-26-3.png" width="700"></p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                               -0.839    0.0993     -8.45 2.83e-17
## 2 status.of.existing.checking.account_woe    0.788    0.128       6.18 6.51e-10
## 3 duration.in.month_woe                      0.889    0.190       4.67 2.98e- 6
## 4 credit.amount_woe                          0.895    0.238       3.76 1.68e- 4
## 5 credit.history_woe                         0.742    0.211       3.52 4.31e- 4
## 6 savings.account.and.bonds_woe              0.838    0.216       3.87 1.07e- 4
## 7 age.in.years_woe                           0.792    0.235       3.37 7.51e- 4
## 8 purpose_woe                                1.31     0.337       3.89 1.02e- 4
## 9 present.employment.since_woe               0.841    0.377       2.23 2.56e- 2</code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -0.839    0.0993     -8.45 2.83e-17</code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">THEME</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-26-4.png" width="700"></p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.531 0.821  1.65 0.642</code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsglmnet</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.470 0.799  1.44 0.599</code></pre>
</div>
<div id="feature-selection-via-setpwise-forward" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-setpwise-forward" class="anchor"></a>Feature selection via Setpwise forward</h3>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsstep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_stepforward.html">featsel_stepforward</a></span><span class="op">(</span><span class="va">model_raw</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Start:  AIC=857.21
## bad_good ~ 1
## 
##                                                           Df Deviance    AIC
## + status.of.existing.checking.account_woe                  1   766.47 770.47
## + duration.in.month_woe                                    1   811.22 815.22
## + credit.history_woe                                       1   822.51 826.51
## + savings.account.and.bonds_woe                            1   823.46 827.46
## + credit.amount_woe                                        1   826.82 830.82
## + age.in.years_woe                                         1   830.74 834.74
## + housing_woe                                              1   841.71 845.71
## + purpose_woe                                              1   841.87 845.87
## + property_woe                                             1   844.13 848.13
## + present.employment.since_woe                             1   845.32 849.32
## + other.installment.plans_woe                              1   849.84 853.84
## + installment.rate.in.percentage.of.disposable.income_woe  1   851.58 855.58
## &lt;none&gt;                                                         855.21 857.21
## 
## Step:  AIC=770.47
## bad_good ~ status.of.existing.checking.account_woe
## 
##                                                           Df Deviance    AIC
## + duration.in.month_woe                                    1   727.50 733.50
## + credit.amount_woe                                        1   738.49 744.49
## + credit.history_woe                                       1   746.45 752.45
## + savings.account.and.bonds_woe                            1   751.71 757.71
## + age.in.years_woe                                         1   753.42 759.42
## + property_woe                                             1   757.98 763.98
## + purpose_woe                                              1   758.43 764.43
## + present.employment.since_woe                             1   759.85 765.85
## + housing_woe                                              1   760.62 766.62
## + installment.rate.in.percentage.of.disposable.income_woe  1   762.75 768.75
## + other.installment.plans_woe                              1   763.91 769.91
## &lt;none&gt;                                                         766.47 770.47
## - status.of.existing.checking.account_woe                  1   855.21 857.21
## 
## Step:  AIC=733.5
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe
## 
##                                                           Df Deviance    AIC
## + savings.account.and.bonds_woe                            1   710.59 718.59
## + age.in.years_woe                                         1   712.29 720.29
## + credit.history_woe                                       1   714.33 722.33
## + credit.amount_woe                                        1   716.17 724.17
## + purpose_woe                                              1   716.65 724.65
## + present.employment.since_woe                             1   718.20 726.20
## + housing_woe                                              1   723.78 731.78
## + installment.rate.in.percentage.of.disposable.income_woe  1   724.64 732.64
## + other.installment.plans_woe                              1   725.30 733.30
## &lt;none&gt;                                                         727.50 733.50
## + property_woe                                             1   726.03 734.03
## - duration.in.month_woe                                    1   766.47 770.47
## - status.of.existing.checking.account_woe                  1   811.22 815.22
## 
## Step:  AIC=718.59
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     savings.account.and.bonds_woe
## 
##                                                           Df Deviance    AIC
## + credit.history_woe                                       1   695.73 705.73
## + age.in.years_woe                                         1   696.01 706.01
## + credit.amount_woe                                        1   699.59 709.59
## + purpose_woe                                              1   700.26 710.26
## + present.employment.since_woe                             1   702.87 712.87
## + installment.rate.in.percentage.of.disposable.income_woe  1   707.12 717.12
## + housing_woe                                              1   707.30 717.30
## + other.installment.plans_woe                              1   707.81 717.81
## &lt;none&gt;                                                         710.59 718.59
## + property_woe                                             1   708.84 718.84
## - savings.account.and.bonds_woe                            1   727.50 733.50
## - duration.in.month_woe                                    1   751.71 757.71
## - status.of.existing.checking.account_woe                  1   775.54 781.54
## 
## Step:  AIC=705.73
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     savings.account.and.bonds_woe + credit.history_woe
## 
##                                                           Df Deviance    AIC
## + age.in.years_woe                                         1   683.51 695.51
## + purpose_woe                                              1   684.20 696.20
## + credit.amount_woe                                        1   684.87 696.87
## + present.employment.since_woe                             1   689.25 701.25
## + installment.rate.in.percentage.of.disposable.income_woe  1   691.59 703.59
## + housing_woe                                              1   692.97 704.97
## &lt;none&gt;                                                         695.73 705.73
## + property_woe                                             1   693.81 705.81
## + other.installment.plans_woe                              1   694.20 706.20
## - credit.history_woe                                       1   710.59 718.59
## - savings.account.and.bonds_woe                            1   714.33 722.33
## - duration.in.month_woe                                    1   729.81 737.81
## - status.of.existing.checking.account_woe                  1   749.67 757.67
## 
## Step:  AIC=695.51
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     savings.account.and.bonds_woe + credit.history_woe + age.in.years_woe
## 
##                                                           Df Deviance    AIC
## + purpose_woe                                              1   670.72 684.72
## + credit.amount_woe                                        1   672.30 686.30
## + installment.rate.in.percentage.of.disposable.income_woe  1   679.32 693.32
## + present.employment.since_woe                             1   679.37 693.37
## + property_woe                                             1   680.51 694.51
## &lt;none&gt;                                                         683.51 695.51
## + other.installment.plans_woe                              1   681.73 695.73
## + housing_woe                                              1   682.15 696.15
## - age.in.years_woe                                         1   695.73 705.73
## - credit.history_woe                                       1   696.01 706.01
## - savings.account.and.bonds_woe                            1   701.39 711.39
## - duration.in.month_woe                                    1   719.81 729.81
## - status.of.existing.checking.account_woe                  1   730.47 740.47
## 
## Step:  AIC=684.72
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     savings.account.and.bonds_woe + credit.history_woe + age.in.years_woe + 
##     purpose_woe
## 
##                                                           Df Deviance    AIC
## + credit.amount_woe                                        1   656.50 672.50
## + installment.rate.in.percentage.of.disposable.income_woe  1   666.01 682.01
## + present.employment.since_woe                             1   666.45 682.45
## + property_woe                                             1   667.85 683.85
## &lt;none&gt;                                                         670.72 684.72
## + housing_woe                                              1   669.37 685.37
## + other.installment.plans_woe                              1   669.50 685.50
## - purpose_woe                                              1   683.51 695.51
## - credit.history_woe                                       1   684.06 696.06
## - age.in.years_woe                                         1   684.20 696.20
## - savings.account.and.bonds_woe                            1   688.23 700.23
## - duration.in.month_woe                                    1   709.67 721.67
## - status.of.existing.checking.account_woe                  1   712.90 724.90
## 
## Step:  AIC=672.5
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     savings.account.and.bonds_woe + credit.history_woe + age.in.years_woe + 
##     purpose_woe + credit.amount_woe
## 
##                                                           Df Deviance    AIC
## + installment.rate.in.percentage.of.disposable.income_woe  1   648.80 666.80
## + present.employment.since_woe                             1   651.54 669.54
## &lt;none&gt;                                                         656.50 672.50
## + housing_woe                                              1   654.89 672.89
## + property_woe                                             1   655.16 673.16
## + other.installment.plans_woe                              1   655.57 673.57
## - credit.history_woe                                       1   670.00 684.00
## - age.in.years_woe                                         1   670.59 684.59
## - credit.amount_woe                                        1   670.72 684.72
## - purpose_woe                                              1   672.30 686.30
## - savings.account.and.bonds_woe                            1   673.60 687.60
## - duration.in.month_woe                                    1   679.18 693.18
## - status.of.existing.checking.account_woe                  1   698.42 712.42
## 
## Step:  AIC=666.8
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     savings.account.and.bonds_woe + credit.history_woe + age.in.years_woe + 
##     purpose_woe + credit.amount_woe + installment.rate.in.percentage.of.disposable.income_woe
## 
##                                                           Df Deviance    AIC
## + present.employment.since_woe                             1   643.22 663.22
## + housing_woe                                              1   646.46 666.46
## &lt;none&gt;                                                         648.80 666.80
## + other.installment.plans_woe                              1   647.49 667.49
## + property_woe                                             1   647.50 667.50
## - installment.rate.in.percentage.of.disposable.income_woe  1   656.50 672.50
## - age.in.years_woe                                         1   663.09 679.09
## - credit.history_woe                                       1   663.22 679.22
## - purpose_woe                                              1   665.57 681.57
## - credit.amount_woe                                        1   666.01 682.01
## - savings.account.and.bonds_woe                            1   666.73 682.73
## - duration.in.month_woe                                    1   668.75 684.75
## - status.of.existing.checking.account_woe                  1   690.45 706.45
## 
## Step:  AIC=663.22
## bad_good ~ status.of.existing.checking.account_woe + duration.in.month_woe + 
##     savings.account.and.bonds_woe + credit.history_woe + age.in.years_woe + 
##     purpose_woe + credit.amount_woe + installment.rate.in.percentage.of.disposable.income_woe + 
##     present.employment.since_woe
## 
##                                                           Df Deviance    AIC
## &lt;none&gt;                                                         643.22 663.22
## + housing_woe                                              1   641.25 663.25
## + other.installment.plans_woe                              1   641.84 663.84
## + property_woe                                             1   642.09 664.09
## - present.employment.since_woe                             1   648.80 666.80
## - installment.rate.in.percentage.of.disposable.income_woe  1   651.54 669.54
## - age.in.years_woe                                         1   654.86 672.86
## - credit.history_woe                                       1   656.88 674.88
## - savings.account.and.bonds_woe                            1   660.00 678.00
## - purpose_woe                                              1   660.25 678.25
## - credit.amount_woe                                        1   661.32 679.32
## - duration.in.month_woe                                    1   664.65 682.65
## - status.of.existing.checking.account_woe                  1   684.75 702.75</code></pre>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    term                                    estimate std.error statistic  p.value
##    &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)                               -0.847     0.100     -8.46 2.74e-17
##  2 status.of.existing.checking.account_woe    0.787     0.128      6.16 7.43e-10
##  3 duration.in.month_woe                      0.858     0.194      4.42 9.85e- 6
##  4 savings.account.and.bonds_woe              0.863     0.218      3.96 7.49e- 5
##  5 credit.history_woe                         0.768     0.212      3.62 2.93e- 4
##  6 age.in.years_woe                           0.807     0.237      3.40 6.80e- 4
##  7 purpose_woe                                1.37      0.343      3.99 6.51e- 5
##  8 credit.amount_woe                          1.00      0.242      4.14 3.51e- 5
##  9 installment.rate.in.percentage.of.disp~    1.82      0.635      2.86 4.23e- 3
## 10 present.employment.since_woe               0.900     0.380      2.37 1.79e- 2</code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -0.847     0.100     -8.46 2.74e-17</code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">THEME</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.545 0.827  1.79 0.655</code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_fsstep</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.487 0.804  1.67 0.608</code></pre>
</div>
<div id="feature-selection-via-repetitive-round-of-drop-out-loss" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-selection-via-repetitive-round-of-drop-out-loss" class="anchor"></a>Feature selection via repetitive round of drop out loss</h3>
<p>From <a href="https://ema.drwhy.ai/featureImportance.html" class="uri">https://ema.drwhy.ai/featureImportance.html</a></p>
<p>The <code>stat = "min"</code> option give the most simpler model because It’more strict: If any iteration the loss increase then the variable is removed. You can choose between <code><a href="https://rdrr.io/r/base/c.html">c("q25", "mean", "median")</a></code></p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_lss_prmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_loss_function_permutations.html">featsel_loss_function_permutations</a></span><span class="op">(</span>
  <span class="va">model_raw</span>, 
  stat <span class="op">=</span><span class="st">"min"</span>,
  B <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Preparation of a new explainer is initiated
##   -&gt; model label       :  Round 1 
##   -&gt; data              :  700  rows  12  cols 
##   -&gt; data              :  tibble converted into a data.frame 
##   -&gt; target variable   :  700  values 
##   -&gt; predict function  :  yhat.glm  will be used ( [33m default [39m )
##   -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
##   -&gt; model_info        :  package stats , ver. 3.6.3 , task classification ( [33m default [39m ) 
##   -&gt; predicted values  :  numerical, min =  0.008354343 , mean =  0.3 , max =  0.9693876  
##   -&gt; residual function :  difference between y and yhat ( [33m default [39m )
##   -&gt; residuals         :  numerical, min =  0.07748504 , mean =  1 , max =  1.976279  
##  [32m A new explainer has been created! [39m 
## Preparation of a new explainer is initiated
##   -&gt; model label       :  Round 2 
##   -&gt; data              :  700  rows  9  cols 
##   -&gt; data              :  tibble converted into a data.frame 
##   -&gt; target variable   :  700  values 
##   -&gt; predict function  :  yhat.glm  will be used ( [33m default [39m )
##   -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
##   -&gt; model_info        :  package stats , ver. 3.6.3 , task classification ( [33m default [39m ) 
##   -&gt; predicted values  :  numerical, min =  0.007137749 , mean =  0.3 , max =  0.968262  
##   -&gt; residual function :  difference between y and yhat ( [33m default [39m )
##   -&gt; residuals         :  numerical, min =  0.05687253 , mean =  1 , max =  1.974235  
##  [32m A new explainer has been created! [39m</code></pre>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, <span class="st">"plots"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="va">THEME</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -0.847     0.100     -8.46 2.74e-17</code></pre>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">THEME</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-28-2.png" width="700"></p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.545 0.827  1.79 0.655</code></pre>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_metrics.html">model_metrics</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##      ks   auc    iv  gini
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.487 0.804  1.67 0.608</code></pre>
</div>
<div id="comparing-models" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-models" class="anchor"></a>Comparing models</h3>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">model_raw</span>, 
  <span class="va">model_fsstep</span>,
  <span class="va">model_fsglmnet</span>,
  <span class="va">model_lss_prmt</span>
  <span class="op">)</span>

<span class="va">dmodels</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>model <span class="op">=</span> <span class="va">models</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    model_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"stepwise"</span>, <span class="st">"glmnet"</span>, <span class="st">"dropout_loss"</span><span class="op">)</span>,
    .before <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    terms              <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span>,
    n_variables        <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">terms</span>, <span class="va">nrow</span><span class="op">)</span>,
    metrics            <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">model_metrics</span><span class="op">)</span>,
    metrics_validation <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">model_metrics</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">dmodels</span></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   model_name   model  terms          n_variables metrics       metrics_validati~
##   &lt;chr&gt;        &lt;list&gt; &lt;list&gt;               &lt;dbl&gt; &lt;list&gt;        &lt;list&gt;           
## 1 raw          &lt;glm&gt;  &lt;tibble [13 x~          13 &lt;tibble [1 x~ &lt;tibble [1 x 4]&gt; 
## 2 stepwise     &lt;glm&gt;  &lt;tibble [10 x~          10 &lt;tibble [1 x~ &lt;tibble [1 x 4]&gt; 
## 3 glmnet       &lt;glm&gt;  &lt;tibble [9 x ~           9 &lt;tibble [1 x~ &lt;tibble [1 x 4]&gt; 
## 4 dropout_loss &lt;glm&gt;  &lt;tibble [10 x~          10 &lt;tibble [1 x~ &lt;tibble [1 x 4]&gt;</code></pre>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmodels</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">model_name</span>, <span class="va">terms</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">terms</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">model_name</span>, <span class="va">term</span>, <span class="va">estimate</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">term</span>, <span class="va">model_name</span>, fill <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dmodels</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">model_name</span>, <span class="va">metrics</span>, <span class="va">metrics_validation</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">value</span>, <span class="op">-</span><span class="va">model_name</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">metric</span>, <span class="va">value</span>, <span class="op">-</span><span class="va">model_name</span>, <span class="op">-</span><span class="va">sample</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sample</span> <span class="op">==</span> <span class="st">"metrics"</span>, <span class="st">"train"</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">model_name</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">sample</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">metric</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>begin <span class="op">=</span> <span class="fl">0.3</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_percent.html">percent</a></span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-29-2.png" width="700"></p>
</div>
<div id="partial-preditive-measures" class="section level3">
<h3 class="hasAnchor">
<a href="#partial-preditive-measures" class="anchor"></a>Partial preditive measures</h3>
<p>See if we can remove variables via inspecting predictive measures.</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">nrow</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 13
## 
## [[2]]
## [1] 10
## 
## [[3]]
## [1] 9
## 
## [[4]]
## [1] 10</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">head</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 6 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                               -0.848     0.100     -8.43 3.36e-17
## 2 status.of.existing.checking.account_woe    0.761     0.128      5.93 3.05e- 9
## 3 duration.in.month_woe                      0.815     0.198      4.12 3.83e- 5
## 4 credit.history_woe                         0.736     0.214      3.45 5.69e- 4
## 5 purpose_woe                                1.34      0.343      3.89 9.87e- 5
## 6 credit.amount_woe                          0.987     0.245      4.02 5.71e- 5
## 
## [[2]]
## # A tibble: 6 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                               -0.847     0.100     -8.46 2.74e-17
## 2 status.of.existing.checking.account_woe    0.787     0.128      6.16 7.43e-10
## 3 duration.in.month_woe                      0.858     0.194      4.42 9.85e- 6
## 4 savings.account.and.bonds_woe              0.863     0.218      3.96 7.49e- 5
## 5 credit.history_woe                         0.768     0.212      3.62 2.93e- 4
## 6 age.in.years_woe                           0.807     0.237      3.40 6.80e- 4
## 
## [[3]]
## # A tibble: 6 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                               -0.839    0.0993     -8.45 2.83e-17
## 2 status.of.existing.checking.account_woe    0.788    0.128       6.18 6.51e-10
## 3 duration.in.month_woe                      0.889    0.190       4.67 2.98e- 6
## 4 credit.amount_woe                          0.895    0.238       3.76 1.68e- 4
## 5 credit.history_woe                         0.742    0.211       3.52 4.31e- 4
## 6 savings.account.and.bonds_woe              0.838    0.216       3.87 1.07e- 4
## 
## [[4]]
## # A tibble: 6 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                               -0.847     0.100     -8.46 2.74e-17
## 2 status.of.existing.checking.account_woe    0.787     0.128      6.16 7.43e-10
## 3 duration.in.month_woe                      0.858     0.194      4.42 9.85e- 6
## 4 credit.amount_woe                          1.00      0.242      4.14 3.51e- 5
## 5 savings.account.and.bonds_woe              0.863     0.218      3.96 7.49e- 5
## 6 age.in.years_woe                           0.807     0.237      3.40 6.80e- 4</code></pre>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_final</span> <span class="op">&lt;-</span> <span class="va">model_lss_prmt</span>

<span class="va">dfmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_partials.html">model_partials</a></span><span class="op">(</span><span class="va">model_final</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span>
<span class="va">dfmetrics</span></code></pre></div>
<pre><code>## # A tibble: 18 x 6
##    variable                                       sample    ks   auc    iv  gini
##    &lt;fct&gt;                                          &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 status.of.existing.checking.account_woe        train  0.352 0.706 0.641 0.412
##  2 status.of.existing.checking.account_woe        test   0.403 0.712 0.756 0.424
##  3 duration.in.month_woe                          train  0.386 0.755 0.938 0.511
##  4 duration.in.month_woe                          test   0.376 0.747 0.870 0.493
##  5 credit.amount_woe                              train  0.4   0.766 1.07  0.531
##  6 credit.amount_woe                              test   0.417 0.765 1.19  0.530
##  7 savings.account.and.bonds_woe                  train  0.427 0.782 1.16  0.563
##  8 savings.account.and.bonds_woe                  test   0.432 0.752 1.03  0.504
##  9 age.in.years_woe                               train  0.464 0.793 1.23  0.587
## 10 age.in.years_woe                               test   0.395 0.739 1.05  0.478
## 11 credit.history_woe                             train  0.487 0.804 1.34  0.608
## 12 credit.history_woe                             test   0.432 0.770 1.13  0.540
## 13 purpose_woe                                    train  0.511 0.816 1.56  0.633
## 14 purpose_woe                                    test   0.462 0.796 1.36  0.592
## 15 present.employment.since_woe                   train  0.531 0.821 1.65  0.642
## 16 present.employment.since_woe                   test   0.470 0.799 1.44  0.599
## 17 installment.rate.in.percentage.of.disposable.~ train  0.545 0.827 1.79  0.655
## 18 installment.rate.in.percentage.of.disposable.~ test   0.487 0.804 1.67  0.608</code></pre>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfmetrics</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">gini</span>, <span class="op">-</span><span class="va">iv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">risk3r</span><span class="fu">:::</span><span class="fu"><a href="../reference/plot.model_partials.html">plot.model_partials</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
</div>
<div id="performance-package" class="section level3">
<h3 class="hasAnchor">
<a href="#performance-package" class="anchor"></a><code>{performance}</code> package</h3>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html">check_model</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span>

<span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_collinearity.html">check_collinearity</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">THEME</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="risk3r_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span></code></pre></div>
<pre><code>##                 status.of.existing.checking.account_woe 
##                                                1.040104 
##                                   duration.in.month_woe 
##                                                1.135024 
##                                       credit.amount_woe 
##                                                1.165517 
##                           savings.account.and.bonds_woe 
##                                                1.050879 
##                                        age.in.years_woe 
##                                                1.051048 
##                                      credit.history_woe 
##                                                1.037964 
##                                             purpose_woe 
##                                                1.065483 
##                            present.employment.since_woe 
##                                                1.043198 
## installment.rate.in.percentage.of.disposable.income_woe 
##                                                1.044169</code></pre>
</div>
</div>
<div id="scorecard" class="section level2">
<h2 class="hasAnchor">
<a href="#scorecard" class="anchor"></a>Scorecard</h2>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">POINTS0</span>   <span class="op">&lt;-</span> <span class="fl">600</span>
<span class="va">PDO</span>       <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">ODDS0</span>     <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span>

<span class="va">scrcrd</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/scorecard.html">scorecard</a></span><span class="op">(</span>
  bins <span class="op">=</span> <span class="va">bins</span>,
  model <span class="op">=</span> <span class="va">model_final</span>,
  points0 <span class="op">=</span> <span class="va">POINTS0</span>,
  pdo <span class="op">=</span> <span class="va">PDO</span>,
  odds0 <span class="op">=</span> <span class="va">ODDS0</span>,
  basepoints_eq0 <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="va">scrcrd</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>##                               variable
## 1: status.of.existing.checking.account
## 2: status.of.existing.checking.account
## 3: status.of.existing.checking.account
## 4: status.of.existing.checking.account
##                                                       bin count count_distr neg
## 1:                                             ... &lt; 0 DM   197  0.28142857  99
## 2:                                      0 &lt;= ... &lt; 200 DM   184  0.26285714 116
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year    43  0.06142857  32
## 4:                                    no checking account   276  0.39428571 243
##    pos   posprob        woe      bin_iv  total_iv
## 1:  98 0.4974619  0.8371455 0.221530337 0.6409939
## 2:  68 0.3695652  0.3132154 0.027273175 0.6409939
## 3:  11 0.2558140 -0.2205428 0.002850553 0.6409939
## 4:  33 0.1195652 -1.1492560 0.389339795 0.6409939
##                                                    breaks is_special_values
## 1:                                             ... &lt; 0 DM             FALSE
## 2:                                      0 &lt;= ... &lt; 200 DM             FALSE
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year             FALSE
## 4:                                    no checking account             FALSE
##    points
## 1:     38
## 2:     50
## 3:     62
## 4:     83</code></pre>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrcrd2</span> <span class="op">&lt;-</span> <span class="fu">scorecard</span><span class="fu">::</span><span class="fu"><a href="http://shichen.name/scorecard/reference/scorecard2.html">scorecard2</a></span><span class="op">(</span>
  dt <span class="op">=</span>  <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="st">"bad_good"</span>,
  bins <span class="op">=</span> <span class="va">bins</span>,
  x <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_final</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"_woe$"</span><span class="op">)</span>,
  points0 <span class="op">=</span> <span class="va">POINTS0</span>,
  pdo <span class="op">=</span> <span class="va">PDO</span>,
  odds0 <span class="op">=</span> <span class="va">ODDS0</span>,
  basepoints_eq0 <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="va">scrcrd2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>##                               variable
## 1: status.of.existing.checking.account
## 2: status.of.existing.checking.account
## 3: status.of.existing.checking.account
## 4: status.of.existing.checking.account
##                                                       bin count count_distr neg
## 1:                                             ... &lt; 0 DM   197  0.28142857  99
## 2:                                      0 &lt;= ... &lt; 200 DM   184  0.26285714 116
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year    43  0.06142857  32
## 4:                                    no checking account   276  0.39428571 243
##    pos   posprob        woe      bin_iv  total_iv
## 1:  98 0.4974619  0.8371455 0.221530337 0.6409939
## 2:  68 0.3695652  0.3132154 0.027273175 0.6409939
## 3:  11 0.2558140 -0.2205428 0.002850553 0.6409939
## 4:  33 0.1195652 -1.1492560 0.389339795 0.6409939
##                                                    breaks is_special_values
## 1:                                             ... &lt; 0 DM             FALSE
## 2:                                      0 &lt;= ... &lt; 200 DM             FALSE
## 3: ... &gt;= 200 DM / salary assignments for at least 1 year             FALSE
## 4:                                    no checking account             FALSE
##    points
## 1:     38
## 2:     50
## 3:     62
## 4:     83</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua Kunst.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
