<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feature Selection • risk3r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Feature Selection">
<meta property="og:description" content="risk3r">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">risk3r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
<<<<<<< Updated upstream
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/risk3r.html">Get started</a>
</li>
<li>
=======
>>>>>>> Stashed changes
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Plots.html">plots</a>
    </li>
    <li>
      <a href="../articles/feature-selection.html">Feature Selection</a>
    </li>
    <li>
      <a href="../articles/predictive-metrics.html">Predictive Metrics</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="feature-selection_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Feature Selection</h1>
            
      
      
      <div class="hidden name"><code>feature-selection.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">risk3r</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">7</span>, base_family <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"credit_woe"</span><span class="op">)</span></code></pre></div>
<div id="raw-model" class="section level2">
<h2 class="hasAnchor">
<a href="#raw-model" class="anchor"></a>Raw Model</h2>
<p>Let fit a very raw model to check:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">credit_woe</span>, <span class="fl">20000</span><span class="op">)</span>
<span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">credit_woe</span>, <span class="fl">20000</span><span class="op">)</span>

<span class="va">model_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">bad</span> <span class="op">~</span> <span class="va">.</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 14 × 5</span>
<span class="co">#&gt;    term                    estimate std.error statistic  p.value</span>
<span class="co">#&gt;    &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 (Intercept)              -1.39      0.0185   -75.3   0       </span>
<span class="co">#&gt;  2 id_client_woe             1.00      0.279      3.59  3.25e- 4</span>
<span class="co">#&gt;  3 sex_woe                   0.880     0.115      7.66  1.89e-14</span>
<span class="co">#&gt;  4 marital_status_woe        0.361     0.0683     5.28  1.32e- 7</span>
<span class="co">#&gt;  5 age_woe                   0.614     0.0543    11.3   1.14e-29</span>
<span class="co">#&gt;  6 flag_res_phone_woe        0.729     0.0725    10.1   8.34e-24</span>
<span class="co">#&gt;  7 area_code_res_phone_woe   0.302     0.0974     3.10  1.93e- 3</span>
<span class="co">#&gt;  8 payment_day_woe           0.804     0.123      6.56  5.33e-11</span>
<span class="co">#&gt;  9 residence_type_woe       -0.207     0.223     -0.930 3.52e- 1</span>
<span class="co">#&gt; 10 months_in_residence_woe  -0.0302    0.153     -0.198 8.43e- 1</span>
<span class="co">#&gt; 11 months_in_the_job_woe     0.501     0.0706     7.10  1.25e-12</span>
<span class="co">#&gt; 12 profession_code_woe       0.481     0.0843     5.71  1.14e- 8</span>
<span class="co">#&gt; 13 personal_net_income_woe   0.0646    0.105      0.613 5.40e- 1</span>
<span class="co">#&gt; 14 quant_add_cards_woe       0.273     0.154      1.77  7.61e- 2</span>

<span class="co"># some parameter are negative, multicollinearity</span>
<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 × 5</span>
<span class="co">#&gt;   term                    estimate std.error statistic p.value</span>
<span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 (Intercept)              -1.39      0.0185   -75.3    0     </span>
<span class="co">#&gt; 2 residence_type_woe       -0.207     0.223     -0.930  0.352 </span>
<span class="co">#&gt; 3 months_in_residence_woe  -0.0302    0.153     -0.198  0.843 </span>
<span class="co">#&gt; 4 personal_net_income_woe   0.0646    0.105      0.613  0.540 </span>
<span class="co">#&gt; 5 quant_add_cards_woe       0.273     0.154      1.77   0.0761</span>

<span class="fu"><a href="../reference/gg_model_roc.html">gg_model_coef</a></span><span class="op">(</span><span class="va">model_raw</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Yikes!"</span><span class="op">)</span>
<span class="co">#&gt; Waiting for profiling to be done...</span></code></pre></div>
<p><img src="feature-selection_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="satellite-model" class="section level2">
<h2 class="hasAnchor">
<a href="#satellite-model" class="anchor"></a>Satellite Model</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># rf simple</span>
<span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span><span class="va">bad_good</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, do.trace <span class="op">=</span> <span class="cn">TRUE</span>, ntree <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>

<span class="fu"><a href="../reference/metrics.html">metrics</a></span><span class="op">(</span>
  <span class="va">train_data</span><span class="op">$</span><span class="va">bad_good</span>, 
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_rf</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="feature-selection-via-glmnet" class="section level2">
<h2 class="hasAnchor">
<a href="#feature-selection-via-glmnet" class="anchor"></a>Feature selection via glmnet</h2>
<p>From <a href="https://glmnet.stanford.edu/articles/glmnet.html" class="uri">https://glmnet.stanford.edu/articles/glmnet.html</a></p>
<p>There 2 option for <code>S</code>: <code>lambda.min</code> and <code>lambda.1se</code> , this last option you have a more regularized model.</p>
<p>This wrapper around the glmnet package take a model as input, then return the model with the variables non zero from the <code><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet::cv.glmnet()</a></code> function according with the selected <code>S</code> option. This function reorder the variables in the same order the coefficient in the glmnet model turn to non zero (check the plots when run this funtion).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsglmnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_glmnet.html">featsel_glmnet</a></span><span class="op">(</span><span class="va">model_raw</span>, S <span class="op">=</span> <span class="st">"lambda.1se"</span>, trace.it <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning: `as.tibble()` was deprecated in tibble 2.0.0.</span>
<span class="co">#&gt; Please use `as_tibble()` instead.</span>
<span class="co">#&gt; The signature and semantics have changed, see `?as_tibble`.</span></code></pre></div>
<p><img src="feature-selection_files/figure-html/unnamed-chunk-4-1.png" width="700"><img src="feature-selection_files/figure-html/unnamed-chunk-4-2.png" width="700"><img src="feature-selection_files/figure-html/unnamed-chunk-4-3.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 9 × 5</span>
<span class="co">#&gt;   term                    estimate std.error statistic  p.value</span>
<span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 (Intercept)               -1.39     0.0185    -75.4  0       </span>
<span class="co">#&gt; 2 age_woe                    0.616    0.0520     11.9  1.88e-32</span>
<span class="co">#&gt; 3 flag_res_phone_woe         0.743    0.0716     10.4  3.01e-25</span>
<span class="co">#&gt; 4 marital_status_woe         0.376    0.0674      5.58 2.41e- 8</span>
<span class="co">#&gt; 5 months_in_the_job_woe      0.521    0.0687      7.59 3.12e-14</span>
<span class="co">#&gt; 6 sex_woe                    0.822    0.112       7.35 2.04e-13</span>
<span class="co">#&gt; 7 profession_code_woe        0.493    0.0840      5.87 4.32e- 9</span>
<span class="co">#&gt; 8 payment_day_woe            0.805    0.122       6.57 4.87e-11</span>
<span class="co">#&gt; 9 area_code_res_phone_woe    0.312    0.0973      3.20 1.37e- 3</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 5</span>
<span class="co">#&gt;   term        estimate std.error statistic p.value</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 (Intercept)    -1.39    0.0185     -75.4       0</span>

<span class="fu"><a href="../reference/gg_model_roc.html">gg_model_coef</a></span><span class="op">(</span><span class="va">model_fsglmnet</span><span class="op">)</span></code></pre></div>
<p><img src="feature-selection_files/figure-html/unnamed-chunk-4-4.png" width="700"></p>
</div>
<div id="feature-selection-via-setpwise-forward" class="section level2">
<h2 class="hasAnchor">
<a href="#feature-selection-via-setpwise-forward" class="anchor"></a>Feature selection via Setpwise forward</h2>
<p>This is a wrapper for <code><a href="https://rdrr.io/r/stats/step.html">stats::step</a></code> but the start point model is the null one <code>response ~ 1</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fsstep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_stepforward.html">featsel_stepforward</a></span><span class="op">(</span><span class="va">model_raw</span>, trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Start:  AIC=19917.88</span>
<span class="co">#&gt; bad ~ 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + age_woe                  1    19316 19320</span>
<span class="co">#&gt; + marital_status_woe       1    19624 19628</span>
<span class="co">#&gt; + flag_res_phone_woe       1    19673 19677</span>
<span class="co">#&gt; + months_in_the_job_woe    1    19677 19681</span>
<span class="co">#&gt; + profession_code_woe      1    19737 19741</span>
<span class="co">#&gt; + personal_net_income_woe  1    19789 19793</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    19818 19822</span>
<span class="co">#&gt; + sex_woe                  1    19821 19825</span>
<span class="co">#&gt; + quant_add_cards_woe      1    19857 19861</span>
<span class="co">#&gt; + payment_day_woe          1    19859 19863</span>
<span class="co">#&gt; + months_in_residence_woe  1    19872 19876</span>
<span class="co">#&gt; + residence_type_woe       1    19900 19904</span>
<span class="co">#&gt; + id_client_woe            1    19903 19907</span>
<span class="co">#&gt; &lt;none&gt;                          19916 19918</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=19319.59</span>
<span class="co">#&gt; bad ~ age_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + flag_res_phone_woe       1    19114 19120</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    19226 19232</span>
<span class="co">#&gt; + months_in_the_job_woe    1    19260 19266</span>
<span class="co">#&gt; + sex_woe                  1    19264 19270</span>
<span class="co">#&gt; + payment_day_woe          1    19268 19274</span>
<span class="co">#&gt; + marital_status_woe       1    19273 19279</span>
<span class="co">#&gt; + profession_code_woe      1    19278 19284</span>
<span class="co">#&gt; + personal_net_income_woe  1    19295 19301</span>
<span class="co">#&gt; + id_client_woe            1    19302 19308</span>
<span class="co">#&gt; + quant_add_cards_woe      1    19303 19309</span>
<span class="co">#&gt; &lt;none&gt;                          19316 19320</span>
<span class="co">#&gt; + residence_type_woe       1    19315 19321</span>
<span class="co">#&gt; + months_in_residence_woe  1    19316 19322</span>
<span class="co">#&gt; - age_woe                  1    19916 19918</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=19119.48</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + months_in_the_job_woe    1    19064 19072</span>
<span class="co">#&gt; + sex_woe                  1    19072 19080</span>
<span class="co">#&gt; + payment_day_woe          1    19073 19081</span>
<span class="co">#&gt; + marital_status_woe       1    19077 19085</span>
<span class="co">#&gt; + profession_code_woe      1    19079 19087</span>
<span class="co">#&gt; + id_client_woe            1    19100 19108</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    19101 19109</span>
<span class="co">#&gt; + personal_net_income_woe  1    19108 19116</span>
<span class="co">#&gt; + quant_add_cards_woe      1    19108 19116</span>
<span class="co">#&gt; &lt;none&gt;                          19114 19120</span>
<span class="co">#&gt; + residence_type_woe       1    19113 19121</span>
<span class="co">#&gt; + months_in_residence_woe  1    19113 19121</span>
<span class="co">#&gt; - flag_res_phone_woe       1    19316 19320</span>
<span class="co">#&gt; - age_woe                  1    19673 19677</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=19072.28</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + sex_woe                  1    19017 19027</span>
<span class="co">#&gt; + payment_day_woe          1    19020 19030</span>
<span class="co">#&gt; + profession_code_woe      1    19026 19036</span>
<span class="co">#&gt; + marital_status_woe       1    19033 19043</span>
<span class="co">#&gt; + id_client_woe            1    19051 19061</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    19051 19061</span>
<span class="co">#&gt; + quant_add_cards_woe      1    19062 19072</span>
<span class="co">#&gt; &lt;none&gt;                          19064 19072</span>
<span class="co">#&gt; + personal_net_income_woe  1    19064 19074</span>
<span class="co">#&gt; + months_in_residence_woe  1    19064 19074</span>
<span class="co">#&gt; + residence_type_woe       1    19064 19074</span>
<span class="co">#&gt; - months_in_the_job_woe    1    19114 19120</span>
<span class="co">#&gt; - flag_res_phone_woe       1    19260 19266</span>
<span class="co">#&gt; - age_woe                  1    19456 19462</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=19026.6</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe + </span>
<span class="co">#&gt;     sex_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + payment_day_woe          1    18970 18982</span>
<span class="co">#&gt; + profession_code_woe      1    18977 18989</span>
<span class="co">#&gt; + marital_status_woe       1    18984 18996</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    19002 19014</span>
<span class="co">#&gt; + id_client_woe            1    19003 19015</span>
<span class="co">#&gt; + quant_add_cards_woe      1    19006 19018</span>
<span class="co">#&gt; + personal_net_income_woe  1    19013 19025</span>
<span class="co">#&gt; &lt;none&gt;                          19017 19027</span>
<span class="co">#&gt; + months_in_residence_woe  1    19016 19028</span>
<span class="co">#&gt; + residence_type_woe       1    19016 19028</span>
<span class="co">#&gt; - sex_woe                  1    19064 19072</span>
<span class="co">#&gt; - months_in_the_job_woe    1    19072 19080</span>
<span class="co">#&gt; - flag_res_phone_woe       1    19202 19210</span>
<span class="co">#&gt; - age_woe                  1    19371 19379</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=18981.81</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe + </span>
<span class="co">#&gt;     sex_woe + payment_day_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + profession_code_woe      1    18933 18947</span>
<span class="co">#&gt; + marital_status_woe       1    18937 18951</span>
<span class="co">#&gt; + id_client_woe            1    18956 18970</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    18956 18970</span>
<span class="co">#&gt; + quant_add_cards_woe      1    18960 18974</span>
<span class="co">#&gt; + personal_net_income_woe  1    18966 18980</span>
<span class="co">#&gt; &lt;none&gt;                          18970 18982</span>
<span class="co">#&gt; + months_in_residence_woe  1    18969 18983</span>
<span class="co">#&gt; + residence_type_woe       1    18970 18984</span>
<span class="co">#&gt; - payment_day_woe          1    19017 19027</span>
<span class="co">#&gt; - sex_woe                  1    19020 19030</span>
<span class="co">#&gt; - months_in_the_job_woe    1    19029 19039</span>
<span class="co">#&gt; - flag_res_phone_woe       1    19147 19157</span>
<span class="co">#&gt; - age_woe                  1    19314 19324</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=18946.88</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe + </span>
<span class="co">#&gt;     sex_woe + payment_day_woe + profession_code_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + marital_status_woe       1    18900 18916</span>
<span class="co">#&gt; + id_client_woe            1    18919 18935</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    18921 18937</span>
<span class="co">#&gt; + quant_add_cards_woe      1    18926 18942</span>
<span class="co">#&gt; + personal_net_income_woe  1    18930 18946</span>
<span class="co">#&gt; &lt;none&gt;                          18933 18947</span>
<span class="co">#&gt; + months_in_residence_woe  1    18932 18948</span>
<span class="co">#&gt; + residence_type_woe       1    18933 18949</span>
<span class="co">#&gt; - profession_code_woe      1    18970 18982</span>
<span class="co">#&gt; - payment_day_woe          1    18977 18989</span>
<span class="co">#&gt; - sex_woe                  1    18984 18996</span>
<span class="co">#&gt; - months_in_the_job_woe    1    18997 19009</span>
<span class="co">#&gt; - flag_res_phone_woe       1    19107 19119</span>
<span class="co">#&gt; - age_woe                  1    19180 19192</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=18915.98</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe + </span>
<span class="co">#&gt;     sex_woe + payment_day_woe + profession_code_woe + marital_status_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + id_client_woe            1    18887 18905</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    18890 18908</span>
<span class="co">#&gt; + quant_add_cards_woe      1    18896 18914</span>
<span class="co">#&gt; &lt;none&gt;                          18900 18916</span>
<span class="co">#&gt; + personal_net_income_woe  1    18899 18917</span>
<span class="co">#&gt; + residence_type_woe       1    18899 18917</span>
<span class="co">#&gt; + months_in_residence_woe  1    18900 18918</span>
<span class="co">#&gt; - marital_status_woe       1    18933 18947</span>
<span class="co">#&gt; - profession_code_woe      1    18937 18951</span>
<span class="co">#&gt; - payment_day_woe          1    18944 18958</span>
<span class="co">#&gt; - sex_woe                  1    18952 18966</span>
<span class="co">#&gt; - months_in_the_job_woe    1    18958 18972</span>
<span class="co">#&gt; - age_woe                  1    19043 19057</span>
<span class="co">#&gt; - flag_res_phone_woe       1    19069 19083</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=18904.62</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe + </span>
<span class="co">#&gt;     sex_woe + payment_day_woe + profession_code_woe + marital_status_woe + </span>
<span class="co">#&gt;     id_client_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + area_code_res_phone_woe  1    18877 18897</span>
<span class="co">#&gt; + quant_add_cards_woe      1    18882 18902</span>
<span class="co">#&gt; &lt;none&gt;                          18887 18905</span>
<span class="co">#&gt; + personal_net_income_woe  1    18885 18905</span>
<span class="co">#&gt; + residence_type_woe       1    18886 18906</span>
<span class="co">#&gt; + months_in_residence_woe  1    18886 18906</span>
<span class="co">#&gt; - id_client_woe            1    18900 18916</span>
<span class="co">#&gt; - marital_status_woe       1    18919 18935</span>
<span class="co">#&gt; - profession_code_woe      1    18924 18940</span>
<span class="co">#&gt; - payment_day_woe          1    18931 18947</span>
<span class="co">#&gt; - sex_woe                  1    18939 18955</span>
<span class="co">#&gt; - months_in_the_job_woe    1    18945 18961</span>
<span class="co">#&gt; - age_woe                  1    19030 19046</span>
<span class="co">#&gt; - flag_res_phone_woe       1    19056 19072</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=18896.86</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe + </span>
<span class="co">#&gt;     sex_woe + payment_day_woe + profession_code_woe + marital_status_woe + </span>
<span class="co">#&gt;     id_client_woe + area_code_res_phone_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; + quant_add_cards_woe      1    18873 18895</span>
<span class="co">#&gt; &lt;none&gt;                          18877 18897</span>
<span class="co">#&gt; + personal_net_income_woe  1    18876 18898</span>
<span class="co">#&gt; + residence_type_woe       1    18876 18898</span>
<span class="co">#&gt; + months_in_residence_woe  1    18877 18899</span>
<span class="co">#&gt; - area_code_res_phone_woe  1    18887 18905</span>
<span class="co">#&gt; - id_client_woe            1    18890 18908</span>
<span class="co">#&gt; - marital_status_woe       1    18908 18926</span>
<span class="co">#&gt; - profession_code_woe      1    18912 18930</span>
<span class="co">#&gt; - payment_day_woe          1    18920 18938</span>
<span class="co">#&gt; - sex_woe                  1    18930 18948</span>
<span class="co">#&gt; - months_in_the_job_woe    1    18936 18954</span>
<span class="co">#&gt; - flag_res_phone_woe       1    18983 19001</span>
<span class="co">#&gt; - age_woe                  1    19022 19040</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=18894.72</span>
<span class="co">#&gt; bad ~ age_woe + flag_res_phone_woe + months_in_the_job_woe + </span>
<span class="co">#&gt;     sex_woe + payment_day_woe + profession_code_woe + marital_status_woe + </span>
<span class="co">#&gt;     id_client_woe + area_code_res_phone_woe + quant_add_cards_woe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Df Deviance   AIC</span>
<span class="co">#&gt; &lt;none&gt;                          18873 18895</span>
<span class="co">#&gt; + residence_type_woe       1    18872 18896</span>
<span class="co">#&gt; + personal_net_income_woe  1    18872 18896</span>
<span class="co">#&gt; + months_in_residence_woe  1    18873 18897</span>
<span class="co">#&gt; - quant_add_cards_woe      1    18877 18897</span>
<span class="co">#&gt; - area_code_res_phone_woe  1    18882 18902</span>
<span class="co">#&gt; - id_client_woe            1    18886 18906</span>
<span class="co">#&gt; - marital_status_woe       1    18900 18920</span>
<span class="co">#&gt; - profession_code_woe      1    18907 18927</span>
<span class="co">#&gt; - payment_day_woe          1    18916 18936</span>
<span class="co">#&gt; - months_in_the_job_woe    1    18929 18949</span>
<span class="co">#&gt; - sex_woe                  1    18930 18950</span>
<span class="co">#&gt; - flag_res_phone_woe       1    18974 18994</span>
<span class="co">#&gt; - age_woe                  1    19014 19034</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 11 × 5</span>
<span class="co">#&gt;    term                    estimate std.error statistic  p.value</span>
<span class="co">#&gt;    &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 (Intercept)               -1.39     0.0185    -75.3  0       </span>
<span class="co">#&gt;  2 age_woe                    0.610    0.0521     11.7  1.13e-31</span>
<span class="co">#&gt;  3 flag_res_phone_woe         0.734    0.0719     10.2  1.79e-24</span>
<span class="co">#&gt;  4 months_in_the_job_woe      0.510    0.0690      7.40 1.40e-13</span>
<span class="co">#&gt;  5 sex_woe                    0.871    0.114       7.61 2.66e-14</span>
<span class="co">#&gt;  6 payment_day_woe            0.805    0.122       6.57 4.87e-11</span>
<span class="co">#&gt;  7 profession_code_woe        0.482    0.0842      5.72 1.04e- 8</span>
<span class="co">#&gt;  8 marital_status_woe         0.357    0.0679      5.26 1.46e- 7</span>
<span class="co">#&gt;  9 id_client_woe              1.00     0.279       3.59 3.29e- 4</span>
<span class="co">#&gt; 10 area_code_res_phone_woe    0.304    0.0973      3.12 1.79e- 3</span>
<span class="co">#&gt; 11 quant_add_cards_woe        0.299    0.148       2.02 4.36e- 2</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 5</span>
<span class="co">#&gt;   term        estimate std.error statistic p.value</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 (Intercept)    -1.39    0.0185     -75.3       0</span>

<span class="fu"><a href="../reference/gg_model_roc.html">gg_model_coef</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span>
<span class="co">#&gt; Waiting for profiling to be done...</span></code></pre></div>
<p><img src="feature-selection_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="feature-selection-via-repetitive-round-of-drop-out-loss" class="section level2">
<h2 class="hasAnchor">
<a href="#feature-selection-via-repetitive-round-of-drop-out-loss" class="anchor"></a>Feature selection via repetitive round of drop out loss</h2>
<p>From <a href="https://ema.drwhy.ai/featureImportance.html" class="uri">https://ema.drwhy.ai/featureImportance.html</a></p>
<p>The <code>stat = "min"</code> option give the most simpler model because It’more strict: If any iteration the loss increase then the variable is removed. You can choose between <code><a href="https://rdrr.io/r/base/c.html">c("q25", "mean", "median")</a></code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_lss_prmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featsel_loss_function_permutations.html">featsel_loss_function_permutations</a></span><span class="op">(</span>
  <span class="va">model_raw</span>, 
  stat <span class="op">=</span><span class="st">"min"</span>,
  B <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">model_lss_prmt</span>, <span class="st">"plots"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="fu">THEME</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span>

<span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">p.value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="fu"><a href="../reference/gg_model_roc.html">gg_model_coef</a></span><span class="op">(</span><span class="va">model_lss_prmt</span><span class="op">)</span></code></pre></div>
</div>
<div id="manual" class="section level2">
<h2 class="hasAnchor">
<a href="#manual" class="anchor"></a>Manual</h2>
<p>Let suppose you have a nice model, but you want to reduce the number of variables.</p>
<p>Maybe you want check:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_partials.html">model_partials</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 × 5</span>
<span class="co">#&gt;    variable                   ks   auc    iv  gini</span>
<span class="co">#&gt;    &lt;fct&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 age_woe                 0.193 0.620 0.191 0.240</span>
<span class="co">#&gt;  2 flag_res_phone_woe      0.201 0.638 0.232 0.276</span>
<span class="co">#&gt;  3 months_in_the_job_woe   0.210 0.645 0.254 0.289</span>
<span class="co">#&gt;  4 sex_woe                 0.222 0.650 0.271 0.299</span>
<span class="co">#&gt;  5 payment_day_woe         0.237 0.655 0.300 0.309</span>
<span class="co">#&gt;  6 profession_code_woe     0.238 0.657 0.307 0.315</span>
<span class="co">#&gt;  7 marital_status_woe      0.237 0.660 0.316 0.320</span>
<span class="co">#&gt;  8 id_client_woe           0.241 0.661 0.321 0.322</span>
<span class="co">#&gt;  9 area_code_res_phone_woe 0.239 0.662 0.314 0.324</span>
<span class="co">#&gt; 10 quant_add_cards_woe     0.240 0.662 0.311 0.325</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">7</span>, base_family <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/gg_model_roc.html">gg_model_partials</a></span><span class="op">(</span><span class="va">model_fsstep</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">key</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>,
      scales <span class="op">=</span> <span class="st">"free_y"</span>
      <span class="op">)</span></code></pre></div>
<p><img src="feature-selection_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua Kunst.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
